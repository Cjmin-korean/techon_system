<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>거래처정보</title>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="../css/main.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<style>
    #datatable-container {
        max-height: 1000px;
        /* Adjust the maximum height as needed */
        overflow-y: auto;
        /* Add vertical scrollbars if the content exceeds the container height */
    }

    #datatable {
        width: 100%;
        /* Other table styles */
    }

    .notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #f0f0f0;
        padding: 10px;
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        z-index: 9999;
        display: flex;
        align-items: center;
    }

    .notification img {
        width: 100px;
        height: 50px;
        margin-right: 10px;
    }

    .notification-message {
        font-size: 16px;
        color: #333;
    }

    .textbox-style {
        width: 100px;
        height: 30px;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 14px;
    }
</style>

<body>
    <div class="main_header">
        <a>생산현장정보</a>
    </div>
    <div id="loadingOverlay">
        <img src="/img/테크온로고.PNG" alt="로딩 이미지" class="loadingImage">

    </div>
    <div class="form-group">

    </div>

    <div id="datatable-container" style="height:500px; max-height: 500px; border: 1px solid silver;">

        <table class="styled-table" id="datatable">

            <thead>
                <tr>
                    <th style="background-color: rgb(148, 146, 146); color:white;" colspan="8  ">
                        생산 대기 현황
                    </th>
                </tr>
                <tr>

                    <th>모델명</th>
                    <th>제품명</th>
                    <th>BOMNO.</th>
                    <th>생산LOT</th>
                    <th>작업지시수량</th>
                    <th>자재주문번호</th>
                    <th>상태</th>
                    <th style="width:100px;"></th>
                </tr>
            </thead>
            <tbody id="startproductiontbody">
            </tbody>
        </table>
    </div>
    <div id="datatable-container" style="height:100%; max-height: 100%; border: 1px solid silver;">

        <table class="styled-table" id="datatable1">
            <thead>
                <tr>
                    <th style="background-color: rgb(148, 146, 146); color:white;" colspan="8  ">
                        생산 진행 현황
                    </th>
                </tr>
                <tr>

                    <th>모델명</th>
                    <th>제품명</th>
                    <th>BOMNO.</th>
                    <th>생산LOT</th>
                    <th>작업지시수량</th>
                    <th>자재주문번호</th>
                    <th>상태</th>
                    <th style="width:100px;"></th>
                </tr>
            </thead>
            <tbody id="startingtbody">
            </tbody>
        </table>
    </div>


    <!-- 수정창 -->
    <div id="popupOverlay1" style="display: none;">
        <div id="popupContent1" style="width: 700px; height: auto;">
            <div class="form-group">
                <table style="width:100%;">
                    <tr>
                        <td style="background-color: black; color: white;">생산시작</td>
                        <td style="visibility: hidden;"><input type="text" id="id-edit" class="data" autocomplete="off"
                                style="width:100%; border:1px solid silver; "></td>

                    </tr>

                    <tr>
                        <td style="width: 200px">모델명</td>
                        <td><input type="text" id="modelname" class="data" autocomplete="off" readonly
                                style="font-size:16px; font-weight: bold; width:100%; border:1px solid silver;"></td>

                    </tr>
                    <tr>
                        <td style="width: 200px">제품명</td>
                        <td><input type="text" id="itemname" class="data" autocomplete="off" readonly
                                style="font-size:16px; font-weight: bold; width:100%; border:1px solid silver;"></td>

                    </tr>
                    <tr>
                        <td style="width: 200px">BOMNO.</td>
                        <td><input type="text" id="bomno" class="data" autocomplete="off" readonly
                                style="font-size:16px; font-weight: bold; width:100%; border:1px solid silver;"></td>

                    </tr>
                    <tr>
                        <td style="width: 200px">생산LOT</td>
                        <td><input type="text" id="lotno" class="data" autocomplete="off" readonly
                                style="font-size:16px; font-weight: bold; width:100%; border:1px solid silver;"></td>

                    </tr>
                    <tr>
                        <td style="width: 200px">작업지시수량(개)</td>
                        <td><input type="text" id="quantity" class="data" autocomplete="off" readonly
                                style="font-size:16px; font-weight: bold; width:100%; border:1px solid silver;"></td>

                    </tr>
                    <tr>
                        <td style="width: 200px">자재주문번호</td>
                        <td><input type="text" id="orderid" class="data" autocomplete="off" readonly
                                style="font-size:16px; font-weight: bold; width:100%; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px">수량합계(M)</td>
                        <td><input type="text" id="sumdata" class="data" autocomplete="off" readonly
                                style="font-size:16px; font-weight: bold; width:100%; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px">생산설비</td>
                        <td> <select id="marchine"
                                style="font-weight:bold; padding: 5px; width:100%; border-radius: 5px;  ">

                                <option value="고속1호기(3조)태경3232(이중)">고속1호기(3조)태경3232(이중)</option>
                                <option value="고속2호기(3조)태경3232">고속2호기(3조)태경3232</option>
                                <option value="고속3호기(3조)태경3232">고속3호기(3조)태경3232</option>
                                <option value="고속4호기(3조)태경3232">고속4호기(3조)태경3232</option>
                                <option value="고속5호기(3조)태경3232">고속5호기(3조)태경3232</option>
                                <option value="고속6호기(3조)태경3232">고속6호기(3조)태경3232</option>
                                <option value="고속7호기(5조)태경3232(이중)">고속7호기(5조)태경3232(이중)</option>
                                <option value="고속8호기(5조)태경3232(이중)">고속8호기(5조)태경3232(이중)</option>
                                <option value="고속9호기(5조)태경3232(이중)">고속9호기(5조)태경3232(이중)</option>
                                <option value="고속10호기(5조)태경4038(이중)">고속10호기(5조)태경4038(이중)</option>
                                <option value="고속11호기(5조)태경4038">고속11호기(5조)태경4038</option>
                                <option value="고속12호기(5조)태경4038">고속12호기(5조)태경4038</option>
                                <option value="고속13호기(5조)태경4038">고속13호기(5조)태경4038</option>
                                <option value="고속14호기(5조)태경4038(이중)">고속14호기(5조)태경4038(이중)</option>
                                <option value="고속15호기(5조)태경3838">고속15호기(5조)태경3838</option>
                                <option value="유압프레스(1호기)">유압프레스(1호기)</option>
                                <option value="유압프레스(2호기)">유압프레스(2호기)</option>
                                <option value="유압(3호기)">유압(3호기)</option>
                                <option value="유압6565(4호기)">유압6565(4호기)</option>

                            </select></td>

                    </tr>
                    </td>
                    </tr>
                </table>
                <div style="width:100%; max-height: 600px; overflow-y: scroll;">
                    <table class="styled-table" id="POdatatable-content">
                        <thead>
                            <tr>
                                <th>자재명</th>
                                <th>자재LOT</th>
                                <th>자재폭(mm)</th>
                                <th>메인자재</th>
                                <th>수량(M)</th>
                            </tr>
                        </thead>
                        <tbody id="POdatatbody-content-tbody">
                        </tbody>

                    </table>
                </div>

            </div>
            <button id="popupCloseBtn-edit-close">취소</button>
            <button id="popupCloseBtn-edit" onclick="Dataedit()">생산시작</button>
        </div>
    </div>


    <!-- 삭제창 -->
    <div id="popupOverlay2" style="display: none;">
        <div id="popupContent2" style="width: 700px; height: auto;">
            <div class="form-group">
                <table style="width:100%;">
                    <tr>
                        <td style="background-color: black; color: white;">생산종료</td>
                        <td style="visibility: hidden;"><input type="text" id="id-final" class="data" autocomplete="off"
                                style="width:100%; border:1px solid silver; "></td>

                    </tr>
                    <tr>
                        <td style="width: 200px">PONNO.</td>
                        <td><input type="text" id="pono-final" class="data" autocomplete="off"
                                style="font-size:16px; font-weight: bold; width:100%; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px">모델명</td>
                        <td><input type="text" id="modelname-final" class="data" autocomplete="off" readonly
                                style="font-size:16px; font-weight: bold; width:100%; border:1px solid silver;"></td>

                    </tr>
                    <tr>
                        <td style="width: 200px">제품명</td>
                        <td><input type="text" id="itemname-final" class="data" autocomplete="off" readonly
                                style="font-size:16px; font-weight: bold; width:100%; border:1px solid silver;"></td>

                    </tr>
                    <tr>
                        <td style="width: 200px">BOMNO.</td>
                        <td><input type="text" id="bomno-final" class="data" autocomplete="off" readonly
                                style="font-size:16px; font-weight: bold; width:100%; border:1px solid silver;"></td>

                    </tr>
                    <tr>
                        <td style="width: 200px">생산LOT</td>
                        <td><input type="text" id="lotno-final" class="data" autocomplete="off" readonly
                                style="font-size:16px; font-weight: bold; width:100%; border:1px solid silver;"></td>

                    </tr>
                    <tr>
                        <td style="width: 200px">작업지시수량(개)</td>
                        <td><input type="text" id="quantity-final" class="data" autocomplete="off" readonly
                                style="font-size:16px; font-weight: bold; width:100%; border:1px solid silver;"></td>

                    </tr>
                    <tr>
                        <td style="width: 200px">자재주문번호</td>
                        <td><input type="text" id="orderid-final" class="data" autocomplete="off" readonly
                                style="font-size:16px; font-weight: bold; width:100%; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px">타발수(수)</td>
                        <td><input type="text" id="touch-final" class="data" autocomplete="off"
                                style="font-size:16px; font-weight: bold; width:100%; border:1px solid silver;"></td>
                    </tr>


                </table>
                <div style="width:100%; max-height: 800px; overflow-y: scroll;">
                    <table class="styled-table" id="POdatatable-content1">
                        <thead>
                            <tr>
                                <th>자재명</th>
                                <th>자재LOT</th>
                                <th>자재폭(mm)</th>
                                <th>수량(M)</th>
                                <th>잔재수량(M)</th>
                            </tr>
                        </thead>
                        <tbody id="POdatatbody-content-tbody1">
                        </tbody>

                    </table>
                </div>

            </div>
            <button id="popupCloseBtn-delete-close">취소</button>
            <button id="popupCloseBtn-edit" onclick="Datafinish()">생산종료</button>
            <!-- <button onclick="sss()">aaaa</button> -->
        </div>
    </div>

    <script>
        var server = '';

        if (window.location.hostname == 'localhost') {
            server = 'http://localhost:8080';
        } else {
            server = 'http://techonmes.co.kr';
        }
        $(document).ready(function () {
            showLoading()
            $.ajax({
                type: 'POST',
                url: server + '/api/startproduction',
                dataType: 'json',

                success: function (data) {
                    for (var i = 0; i < data.length; i++) {
                        var status = data[i].status;
                        var backgroundColor = '';
                        var textColor = 'white';
                        var materialstatus = '';

                        if (data[i].materialstatus === 'true') {
                            materialstatus = '자재출고준비중';
                            backgroundColor = 'red';
                        } else if (data[i].materialstatus === 'true1') {
                            materialstatus = '자재준비완료';
                            backgroundColor = 'blue';
                        }
                        if (data.length === 0) {
                            $('#datatable').append('<tr><td colspan="8" style="font-weight:bold; text-align:center;">데이터가 없습니다</td></tr>');
                        }
                        $('#datatable').append(
                            '<tr>' +
                            '<td>' + data[i].modelname + '</td>' +
                            '<td>' + data[i].itemname + '</td>' +
                            '<td>' + data[i].bomno + '</td>' +
                            '<td>' + data[i].lotno + '</td>' +
                            '<td style="text-align:right;">' + data[i].quantity.toLocaleString() + '</td>' +
                            '<td>' + data[i].orderid + '</td>' +
                            '<td style="background-color: ' + backgroundColor + '; color: ' + textColor + ';">' + materialstatus + '</td>' +
                            '<td><a class="data-edit" style="cursor:pointer; color:navy;">생산시작</a></td>' +
                            '<td id="data-id">' + data[i].id + '</td>' +
                            '</tr>'
                        );

                        $("td#data-id").hide();
                    }
                }
            });



            $.ajax({
                type: 'POST',
                url: server + '/api/startproductioning',
                dataType: 'json',

                success: function (data) {
                    for (var i = 0; i < data.length; i++) {
                        var status = data[i].status;
                        var backgroundColor = '';
                        var textColor = 'white';

                        if (status === '생산중') {
                            backgroundColor = 'green';
                        }

                        $('#datatable1').append(
                            '<tr>' +
                            '<td>' + data[i].modelname + '</td>' +
                            '<td>' + data[i].itemname + '</td>' +
                            '<td>' + data[i].bomno + '</td>' +
                            '<td>' + data[i].lotno + '</td>' +
                            '<td style="text-align:right;">' + data[i].quantity.toLocaleString() + '</td>' +
                            '<td>' + data[i].orderid + '</td>' +
                            '<td style="background-color: ' + backgroundColor + '; color: ' + textColor + ';">' + status + '</td>' +
                            '<td><a class="data-finish" style="cursor:pointer; color:navy;">생산종료</a></td>' +
                            '<td id="data-id">' + data[i].id + '</td>' +
                            '<td id="data-id">' + data[i].contentname + '</td>' +
                            '</tr>'



                        );

                        $("td#data-id").hide();
                    }
                }
            });


            $('#datatable').on('click', '.data-edit', function () {
                var materialStatus = $(this).closest('tr').find('td:eq(6)').text();
                if (materialStatus === '자재출고준비중') {
                    alert('자재출고준비중입니다. 생산을 시작할 수 없습니다.');
                } else {
                    var str = "";
                    var tdArr = new Array();// 배열 선언            
                    var checkBtn = $(this);

                    var tr = checkBtn.parent().parent();
                    var td = tr.children();


                    var modelname = td.eq(0).text();
                    var itemname = td.eq(1).text();
                    var bomno = td.eq(2).text();
                    var lotno = td.eq(3).text();
                    var quantity = td.eq(4).text();
                    var orderid = td.eq(5).text();
                    var id = td.eq(8).text();

                    $('#modelname').val(modelname)
                    $('#itemname').val(itemname)
                    $('#bomno').val(bomno)
                    $('#lotno').val(lotno)
                    $('#quantity').val(quantity)
                    $('#orderid').val(orderid)


                    $('#id-edit').val(id)
                    $('#POdatatbody-content-tbody').empty()
                    $.ajax({
                        type: 'POST',
                        url: server + '/api/materialoutputorderid',
                        dataType: 'json',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            orderid: orderid,
                            lotno: lotno
                        }),
                        success: function (result) {
                            console.log(result)
                            for (var i = 0; i < result.length; i++) {
                                $('#POdatatable-content').append(
                                    '<tr>' +
                                    '<td>' + result[i].materialname + '</td>' +
                                    '<td>' + result[i].lotno + '</td>' +
                                    '<td style="text-align:right;">' + result[i].materialwidth.toLocaleString() + '</td>' +
                                    '<td style="text-align:right;">' + result[i].classification.toLocaleString() + '</td>' +
                                    '<td style="text-align:right;" id="sum' + (i + 1) + '">' + result[i].quantity.toLocaleString() + '</td>' +
                                    '</tr>'

                                )
                            }
                            var totalSum = 0; // Variable to store the total sum

                            for (var i = 0; i < result.length; i++) {
                                var quantity = result[i].quantity || 0; // Set quantity to 0 if it's undefined or null
                                var classification = result[i].classification; // Get the classification value

                                if (classification === "Main") {
                                    totalSum += quantity; // Add the quantity to the totalSum if the classification is "Main"
                                }

                                var formattedQuantity = quantity.toLocaleString(); // Format the quantity for display
                            }

                            $('#sumdata').val(totalSum);

                        }

                    })

                    $('#popupOverlay1').fadeIn();
                }

            });


            $('#datatable1').on('click', '.data-finish', function () {
                var str = "";
                var tdArr = new Array();// 배열 선언            
                var checkBtn = $(this);

                var tr = checkBtn.parent().parent();
                var td = tr.children();


                var modelname = td.eq(0).text();
                var itemname = td.eq(1).text();
                var bomno = td.eq(2).text();
                var lotno = td.eq(3).text();
                var quantity = td.eq(4).text();
                var orderid = td.eq(5).text();
                var id = td.eq(8).text();
                var pono = td.eq(9).text();

                $('#modelname-final').val(modelname)
                $('#itemname-final').val(itemname)
                $('#bomno-final').val(bomno)
                $('#lotno-final').val(lotno)
                $('#quantity-final').val(quantity)
                $('#orderid-final').val(orderid)
                $('#pono-final').val(pono)

                $('#id-final').val(id)
                $('#POdatatbody-content-tbody1').empty()
                $.ajax({
                    type: 'POST',
                    url: server + '/api/materialoutputorderid',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        orderid: orderid,
                        lotno: lotno
                    }),
                    success: function (result) {
                        var materialSum = {};

                        for (var i = 0; i < result.length; i++) {
                            var materialname = result[i].materialname;
                            var etc = result[i].etc;
                            var etcValue = parseFloat(etc) || 0;

                            if (!materialSum.hasOwnProperty(materialname)) {
                                materialSum[materialname] = 0;
                            }

                            materialSum[materialname] += etcValue;

                            $('#POdatatable-content1').append(
                                '<tr>' +
                                '<td id="material' + i + '">' + result[i].materialname + '</td>' +
                                '<td>' + result[i].lotno + '</td>' +
                                '<td style="text-align:right;">' + result[i].materialwidth.toLocaleString() + '</td>' +
                                '<td style="text-align:right;">' + result[i].quantity.toLocaleString() + '</td>' +
                                '<td><input type="text" class="textbox-style" id="etc' + i + '"></td>' +
                                '</tr>'
                            );

                            // Add event listener to input field
                            $('#etc' + i).on('input', calculateSum);
                        }

                        // Calculate and display the material sum
                        calculateSum();

                        function calculateSum() {
                            // Reset materialSum
                            for (var materialname in materialSum) {
                                materialSum[materialname] = 0;
                            }

                            // Recalculate the sum for each materialname
                            for (var j = 0; j < result.length; j++) {
                                var materialname = result[j].materialname;
                                var inputValue = parseFloat($('#etc' + j).val()) || 0;
                                materialSum[materialname] += inputValue;
                            }

                            // Remove existing material sum rows
                            $('.material-sum-row').remove();

                            // Display the sum for each materialname
                            var materialIndex = 1;

                            for (var materialname in materialSum) {
                                $('#POdatatable-content1').append(
                                    '<tr class="material-sum-row">' +
                                    '<td colspan="4" id="materialname' + materialIndex + '" style="text-align:right;">' + materialname + '</td>' +
                                    '<td colspan="1" id="sum' + materialIndex + '" style="text-align:right;">' + materialSum[materialname].toLocaleString() + '</td>' +
                                    '</tr>'
                                );
                                materialIndex++;
                            }

                        }
                    }
                });



                $('#popupOverlay2').fadeIn();
                $('#touch-final').val('');
                $('#touch-final').focus();
            });


            $('#datatable').on('click', '.data-delete', function () {
                var str = "";
                var tdArr = new Array();// 배열 선언            
                var checkBtn = $(this);

                var tr = checkBtn.parent().parent();
                var td = tr.children();

                var bomno = td.eq(0).text();
                var modelname = td.eq(1).text();
                var itemname = td.eq(2).text();
                var lotno = td.eq(3).text();
                var startdate = td.eq(4).text();
                var quantity = td.eq(5).text();
                var id = td.eq(12).text();
                $('#bomno-final').val(bomno)
                $('#modelname-final').val(modelname)
                $('#itemname-final').val(itemname)
                $('#lot-final').val(lotno)
                $('#startdate-final').val(startdate)
                $('#quantity-final').val(quantity)

                $('#id-final').val(id)
                $('#popupOverlay2').fadeIn();
            });


            $('#popupCloseBtn-save-close').click(function () {
                $('#popupOverlay').fadeOut();
            });
            $('#popupCloseBtn-edit-close').click(function () {
                $('#popupOverlay1').fadeOut();
            });
            $('#popupCloseBtn-delete-close').click(function () {
                $('#popupOverlay2').fadeOut();
            });


        });



        //오름차순 내림차순
        function sortTable(columnIndex) {
            var table, rows, switching, i, x, y, shouldSwitch, direction, switchcount = 0;
            table = document.getElementById("datatable");
            switching = true;
            direction = "asc"; // 기본 정렬 방향은 오름차순

            while (switching) {
                switching = false;
                rows = table.getElementsByTagName("tr");

                for (i = 1; i < (rows.length - 1); i++) {
                    shouldSwitch = false;
                    x = rows[i].getElementsByTagName("td")[columnIndex];
                    y = rows[i + 1].getElementsByTagName("td")[columnIndex];

                    if (direction == "asc") {
                        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                            shouldSwitch = true;
                            break;
                        }
                    } else if (direction == "desc") {
                        if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                            shouldSwitch = true;
                            break;
                        }
                    }
                }

                if (shouldSwitch) {
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                    switchcount++;
                } else {
                    if (switchcount == 0 && direction == "asc") {
                        direction = "desc";
                        switching = true;
                    }
                }
            }
        }

        //검색
        function search() {
            console.log("11")
            const searchInput = document.getElementById('myInput');
            const dataTable = document.getElementById('datatable');
            const tableRows = dataTable.getElementsByTagName('tr');

            searchInput.addEventListener('input', function () {
                const searchValue = this.value.toLowerCase();

                for (let i = 1; i < tableRows.length; i++) {
                    const rowData = tableRows[i].getElementsByTagName('td');

                    let found = false;

                    for (let j = 0; j < rowData.length; j++) {
                        const cellData = rowData[j].textContent.toLowerCase();

                        if (cellData.includes(searchValue)) {
                            found = true;
                            break;
                        }
                    }

                    if (found) {
                        tableRows[i].style.display = '';
                    } else {
                        tableRows[i].style.display = 'none';
                    }

                }
            });
        }
        function showLoading() {
            var loadingOverlay = document.getElementById("loadingOverlay");
            loadingOverlay.style.display = "flex";

            // 로딩 완료 후 일정 시간 후 로딩 창 숨기기 (테스트용)
            setTimeout(function () {
                loadingOverlay.style.display = "none";
            }, 1000);
        }

        function New() {
            $('#accountcode-save').val('')
            $('#accountname-save').val('')
            $('#representativename-save').val('')
            $('#phone-save').val('')
            $('#adress-save').val('')
            $('#popupOverlay').fadeIn();
        }


        function Dataedit() {
            var today = new Date();
            var now = new Date();	// 현재 날짜 및 시간
            var year = today.getFullYear();
            var month = ('0' + (today.getMonth() + 1)).slice(-2);
            var day = ('0' + today.getDate()).slice(-2);
            var hours = ('0' + now.getHours()).slice(-2);	// 시간
            var minutes = ('0' + now.getMinutes()).slice(-2);	// 분
            var seconds = ('0' + now.getSeconds()).slice(-2);	// 초

            var materialinput = $('#sumdata').val()
            $.ajax({
                type: 'POST',
                url: server + '/api/startproduct',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({

                    id: $('#id-edit').val(),
                    startdate: year + "-" + month + "-" + day,
                    starttime: hours + ":" + minutes + ":" + seconds,
                    marchine: $('#marchine').val(),
                    status: "생산중",
                    materialstatus: "",
                    materialinput: materialinput



                }),
                success: function (result) {
                    console.log(result)
                }
            })

            var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span style="color:navy;" class="notification-message">생산시작</span></div>');
            $('body').append(notification);
            setTimeout(function () {
                notification.fadeOut(function () {
                    $(this).remove();
                });
            }, 3000); // 3초 후에 알림을 사라지게 설정


            $('#popupOverlay1').fadeOut();
            $('#startproductiontbody').empty()
            $('#startingtbody').empty()
            setTimeout(function () {
                $.ajax({
                    type: 'POST',
                    url: server + '/api/startproductioning',
                    dataType: 'json',

                    success: function (data) {
                        for (var i = 0; i < data.length; i++) {
                            var status = data[i].status;
                            var backgroundColor = '';
                            var textColor = 'white';

                            if (status === '생산중') {
                                backgroundColor = 'green';
                            }

                            $('#datatable1').append(
                                '<tr>' +
                                '<td>' + data[i].modelname + '</td>' +
                                '<td>' + data[i].itemname + '</td>' +
                                '<td>' + data[i].bomno + '</td>' +
                                '<td>' + data[i].lotno + '</td>' +
                                '<td style="text-align:right;">' + data[i].quantity.toLocaleString() + '</td>' +
                                '<td>' + data[i].orderid + '</td>' +
                                '<td style="background-color: ' + backgroundColor + '; color: ' + textColor + ';">' + status + '</td>' +
                                '<td><a class="data-finish" style="cursor:pointer; color:navy;">생산종료</a></td>' +
                                '<td id="data-id">' + data[i].id + '</td>' +
                                '</tr>'
                            );

                            $("td#data-id").hide();
                        }
                    }
                });
                $.ajax({
                    type: 'POST',
                    url: server + '/api/startproduction',
                    dataType: 'json',

                    success: function (data) {
                        for (var i = 0; i < data.length; i++) {
                            var status = data[i].status;
                            var backgroundColor = '';
                            var textColor = 'white';

                            if (status === '생산대기') {
                                backgroundColor = 'blue';
                            }

                            $('#datatable').append(
                                '<tr>' +
                                '<td>' + data[i].modelname + '</td>' +
                                '<td>' + data[i].itemname + '</td>' +
                                '<td>' + data[i].bomno + '</td>' +
                                '<td>' + data[i].lotno + '</td>' +
                                '<td style="text-align:right;">' + data[i].quantity.toLocaleString() + '</td>' +
                                '<td>' + data[i].orderid + '</td>' +
                                '<td style="background-color: ' + backgroundColor + '; color: ' + textColor + ';">' + status + '</td>' +
                                '<td><a class="data-edit" style="cursor:pointer; color:navy;">생산시작</a></td>' +
                                '<td id="data-id">' + data[i].id + '</td>' +
                                '</tr>'
                            );

                            $("td#data-id").hide();
                        }
                    }
                });
            }, 50);

        }


        function Datadelte() {

            var today = new Date();
            var now = new Date();	// 현재 날짜 및 시간
            var year = today.getFullYear();
            var month = ('0' + (today.getMonth() + 1)).slice(-2);
            var day = ('0' + today.getDate()).slice(-2);
            var hours = now.getHours();	// 시간
            var minutes = now.getMinutes();	// 분
            var seconds = now.getSeconds();	// 초

            $.ajax({
                type: 'POST',
                url: server + '/api/finishinspection',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({

                    id: $('#id-final').val(),
                    touch: $('#touch-final').val(),
                    finish: hours + ":" + minutes + ":" + seconds




                }),
                success: function (result) {
                    console.log(result)
                }
            })

            $.ajax({
                type: 'POST',
                url: server + '/api/insertalltest',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({



                    bom: $('#bomno-final').val(),
                    testdate: year + "-" + month + "-" + day,
                    modelname: $('#modelname-final').val(),
                    itemname: $('#itemname-final').val(),
                    lotno: $('#lot-final').val(),
                    productdate: $('#startdate-final').val(),
                    productno: $('#lot-final').val(),
                    count: $('#quantity-final').val(),
                    okcount: parseInt($('#quantity-final').val()) - parseInt($('#ng1').val()) - parseInt($('#ng2').val()) - parseInt($('#ng3').val()) - parseInt($('#ng4').val()) - parseInt($('#ng5').val()) - parseInt($('#ng6').val()) - parseInt($('#ng7').val()) - parseInt($('#ng8').val()) - parseInt($('#ng9').val()) - parseInt($('#ng10').val()) - parseInt($('#ng11').val()) - parseInt($('#ng12').val()) - parseInt($('#ng13').val()) - parseInt($('#ng14').val()) - parseInt($('#ng15').val()) - parseInt($('#ng16').val()),
                    ngcount: parseInt($('#ng1').val()) + parseInt($('#ng2').val()) + parseInt($('#ng3').val()) + parseInt($('#ng4').val()) + parseInt($('#ng5').val()) + parseInt($('#ng6').val()) + parseInt($('#ng7').val()) + parseInt($('#ng8').val()) + parseInt($('#ng9').val()) + parseInt($('#ng10').val()) + parseInt($('#ng11').val()) + parseInt($('#ng12').val()) + parseInt($('#ng13').val()) + parseInt($('#ng14').val()) + parseInt($('#ng15').val()) + parseInt($('#ng16').val()),
                    ng1: $('#ng1').val(),
                    ng2: $('#ng2').val(),
                    ng3: $('#ng3').val(),
                    ng4: $('#ng4').val(),
                    ng5: $('#ng5').val(),
                    ng6: $('#ng6').val(),
                    ng7: $('#ng7').val(),
                    ng8: $('#ng8').val(),
                    ng9: $('#ng9').val(),
                    ng10: $('#ng10').val(),
                    ng11: $('#ng11').val(),
                    ng12: $('#ng12').val(),
                    ng13: $('#ng13').val(),
                    ng14: $('#ng14').val(),
                    ng15: $('#ng15').val(),
                    ng16: $('#ng16').val()





                }),
                success: function (result) {
                    console.log(result)
                }
            })

            $.ajax({
                type: 'POST',
                url: server + '/api/inputitemstock',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({

                    modelname: $('#modelname-final').val(),
                    itemname: $('#itemname-final').val(),
                    quantity: parseInt($('#quantity-final').val()) - parseInt($('#ng1').val()) - parseInt($('#ng2').val()) - parseInt($('#ng3').val()) - parseInt($('#ng4').val()) - parseInt($('#ng5').val()) - parseInt($('#ng6').val()) - parseInt($('#ng7').val()) - parseInt($('#ng8').val()) - parseInt($('#ng9').val()) - parseInt($('#ng10').val()) - parseInt($('#ng11').val()) - parseInt($('#ng12').val()) - parseInt($('#ng13').val()) - parseInt($('#ng14').val()) - parseInt($('#ng15').val()) - parseInt($('#ng16').val()),




                }),
                success: function (result) {
                    console.log(result)
                }
            })

            var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span style="color:red;" class="notification-message">검사종료</span></div>');
            $('body').append(notification);
            setTimeout(function () {
                notification.fadeOut(function () {
                    $(this).remove();
                });
            }, 3000); // 3초 후에 알림을 사라지게 설정
            $('#popupOverlay2').fadeOut();
            $('#Datatbody').empty()
            $.ajax({
                type: 'POST',
                url: server + '/api/selectalltest',
                dataType: 'json',
                success: function (data) {
                    for (var i = 0; i < data.length; i++) {
                        var status = data[i].status;
                        var backgroundColor = '';
                        var textColor = 'white';

                        if (status === '검사대기') {
                            backgroundColor = 'blue';
                        } else if (status === '검사완료') {
                            backgroundColor = 'red';
                        } else if (status === '검사중') {
                            backgroundColor = 'green';
                        }

                        $('#datatable').append(
                            '<tr>' +
                            '<td>' + data[i].bomno + '</td>' +
                            '<td>' + data[i].modelname + '</td>' +
                            '<td>' + data[i].itemname + '</td>' +
                            '<td>' + data[i].lotno + '</td>' +
                            '<td>' + data[i].startdate + '</td>' +

                            '<td>' + data[i].quantity + '</td>' +
                            '<td>' + data[i].inspectiondate + '</td>' +
                            '<td>' + data[i].start + '</td>' +
                            '<td>' + data[i].finish + '</td>' +
                            '<td style="background-color: ' + backgroundColor + '; color: ' + textColor + ';">' + status + '</td>' +
                            '<td><a class="data-edit" style="cursor:pointer; color:navy;">검사시작</a></td>' +
                            '<td><a class="data-delete" style="cursor:pointer; color:red;">검사종료</a></td>' +
                            '<td id="data-id">' + data[i].id + '</td>' +
                            '</tr>'



                        );

                        $("td#data-id").hide();
                    }
                }
            });
        }

    </script>
    <script>
        // function onchangesum() {
        //     var rowCount = 10; // Header 행을 제외한 행 개수
        //     var totalEtc = 0; // 전체 합계를 저장할 변수
        //     for (var i = 0; i < rowCount; i++) {

        //         var etc = parseFloat($('#etc' + i).val()) || 0; // etc 값을 가져와서 숫자로 변환하고, 없을 경우 0으로 처리
        //         var formattedEtc = etc.toLocaleString(); // etc 값을 포맷팅하여 출력

        //         totalEtc += etc; // etc 값을 합산
        //     }

        //     $('#sum-final').val(totalEtc)
        // }

        function Datafinish() {
            // if ($('#touch-final').val() === '') {
            //     var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span style="color:red;" class="notification-message">타발수 누락되었습니다</span></div>');
            //     $('body').append(notification);
            //     setTimeout(function () {
            //         notification.fadeOut(function () {
            //             $(this).remove();
            //         });
            //     }, 3000); // 3초 후에 알림을 사라지게 설정   
            // } else {

            // }
            var today = new Date();
            var now = new Date();	// 현재 날짜 및 시간
            var year = today.getFullYear();
            var month = ('0' + (today.getMonth() + 1)).slice(-2);
            var day = ('0' + today.getDate()).slice(-2);
            var hours = ('0' + now.getHours()).slice(-2);	// 시간
            var minutes = ('0' + now.getMinutes()).slice(-2);	// 분
            var seconds = ('0' + now.getSeconds()).slice(-2);	// 초


            $.ajax({
                type: 'POST',
                url: server + '/api/finishinproduct',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    //              
                    id: $('#id-final').val(),
                    finaltime: hours + ":" + minutes + ":" + seconds,
                    touch: $('#touch-final').val(),
                    status: "생산종료",



                }),
                success: function (result) {
                }
            })


            const $table = document.getElementById('POdatatable-content1'); // table 엘리먼트 취득


            const trGroup = Array.from(document.querySelectorAll('#POdatatable-content1 tr'));

            const textGroup = trGroup.map(tr => {
                return Array.from(tr.children).map(input => input.textContent);
            });
            // console.log($table.rows.length)

            for (var i = 1; i < 3; i++) {

                var materialname = $('#materialname' + i + '').text();

                var materialoutput = $('#sum' + i + '').text();

                var pono = $('#pono-final').val();

                $.ajax({
                    type: 'POST',
                    url: server + '/api/finishinproduct1',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        //              
                        materialname: materialname,
                        materialoutput: materialoutput,
                        pono: pono,
                        lotno: $('#lotno-final').val()



                    }),
                    success: function (result) {

                    }
                })
            }

            $.ajax({
                type: 'POST',
                url: server + '/api/inputalltest',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    //              
                    bomno: $('#bomno-final').val(),
                    modelname: $('#modelname-final').val(),
                    itemname: $('#itemname-final').val(),
                    lotno: $('#lotno-final').val(),
                    startdate: year + "-" + month + "-" + day,
                    touch: $('#touch-final').val(),
                    quantity: $('#touch-final').val()



                }),
                success: function (result) {
                }
            })
            var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span style="color:navy;" class="notification-message">생산종료</span></div>');
            $('body').append(notification);
            setTimeout(function () {
                notification.fadeOut(function () {
                    $(this).remove();
                });
            }, 3000); // 3초 후에 알림을 사라지게 설정
            setTimeout(function () {
                $('#startproductiontbody').empty()
                $('#startingtbody').empty()
                $.ajax({
                    type: 'POST',
                    url: server + '/api/startproduction',
                    dataType: 'json',

                    success: function (data) {
                        for (var i = 0; i < data.length; i++) {
                            var status = data[i].status;
                            var backgroundColor = '';
                            var textColor = 'white';

                            if (status === '생산대기') {
                                backgroundColor = 'blue';
                            }

                            $('#datatable').append(
                                '<tr>' +
                                '<td>' + data[i].modelname + '</td>' +
                                '<td>' + data[i].itemname + '</td>' +
                                '<td>' + data[i].bomno + '</td>' +
                                '<td>' + data[i].lotno + '</td>' +
                                '<td style="text-align:right;">' + data[i].quantity.toLocaleString() + '</td>' +
                                '<td>' + data[i].orderid + '</td>' +
                                '<td style="background-color: ' + backgroundColor + '; color: ' + textColor + ';">' + status + '</td>' +
                                '<td><a class="data-edit" style="cursor:pointer; color:navy;">생산시작</a></td>' +
                                '<td id="data-id">' + data[i].id + '</td>' +
                                '</tr>'



                            );

                            $("td#data-id").hide();
                        }
                    }
                });

                $.ajax({
                    type: 'POST',
                    url: server + '/api/startproductioning',
                    dataType: 'json',

                    success: function (data) {
                        for (var i = 0; i < data.length; i++) {
                            var status = data[i].status;
                            var backgroundColor = '';
                            var textColor = 'white';

                            if (status === '생산중') {
                                backgroundColor = 'green';
                            }

                            $('#datatable1').append(
                                '<tr>' +
                                '<td>' + data[i].modelname + '</td>' +
                                '<td>' + data[i].itemname + '</td>' +
                                '<td>' + data[i].bomno + '</td>' +
                                '<td>' + data[i].lotno + '</td>' +
                                '<td style="text-align:right;">' + data[i].quantity.toLocaleString() + '</td>' +
                                '<td>' + data[i].orderid + '</td>' +
                                '<td style="background-color: ' + backgroundColor + '; color: ' + textColor + ';">' + status + '</td>' +
                                '<td><a class="data-finish" style="cursor:pointer; color:navy;">생산종료</a></td>' +
                                '<td id="data-id">' + data[i].id + '</td>' +
                                '</tr>'



                            );

                            $("td#data-id").hide();
                        }
                    }
                });
            }, 50);
            $('#popupOverlay2').fadeOut()

        }
    </script>
    <script>

    </script>
</body>

</html>
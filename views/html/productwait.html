<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link rel="stylesheet" href="../css/productwait.css">
    <link rel="stylesheet" href="../css/spiner.css">
    <link rel="stylesheet" href="../css/tablewrapper.css">
    <link rel="stylesheet" href="../css/header.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    <title>생산발주대기</title>
</head>

<body>
    <div class="header-container">
        <div class="header-title">
            <h2><i class="fas fa-clipboard-list"></i> &nbsp;생산 발주 대기</h2>
        </div>
        <div class="header-subtitle">
            <h4>생산작업지시 > 작업지시 LOT 발행</h4>
        </div>
    </div>
    <div id="overlay" class="overlay"></div>
    <div id="overlay1" class="overlay"></div>

    <div class="spinner-overlay">
        <div class="spinner"></div>
    </div>


    <div id="maintable" class="table-wrapper" style="height: 40%;">
        <table>
            <thead>
                <tr>
                    <th style="width: auto; text-align:center;">발주일자</th>
                    <th style="width: auto; text-align:center;">BOM NO</th>
                    <th style="width: auto; text-align:center;">고객사</th>
                    <th style="width: auto; text-align:center;">모델명</th>
                    <th style="width: auto; text-align:center;">품목명</th>
                    <th style="width: auto; text-align:center;">고객사코드</th>
                    <th style="width: auto; text-align:center;">발주구분</th>
                    <th style="width: auto; text-align:center;">구분</th>
                    <th style="width: auto; text-align:center;">PO수량(EA)</th>
                    <th style="width: auto; text-align:center;">재공재고</th>
                    <th style="width: auto; text-align:center;">작업필요수량</th>
                    <th style="width: auto; text-align:center;">가능여부</th>
                    <th style="width: auto; text-align:center;">작업지시수량</th>
                    <th style="width: auto; text-align:center;">생산지시</th>
                </tr>


            </thead>

            <tbody id="iteminfobody">
            </tbody>
            <tfoot id="iteminfofoot">
            </tfoot>
        </table>
    </div>

    <div class="header-container">
        <div class="header-title">
            <h2><i class="fas fa-clipboard-list"></i> &nbsp;생산 지시 현황</h2>
        </div>
        <div class="header-subtitle">
            <button class="close-button" style="background-color: red;" onclick="deletedata()">선택삭제</button>
            <button class="close-button" style="background-color: blue;" onclick="savedata()">선택확정</button>
            <button class="close-button" style="background-color: green;" onclick="pausedata()">선택보류</button>
        </div>
    </div>
    <div id="maintable" class="table-wrapper" style="height: 45%;">
        <table id="orderdatatable">
            <thead>
                <tr>
                    <th style="width: 10px;"><input type="checkbox" style="width: 20px; height: 20px; cursor: pointer;">
                    </th>
                    <th>BOMNO</th>
                    <th>고객사</th>
                    <th>구분</th>
                    <th>모델명</th>
                    <th>제품명</th>
                    <th>생산LOTNO.</th>
                    <th>수량(개)</th>
                    <th>수량변경</th>
                    <th></th>
                    <th></th>

                </tr>


            </thead>

            <tbody id="iteminfobody1">
            </tbody>
            <tfoot id="iteminfofoot">
            </tfoot>
        </table>
    </div>
    <div class="modal" id="modal">
        <div class="modal-header">
            <span style="font-weight: bold;"> <i class="fas fa-address-book"></i>&nbsp;생산 LOT 발행</span>
        </div>
        <div class="modal-footer">
            <button class="close-button" onclick="accountsave()">저장</button>
            <button class="delete-button" style="margin-left: 10px;" onclick="closeModal()">취소</button>
        </div>
        <div class="modal-content" style="margin-top: 10px;">
            <table>
                <tr style="height:50px;">
                    <th colspan="2">발주 정보<input type="text" id="orderid" style="visibility: hidden; width:20px;"><input
                            type="text" id="num" style="visibility: hidden; width:20px;">
                    </th>


                </tr>
                <tr>
                    <td><label for="editAuthor">BOMNO</label></td>
                    <td><input type="text" id="bomno-edit" value="" readonly autocomplete="off"></td>
                </tr>
                <tr>
                    <td><label for="editAuthor">발주일자</label></td>
                    <td><input type="text" id="accountdate-edit" value="" readonly autocomplete="off"></td>
                </tr>
                <tr>
                    <td><label for="editAuthor">고객사</label></td>
                    <td><input type="text" id="customer-edit" value="" readonly autocomplete="off"></td>
                </tr>
                <tr>
                    <td><label for="editAuthor">품목코드</label></td>
                    <td><input type="text" id="itemcode-edit" value="" readonly autocomplete="off"></td>
                </tr>
                <tr>
                    <td><label for="editAuthor">모델명</label></td>
                    <td><input type="text" id="modelname-edit" value="" readonly autocomplete="off"></td>
                </tr>
                <tr>
                    <td><label for="editAuthor">품목명</label></td>
                    <td><input type="text" id="itemname-edit" value="" readonly autocomplete="off"></td>
                </tr>
                <tr>
                    <td><label for="editAuthor">영업구분</label></td>
                    <td><input type="text" id="ad-edit" value="" autocomplete="off"></td>
                </tr>
                <tr>
                    <td><label for="editAuthor">구분</label></td>
                    <td><input type="text" id="part-edit" value="" autocomplete="off"></td>
                </tr>
                <tr>
                    <td><label for="editAuthor">PO수량</label></td>
                    <td><input type="text" id="count-edit" value="" readonly autocomplete="off"></td>
                </tr>
                <tr>
                    <td><label for="editAuthor">생산CAPA</label></td>
                    <td><input type="text" id="capa-edit" value="" readonly autocomplete="off"></td>
                </tr>

            </table>
        </div>
        <div id="maintable" class="table-wrapper" style="max-height: 300px;">
            <table>
                <tr style="height:50px;">
                    <th>작업지시<br>수량(EA)</th>
                    <th>1차피딩<br>(mm)</th>
                    <th>소요량<br>(M)</th>
                    <th>메인자재
                        <br>1RL(M)
                    </th>
                    <th>롤 수<br>(roll)</th>
                    <th>소요합계(M)</th>
                    <th style="width: 100px;"><button id="deleteBtn" onclick="add()" class="save-button"
                            style="background-color: rgb(48, 48, 248);">
                            추가
                        </button></th>
                </tr>
                <tbody id="productiondatatbody">

                </tbody>
                <tfoot>
                    <tr>
                        <td>수량 합계</td>
                        <td id="countsum">0</td>
                        <td>수량 차이</td>
                        <td id="minus">0</td>
                        <td colspan="4"></td>
                    </tr>
                </tfoot>
            </table>
        </div>



    </div>

    <div class="modal1" id="modal1">
        <div class="modal-header">
            <span style="font-weight: bold;"> <i class="fas fa-address-book"></i>&nbsp;제품검색</span>
        </div>
        <input type="text" class="styled-search" id="itemcode1-input" placeholder="검색내용을 입력하세요" autocomplete="off">
        <div class="modal-content">


            <table class="styled-table" id="Podatatable">
                <thead id="tableHead">
                    <tr>
                        <th>제품코드</th>
                        <th>BOMNO</th>
                        <th>모델명</th>
                        <th>제품명</th>
                        <th>고객사</th>
                        <th>단가</th>
                        <th style="width:100px;"></th>
                    </tr>
                </thead>
                <tbody id="itemtbody">
                </tbody>
            </table>

        </div>
        <div class="modal-footer">
            <button class="delete-button" style="margin-left: 10px;" onclick="closeModal1()">닫기</button>
        </div>
    </div>


    <script>
        var server = '';
        var gridApi;
        if (window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost') {
            server = 'http://localhost:8080';
        } else {
            server = 'http://techonmes.co.kr';
        }

        $(document).ready(function () {


            load()
            load1()
            $('#orderdatatable thead input[type="checkbox"]').on('change', function () {
                var isChecked = $(this).prop('checked');

                $('#orderdatatable tbody input[type="checkbox"]').prop('checked', isChecked);

                if (isChecked) {
                    // Get the IDs of checked checkboxes
                    var checkedIds = $('#orderdatatable tbody input[type="checkbox"]:checked').map(function () {
                        return $(this).closest('tr').find('td#data-id').text();
                    }).get();
                    // console.log(checkedIds)
                }
            });
        });

        function load() {
            var spinnerOverlay = document.querySelector('.spinner-overlay');
            spinnerOverlay.style.display = 'flex'; // Spinner 표시
            $('#iteminfobody').empty();
            $.ajax({
                type: 'POST',
                url: server + '/api/accountordering',
                dataType: 'json',
                success: function (data) {
                    var tableBody = $('#iteminfobody');
                    var tableRowCount = $('#iteminfobody tr').length;
                    if (data.length === 0) {
                        tableBody.append('<tr><td colspan="14" style="text-align:center;">데이터가 없습니다.</td></tr>');
                    } else {
                        for (var i = 0; i < data.length; i++) {
                            var deliveryDate = new Date(data[i].deliverydate);
                            var currentDate = new Date();

                            var daysRemaining = Math.ceil((deliveryDate - currentDate) / (1000 * 60 * 60 * 24));

                            var daysRemainingColor = daysRemaining > 0 ? 'color: blue;' : 'color: red;';

                            var possibleColor = '';
                            var difference = parseFloat(data[i].difference.replace(/,/g, '')); // 쉼표 제거하고 숫자로 변환

                            if (data[i].possible === '가능') {
                                possibleColor = 'color: blue; font-weight:bold;';
                            } else if (data[i].possible === '부족') {
                                possibleColor = 'color: red; font-weight:bold;';
                            }

                            // 폰트 색상을 결정하는 조건 추가
                            var fontColor = '';
                            if (difference <= 0) {
                                fontColor = 'color: red;';
                            }

                            // 남은 일수가 음수인 경우 "만료"로 표시
                            var daysRemainingText = daysRemaining < 0 ? "납기미준수" : daysRemaining + '일 남음';

                            tableBody.append(
                                '<tr>' +
                                '<td style="font-weight:bold;">' + data[i].deliverydate + '</td>' +
                                '<td>' + data[i].bomno + '</td>' +
                                '<td>' + data[i].customer + '</td>' +
                                '<td>' + data[i].modelname + '</td>' +
                                '<td>' + data[i].itemname + '</td>' +
                                '<td>' + data[i].itemcode + '</td>' +
                                '<td style="text-align:center;">' + data[i].ad + '</td>' +
                                '<td >' + data[i].part + '</td>' +
                                '<td style="text-align:right;">' + data[i].quantity + '</td>' +
                                '<td style="text-align:right;">' + data[i].total_quantity.toLocaleString() + '</td>' +
                                '<td style="text-align:right;' + fontColor + '">' + difference.toLocaleString() + '</td>' + // 쉼표 추가하여 숫자로 표시
                                '<td style="' + possibleColor + ' text-align:center;">' + data[i].possible + '</td>' +
                                '<td id="data-orderid">' + data[i].orderid + '</td>' +
                                '<td style="text-align:right;">' + data[i].a.toLocaleString() + '</td>' +
                                '<td id="data-exists1" style="text-align:center;">' + data[i].exists1 + '</td>' +

                                '</tr>'
                            );
                            $('td#data-orderid').hide()
                        }


                    }
                }

            });
            setTimeout(function () {
                spinnerOverlay.style.display = 'none'; // 1초 후에 Spiner 숨김
            }, 1100);

        }

        function load1() {
            $('#iteminfobody1').empty();
            var data; // 데이터 배열을 선언합니다.

            $.ajax({
                type: 'POST',
                url: server + '/api/productorderlist3',
                dataType: 'json',
                success: function (responseData) {
                    data = responseData;
                    var tableBody = $('#iteminfobody1');
                    if (data.length === 0) {
                        tableBody.append('<tr><td colspan="11">데이터가 없습니다.</td></tr>');
                    } else {
                        for (var i = 0; i < data.length; i++) {
                            var orderStatusCell = '';
                            var deleteClass = 'datadelete';
                            var quantityChangeInfo = '';

                            if (data[i].orderstatus === '생산보류') {
                                orderStatusCell = '<td><a class="orderstatus" onclick="orderstatusmodal(this)" style="font-weight:bold; cursor:pointer; color:green;">생산보류</a></td>';
                                deleteClass = '<td><a class="datadelete" style="cursor:pointer; color:red; font-weight:bold;" onclick="deleteorderstatus(this)">삭제</a></td>';
                                quantityChangeInfo = '<td class="changequantity"  style="color: navy;">수량변경</td>';
                            } else if (data[i].orderstatus === '생산확정') {
                                orderStatusCell = '<td><a class="orderfinish" style="cursor:pointer; color:red; font-weight:bold;">생산확정</a></td>';
                                deleteClass = '<td><a class="finishdelete" style="cursor:pointer; color:red; font-weight:bold;" onclick="orderstatuscancelmodal(this)">확정취소</a></td>';
                                quantityChangeInfo = '<td></td>';
                            }

                            tableBody.append(
                                '<tr>' +
                                '<td><input type="checkbox" style="width:20px; height:20px; cursor:pointer;"></td>' +
                                '<td>' + data[i].bomno + '</td>' +
                                '<td>' + data[i].customer + '</td>' +
                                '<td>' + data[i].part + '</td>' +
                                '<td>' + data[i].modelname + '</td>' +
                                '<td>' + data[i].itemname + '</td>' +
                                '<td>' + data[i].lotno + '</td>' +
                                '<td  style="text-align:right;">' + data[i].quantity.toLocaleString() + '</td>' +
                                quantityChangeInfo +
                                orderStatusCell +
                                deleteClass +
                                '<td id="data-id">' + data[i].id + '</td>' +
                                '</tr>'
                            );
                            $('td#data-id').hide();
                        }


                    }
                }
            });
        }


        // updateaccountiteminfo
        function searchTable() {
            var searchText = $('#searchInput').val().toLowerCase();
            $('#iteminfobody tr').filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(searchText) > -1);
            });
        }
        // document.getElementById("itemcode-input").addEventListener("keypress", function (event) {
        //     if (event.key === "Enter") {
        //         openProductModal(event.target.value);
        //     }
        // });
        // document.getElementById("itemcode1-input").addEventListener("keypress", function (event) {
        //     if (event.key === "Enter") {
        //         openProductModal(event.target.value);
        //     }
        // });
        function showinfo() {
            document.getElementById('modal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }


        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }
        function closeModal1() {
            document.getElementById('modal1').style.display = 'none';
            document.getElementById('overlay1').style.display = 'none';
        }


        $('#iteminfobody').on('dblclick', 'tr', function () {
            var rowData = $(this).find('td').map(function () {
                return $(this).text();
            }).get();
            $.ajax({
                type: 'POST',
                url: server + '/api/capasearchingwherebomno',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    "bomno": rowData[1]
                }),
                success: function (result) {
                    $('#capa-edit').val(result[0].cv2.toLocaleString())
                }
            });
            $.ajax({
                type: 'POST',
                url: server + '/api/selectbomsoyo1',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    "bomno": rowData[1]
                }),
                success: function (result) {
                    // Perform a case-insensitive comparison after trimming

                    $('#productiondatatbody').empty()
                    var newRow = $('<tr></tr>');
                    var rowCount = $('#productiondatatbody tr').length;

                    newRow.append('<td ><input type="text" style="text-align:right;" oninput="valuechanged()" id="count-input"  value="" autocomplete="off"></td>');
                    newRow.append('<td ><input type="text" readonly style="text-align:right;" id="onepidding-input"  value="' + result[0].onepid + '" autocomplete="off"></td>');
                    newRow.append('<td ><input type="text" readonly style="text-align:right;" id="soyo-input"  value="' + result[0].soyo + '" autocomplete="off"></td>');
                    newRow.append('<td ><input type="text" readonly style="text-align:right;" id="length-input"  value="' + result[0].length + '" autocomplete="off"></td>');
                    newRow.append('<td ><input type="text" style="text-align:right;" oninput="rollvaluechanged()" id="roll-input"  value="0" autocomplete="off"></td>');
                    newRow.append('<td ><input type="text" readonly style="text-align:right;" id="soyosum-input"  value="0" autocomplete="off"></td>');
                    newRow.append('<td><button id="deleteRowBtn" onclick="deleteRow(this)" class="save-button" style="background-color: red;">삭제</button ></td > ');



                    $('#productiondatatbody').append(newRow);
                }
            });

            $.ajax({
                type: 'POST',
                url: server + '/api/searchnum',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    "orderid": rowData[12]
                }),
                success: function (result) {
                    $('#num').val(result[0].num)

                }
            });
            $('#bomno-edit').val(rowData[1])
            $('#accountdate-edit').val(rowData[0])
            $('#customer-edit').val(rowData[2])
            $('#itemcode-edit').val(rowData[5])
            $('#modelname-edit').val(rowData[3])
            $('#itemname-edit').val(rowData[4])
            $('#ad-edit').val(rowData[6])
            $('#part-edit').val(rowData[7])
            $('#count-edit').val(rowData[8])
            $('#orderid').val(rowData[12])
            $('#overlay').fadeIn()
            $('#modal').fadeIn()
        });
        function saveprocessname() {
            $.ajax({
                url: server + '/api/insertprocessname',
                method: 'post',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    processname: $('#processname-input').val()
                }),
                success: function (data) {

                }
            });
            $('#processnametbody').empty()
            selectprocessname()
        }
        // 상세 정보 버튼에 대한 클릭 이벤트 처리
        $(document).on('click', '.btninfo', function () {
            // 클릭된 버튼이 속한 행(row)을 선택합니다.
            var rowData = $(this).closest('tr');

            // 행에 포함된 데이터 셀들을 선택하여 데이터를 가져옵니다.
            var customer = rowData.find('td:eq(0)').text();
            var modelname = rowData.find('td:eq(1)').text();
            var itemname = rowData.find('td:eq(2)').text();
            var itemcode = rowData.find('td:eq(3)').text();
            var processname = rowData.find('td:eq(9)').text();
            var bucakcustomer = rowData.find('td:eq(10)').text();
            var id = rowData.find('td:eq(11)').text();

            $('#customer').text(customer)
            $('#modelname').text(modelname)
            $('#itemname').text(itemname)
            $('#itemcode').text(itemcode)
            $('#processname').text(processname)
            $('#bucakcustomer').text(bucakcustomer)
            // $('#cutomer').text(customer)
            // $('#customer').text(customer)s
        });

        function openModal() {
            document.getElementById('modal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
            $('#itemcode-input').focus()
            $('#itemcode-input').val('')
            $('#accountdatatbody').empty()
        }

        function add() {
            var newRow = $('#productiondatatbody tr:first').clone();

            var rowCount = $('#productiondatatbody tr').length + 1;
            $('#lot-input').val($('#ad-edit').val() + '-' + $('#bomno-edit').val() + '-' + $('#accountdate-edit').val().replace(/-/g, '') + '-' + rowCount);

            newRow.appendTo('#productiondatatbody');


            var countSum = 0;
            $('#productiondatatbody #count-input').each(function () {
                const value = parseFloat($(this).val().replace(/,/g, '')) || 0;
                countSum += value;


            });

            // 계산된 합계를 countsum TD 요소에 설정
            $('#countsum').text(countSum.toLocaleString());

            const countEditValue = parseFloat($('#count-edit').val().replace(/,/g, '')) || 0;
            const difference = countEditValue - countSum;
            $('#minus').text(difference.toLocaleString());
        }


        function deleteRow(button) {
            var row = button.closest('tr');
            var rowCount = document.getElementById('Podatatable').getElementsByTagName('tbody')[0].getElementsByTagName('tr').length;
            row.remove();
            var rowCount = $('#iteminfobody1 tr').length; // 테이블의 행 수 확인
            if (rowCount == 0) { // 행 수가 0인 경우
                $('#iteminfobody1').append('<tr><td colspan="12">데이터가 없습니다.</td></tr>'); // 메시지 추가
            }
        }
        function valuechanged() {
            var currentRow = $(event.target).closest('tr');
            var rowIndex = currentRow.index();
            const itempriceValue = parseFloat($('#productiondatatbody tr:eq(' + rowIndex + ') #soyo-input').val().replace(/,/g, '')) || 0;
            const countValue = parseFloat($('#productiondatatbody tr:eq(' + rowIndex + ') #count-input').val().replace(/,/g, '')) || 0;
            const lengthValue = parseFloat($('#productiondatatbody tr:eq(' + rowIndex + ') #length-input').val().replace(/,/g, '')) || 0;
            const priceValue = itempriceValue * countValue;
            const rollValue = priceValue / lengthValue
            $('#productiondatatbody tr:eq(' + rowIndex + ') #soyosum-input').val(priceValue.toLocaleString());
            $('#productiondatatbody tr:eq(' + rowIndex + ') #roll-input').val(rollValue.toLocaleString());

            var countSum = 0;
            $('#productiondatatbody #count-input').each(function () {
                const value = parseFloat($(this).val().replace(/,/g, '')) || 0;
                countSum += value;


            });

            // 계산된 합계를 countsum TD 요소에 설정
            $('#countsum').text(countSum.toLocaleString());

            const countEditValue = parseFloat($('#count-edit').val().replace(/,/g, '')) || 0;
            const difference = countEditValue - countSum;
            $('#minus').text(difference.toLocaleString());
        }

        function rollvaluechanged() {
            var currentRow = $(event.target).closest('tr');
            var rowIndex = currentRow.index();
            const soyoValue = parseFloat($('#productiondatatbody tr:eq(' + rowIndex + ') #soyo-input').val().replace(/,/g, '')) || 0;
            const rollValue = parseFloat($('#productiondatatbody tr:eq(' + rowIndex + ') #roll-input').val().replace(/,/g, '')) || 0;
            const lengthValue = parseFloat($('#productiondatatbody tr:eq(' + rowIndex + ') #length-input').val().replace(/,/g, '')) || 0;
            const priceValue = rollValue * lengthValue;
            const countValue = Math.ceil(priceValue / soyoValue);
            $('#productiondatatbody tr:eq(' + rowIndex + ') #soyosum-input').val(priceValue);
            $('#productiondatatbody tr:eq(' + rowIndex + ') #count-input').val(countValue);

            var countSum = 0;
            $('#productiondatatbody #count-input').each(function () {
                const value = parseFloat($(this).val().replace(/,/g, '')) || 0;
                countSum += value;


            });

            // 계산된 합계를 countsum TD 요소에 설정
            $('#countsum').text(countSum.toLocaleString());

            const countEditValue = parseFloat($('#count-edit').val().replace(/,/g, '')) || 0;
            const difference = countEditValue - countSum;
            $('#minus').text(difference.toLocaleString());
        }

        function accountsave() {

            var rowCount = $('#productiondatatbody tr').length;
            let tableBody = document.getElementById('productiondatatbody');
            if (tableBody) {
                let rowCount = tableBody.children.length;

                for (let i = 0; i < rowCount; i++) {
                    var count = $('#productiondatatbody tr:eq(' + i + ') #count-input').val();


                    if (count === '' || count === '0') {
                        Swal.fire({
                            icon: 'warning',
                            title: '입력 오류',
                            text: (i + 1) + '번째 작업지시 수량 확인 바랍니다.',
                        })
                        return;
                    }

                }
            } else {
            }
            Swal.fire({
                icon: 'info',
                title: '생산 지시 정보를 저장하시겠습니까??',
                text: '생산지시가 저장됩니다.',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: '확인',
                cancelButtonText: '취소',
            }).then((result) => {
                if (result.isConfirmed) {
                    var insertdate = new Date().toISOString().slice(0, 10);
                    let today = new Date();
                    let formattedTime = today.toLocaleTimeString('en-US', { hour12: false });
                    for (var i = 0; i < rowCount; i++) {
                        $.ajax({
                            type: 'POST',
                            url: server + '/api/productorderinstruction',
                            dataType: 'json',
                            contentType: 'application/json',
                            data: JSON.stringify({
                                "bomno": $('#bomno-edit').val(),
                                "qrno": $('#orderid').val(),
                                "productdate": insertdate,
                                "modelname": $('#modelname-edit').val(),
                                "itemname": $('#itemname-edit').val(),
                                "lotno": $('#ad-edit').val() + '-' + $('#bomno-edit').val() + '-' + insertdate.replace(/-/g, '') + '-' + (parseInt($('#num').val()) + i),
                                "quantity": $('#productiondatatbody tr:eq(' + i + ') #count-input').val(),
                                "status": 'true',
                                "orderstatus": '생산보류',
                                "lotdate": insertdate,
                                "inserttime": formattedTime,
                                "customer": $('#customer-edit').val(),
                                "part": $('#part-edit').val()

                            }),
                            success: function (result) {
                                // 성공했을 때의 처리
                            }
                        });
                    }
                    $.ajax({
                        type: 'POST',
                        url: server + '/api/updatestatusaccountinput',
                        dataType: 'json',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            "orderid": $('#orderid').val(),
                            "status": '생산지시완료',
                        }),
                        success: function (result) {
                            // 성공했을 때의 처리
                        }
                    });
                    $.ajax({
                        type: 'POST',
                        url: server + '/api/updatenum',
                        dataType: 'json',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            "orderid": $('#orderid').val(),
                            "num": (parseInt($('#num').val()) + rowCount)
                        }),
                        success: function (result) {
                            // 성공했을 때의 처리
                        }
                    });
                    $('#editModal4').fadeOut();
                    $('#overlay').fadeOut();

                    Swal.fire({
                        icon: 'success',
                        title: '저장 완료',
                        text: '생산지시 정보가 저장 되었습니다.',
                    }).then((result) => {
                        if (result.isConfirmed || result.dismiss === Swal.DismissReason.esc || result.dismiss === Swal.DismissReason.overlay) {
                            load();
                            load1()
                        }
                    });

                }
            });

        }

        function deletedata() {
            var checkedIds = $('#orderdatatable tbody input[type="checkbox"]:checked').map(function () {
                return $(this).closest('tr').find('td#data-id').text();
            }).get();

            if (checkedIds.length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: '누락',
                    text: '선택된 항목이 없습니다.',
                });
                return;
            }
            Swal.fire({
                icon: 'warning',
                title: '정말로 삭제하시겠습니까?',
                text: '이 작업은 되돌릴 수 없습니다!',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: '확인',
                cancelButtonText: '취소',
            }).then((result) => {
                if (result.isConfirmed) {
                    // Array to store promises for each AJAX request
                    var ajaxPromises = [];

                    checkedIds.forEach(function (currentId) {
                        // Create a promise for each AJAX request
                        var ajaxPromise = $.ajax({
                            type: 'POST',
                            url: server + '/api/deleteaccountstatus',
                            dataType: 'json',
                            contentType: 'application/json',
                            data: JSON.stringify({
                                "id": currentId
                            })
                        });

                    });
                    selectedIds = [];
                    Swal.fire({
                        icon: 'success',
                        title: '삭제완료',
                        text: '생산지시정보가 삭제되었습니다.',
                    }).then((result) => {
                        if (result.isConfirmed || result.dismiss === Swal.DismissReason.esc || result.dismiss === Swal.DismissReason.overlay) {
                            load();
                            load1();
                            $('#orderdatatable thead input[type="checkbox"]').prop('checked', false);

                        }
                    });

                }
            });

        }
        function savedata() {
            var checkedIds = $('#orderdatatable tbody input[type="checkbox"]:checked').map(function () {
                return $(this).closest('tr').find('td#data-id').text();
            }).get();

            if (checkedIds.length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: '누락',
                    text: '선택된 항목이 없습니다.',
                });
                return;
            }
            Swal.fire({
                icon: 'info',
                title: '선택항목 생산 확정하시겠습니까?',
                text: '선택된 항목이 확정됩니다.',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: '확인',
                cancelButtonText: '취소',
            }).then((result) => {
                if (result.isConfirmed) {
                    // Array to store promises for each AJAX request
                    var ajaxPromises = [];

                    checkedIds.forEach(function (currentId) {
                        // Create a promise for each AJAX request
                        var ajaxPromise = $.ajax({
                            type: 'POST',
                            url: server + '/api/updateaccountstatus',
                            dataType: 'json',
                            contentType: 'application/json',
                            data: JSON.stringify({
                                "id": currentId,
                                "orderstatus": '생산확정'
                            })
                        });

                    });
                    selectedIds = [];
                    Swal.fire({
                        icon: 'success',
                        title: '확정 완료',
                        text: '생산지시정보가 확정 되었습니다.',
                    }).then((result) => {
                        if (result.isConfirmed || result.dismiss === Swal.DismissReason.esc || result.dismiss === Swal.DismissReason.overlay) {
                            load();
                            load1();
                            $('#orderdatatable thead input[type="checkbox"]').prop('checked', false);

                        }
                    });

                }
            });

        }
        function pausedata() {
            var checkedIds = $('#orderdatatable tbody input[type="checkbox"]:checked').map(function () {
                return $(this).closest('tr').find('td#data-id').text();
            }).get();

            if (checkedIds.length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: '누락',
                    text: '선택된 항목이 없습니다.',
                });
                return;
            }
            Swal.fire({
                icon: 'info',
                title: '선택항목 생산 보류하시겠습니까?',
                text: '선택된 항목이 보류됩니다.',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: '확인',
                cancelButtonText: '취소',
            }).then((result) => {
                if (result.isConfirmed) {
                    // Array to store promises for each AJAX request
                    var ajaxPromises = [];

                    checkedIds.forEach(function (currentId) {
                        // Create a promise for each AJAX request
                        var ajaxPromise = $.ajax({
                            type: 'POST',
                            url: server + '/api/updateaccountstatus',
                            dataType: 'json',
                            contentType: 'application/json',
                            data: JSON.stringify({
                                "id": currentId,
                                "orderstatus": '생산보류'
                            })
                        });

                    });
                    selectedIds = [];
                    Swal.fire({
                        icon: 'success',
                        title: '확정 완료',
                        text: '생산지시정보가 보류 되었습니다.',
                    }).then((result) => {
                        if (result.isConfirmed || result.dismiss === Swal.DismissReason.esc || result.dismiss === Swal.DismissReason.overlay) {
                            load();
                            load1();
                            $('#orderdatatable thead input[type="checkbox"]').prop('checked', false);
                        }
                    });

                }
            });

        }

    </script>

</body>

</html>
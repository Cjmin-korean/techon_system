<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link rel="stylesheet" href="../css/bommassinfo.css">
    <link rel="stylesheet" href="../css/spiner.css">
    <link rel="stylesheet" href="../css/header.css">
    <script src="../js/bommasssave.js"></script>
    <script src="../js/bommass.js"></script>
    <title>BOM(양산) 상세정보</title>
</head>

<body>
    <div class="spinner-overlay">
        <div class="spinner"></div>
    </div>

    <div class="header-container">
        <div class="header-title">
            <h2><i class="fas fa-cube"></i> &nbsp;BOM(양산) 상세정보</h2>
        </div>
        <div class="header-subtitle">
            <h4>BOM(양산) > BOM(양산) 상세정보</h4>
        </div>
    </div>
    <div id="overlay" class="overlay"></div>
    <div id="overlay1" class="overlay"></div>

    <fieldset>
        <legend>검색조건</legend>
        <i class="fas fa-search"></i>
        <input type="text" style="width:20%;" placeholder="검색어를 입력하세요.." id="searchInput" autocomplete="off">
        <button class="close-button" onclick="openEditModal()">신규등록</button>
    </fieldset>

    <div id="maintable" class="table-wrapper">
        <table>
            <thead>
                <th>BOMNO</th>
                <th>구분</th>
                <th>고객사</th>
                <th>모델명</th>
                <th>제품명</th>
                <th>고객사코드</th>
                <th>TYPE</th>
                <th>공정구분</th>
                <th>원가(￦)</th>
                <th>단가(￦)</th>
                <th>재료비(%)</th>
                <th>자재개수</th>
                <th style="width: 90px;"></th>
            </thead>

            <tbody id="iteminfobody">
            </tbody>
            <tfoot id="iteminfofoot">
            </tfoot>
        </table>
    </div>



    <div class="modal" id="modal">
        <div class="modal-header">
            <span style="font-weight: bold; font-size: 20px;"> <i class="fas fa-cube"></i>&nbsp;제품 BOM 정보(양산)</span>
            <input type="text" id="bomid-save" style="width: 200px; visibility: hidden;">
            <input type="text" id="bomid-edit" style="width: 200px; visibility: hidden;">
            <div class="modal-footer">
                <button class="close-button" onclick="Bomsave()()">저장</button>
                <button class="delete-button" style="margin-left: 10px;" onclick="closeModal()">취소</button>
            </div>
        </div>
        <div class="modal-content">
            <table class="styled-table" id="Podatatable">
                <thead id="tableHead">
                    <tr>
                        <th colspan="12" style="background-color: rgb(199, 199, 199); color:black;">제품정보</th>
                    </tr>

                    <tr>
                        <th><label for="editAuthor">BOMNO</label></th>
                        <td><input type="text" id="bomno-save" oninput="bomchanged()" value="" autocomplete="off"></td>
                        <th><label for="editAuthor">고객사명</label></th>
                        <td><input type="text" ondblclick="customerDoubleClick();" id="customer-save" value=""
                                autocomplete="off"></td>
                        <th><label for="editDate">모델명</label></th>
                        <td><input type="text" id="modelname-save" value="" autocomplete="off"></td>
                        <th><label for="editDate">제품명</label></th>
                        <td><input type="text" id="itemname-save" value="" autocomplete="off"></td>

                        <th><label for="editAuthor">PCS수량</label></th>
                        <td><input type="text" style="text-align: right;" id="pcs-save" value="" autocomplete="off"
                                onkeypress="return onlyNumberKey(event)" oninput="validateNumericInput(this)"
                                placeholder="숫자만 입력 가능합니다">
                        </td>
                        <th><label for="editAuthor">Cavity</label></th>
                        <td><input type="text" style="text-align: right;" id="cavity-save" value="" autocomplete="off"
                                onkeypress="return onlyNumberKey(event)" placeholder="숫자만 입력 가능합니다"
                                oninput="updateCavity(); validateNumericInput(this);">
                        </td>
                    </tr>

                    <tr>
                        <th><label for="editDate">고객코드</label></th>
                        <td><input type="text" id="itemcode-save" value="" autocomplete="off"></td>
                        <th><label for="editDate">공정구분</label></th>
                        <td><select id="workpart-save" style="font-weight: bold;">
                                <option style="font-weight: bold; font-size: 20px;" value=""></option>
                                <option style="font-weight: bold; font-size: 20px;" value="2차피딩작업">2차피딩작업</option>
                                <option style="font-weight: bold; font-size: 20px;" value="이중피딩작업">이중피딩작업</option>
                                <option style="font-weight: bold; font-size: 20px;" value="일반피딩작업">일반피딩작업</option>
                                <option style="font-weight: bold; font-size: 20px;" value="유압6565(본딩)">유압6565(본딩)
                                </option>
                                <option style="font-weight: bold; font-size: 20px;" value="PP">PP</option>

                            </select></td>
                        <th><label for="editAuthor">작업차수</label></th>
                        <td><input type="text" style="text-align: right;" id="working-save"
                                oninput="validateNumericInput(this)" value="" autocomplete="off"
                                onkeypress="return onlyNumberKey(event)" placeholder="숫자만 입력 가능합니다"></td>
                        <th><label for="editDate">타발방향</label></th>
                        <td><select id="direction-save" style="font-weight: bold;">
                                <option style="font-weight: bold; font-size: 20px;" value="정">정</option>
                                <option style="font-weight: bold; font-size: 20px;" value="역">역</option>
                                <option style="font-weight: bold; font-size: 20px;" value="정-정">정-정</option>
                                <option style="font-weight: bold; font-size: 20px;" value="역-정">역-정</option>
                                <option style="font-weight: bold; font-size: 20px;" value="정-역">정-역</option>
                                <option style="font-weight: bold; font-size: 20px;" value="역-역-정">역-역-정</option>
                                <option style="font-weight: bold; font-size: 20px;" value="역-역-역-역">역-역-역-역</option>

                            </select></td>
                        <th><label for="editDate">Type</label></th>
                        <td><select id="type-save" style="font-weight: bold;">
                                <option style="font-weight: bold; font-size: 20px;" value=""></option>
                                <option style="font-weight: bold; font-size: 20px;" value="ROLL TYPE">ROLL TYPE</option>
                                <option style="font-weight: bold; font-size: 20px;" value="SHEET TYPE">SHEET TYPE
                                </option>
                            </select>
                        </td>
                        <th><label for="editAuthor">원가합계</label></th>
                        <td><input type="text" style="text-align: right;" id="costsum-save" readonly value=""
                                autocomplete="off"></td>
                    </tr>
                    <tr style="height:50px;">
                        <th colspan="12" style="background-color: rgb(199, 199, 199); color:black;">작업특이사항</th>
                    </tr>
                    <tr style="height: 100px;">
                        <td colspan="12" style="height: 100%; padding: 10px;">
                            <textarea id="additionalNote" placeholder="작업특이사항을 입력 바랍니다." autocomplete="off"></textarea>

                        </td>
                    </tr>
                </thead>
                <tbody id="accountdatatbody" style="max-height: 500px; overflow-y: auto;">

                </tbody>


            </table>


        </div>

        <div style="height: 50%; max-height: 50%; overflow-y: auto; display: block;" id="containers">
            <table style="width: 300%;">
                <thead id="tableHead">
                    <tr>
                        <th colspan="22" style="background-color: rgb(199, 199, 199); color:black;">BOM정보</th>
                        <th colspan="13" style="background-color: rgb(165, 165, 165); color:white">자재정보</th>
                        <th colspan="13" style="background-color: rgb(121, 121, 121); color:white">합지자재정보</th>
                        <th colspan="2"></th>
                    </tr>
                    <tr style="height: 30px;">
                        <th style="width: 90px;" rowspan="2"><button id="addRowBtn" class="close-button"
                                onclick="addRow()">추가</button>
                        </th>
                        <th style="width: 50px;" rowspan="2"> </th>
                        <th style="width: 70px;" rowspan="2"><button id="addRowBtn" class="close-button"
                                onclick="habji()">합지</button>
                        </th>
                        <th style="width: 50px;" rowspan="2">작업<br>차수</th>
                        <th style="width: 50px;" rowspan="2">메인<br>자재</th>
                        <th style="width: 350px;" rowspan="2">원자재명</th>
                        <th style="width: 90px;" rowspan="2">자재종류</th>
                        <th rowspan="2" style="width: 500px;">자재별 특이사항</th>
                        <th style="width: 50px;" rowspan="2">고객사<br>지정</th>
                        <th style="width: 50px;" rowspan="2">자체<br>지정</th>
                        <th style="width: 50px;" rowspan="2">미지정</th>
                        <th style="width: 90px;">원단폭</th>
                        <th style="width: 90px;">사용<br>가능폭</th>
                        <th style="width: 90px;">1차<br>피딩</th>
                        <th style="width: 90px;">2차<br>피딩</th>
                        <th style="width: 120px;">1타<br>소요량</th>
                        <th style="width: 90px;">타</th>
                        <th style="width: 90px;">All타</th>
                        <th style="width: 90px;">타길이</th>
                        <th style="width: 90px;">소요<br>LOSS</th>
                        <th style="width: 90px;">원가<br>LOSS</th>
                        <th style="width: 120px;">원가합계<br>(1EA)</th>


                        <th style="width: 200px;" rowspan="2">자재명</th>
                        <th style="width: 90px;">전폭</th>
                        <th style="width: 90px;">유효폭</th>
                        <th style="width: 90px;">길이</th>
                        <th style="width: 150px;">SQM<br>단가</th>
                        <th style="width: 150px;">롤단가</th>
                        <th style="width: 70px;" rowspan="2">단위</th>
                        <th style="width: 130px;" rowspan="2">제조사</th>
                        <th style="width: 130px;" rowspan="2">공급사</th>
                        <th style="width: 200px;" rowspan="2">자재채번</th>
                        <th style="width: 120px;">원가<br>(1EA)</th>
                        <th style="width: 90px;">1R/L<br>컷팅수량</th>
                        <th style="width: 90px;">1R/L<br>생산수량</th>

                        <th style="width: 200px;" rowspan="2">자재명</th>
                        <th style="width: 90px;">전폭</th>
                        <th style="width: 90px;">유효폭</th>
                        <th style="width: 90px;">길이</th>
                        <th style="width: 150px;">SQM<br>단가</th>
                        <th style="width: 150px;">롤단가</th>
                        <th style="width: 70px;" rowspan="2">단위</th>
                        <th style="width: 130px;" rowspan="2">제조사</th>
                        <th style="width: 130px;" rowspan="2">공급사</th>
                        <th style="width: 200px;" rowspan="2">자재채번</th>
                        <th style="width: 120px;">원가<br>(1EA)</th>
                        <th style="width: 90px;">1R/L<br>컷팅수량</th>
                        <th style="width: 90px;">1R/L<br>생산수량</th>

                        <th style="width: 50px;" rowspan="2">C/V</th>
                        <th style="width: 50px;" rowspan="2">NO</th>



                    </tr>
                    <tr style="height: 30px;">
                        <th>mm</th>
                        <th>mm</th>
                        <th>mm</th>
                        <th>mm</th>
                        <th>M</th>
                        <th>타수</th>
                        <th>타수</th>
                        <th>mm</th>
                        <th>%</th>
                        <th>%</th>
                        <th>￦</th>

                        <th>mm</th>
                        <th>mm</th>
                        <th>M</th>
                        <th>￦</th>
                        <th>￦</th>
                        <th>￦</th>
                        <th>EA</th>
                        <th>EA</th>

                        <th>mm</th>
                        <th>mm</th>
                        <th>M</th>
                        <th>￦</th>
                        <th>￦</th>
                        <th>￦</th>
                        <th>EA</th>
                        <th>EA</th>
                    </tr>
                </thead>
                <tbody id="bomtableBody">

                </tbody>

            </table>
        </div>

    </div>

    <div class="modal1" id="modal1">
        <div class="modal-header">
            <span style="font-weight: bold;"> <i class="fas fa-address-book"></i>&nbsp;자재검색</span>
            <input type="text" id="numericPart" style="width: 200px; visibility: hidden;">
        </div>
        <input type="text" class="styled-search" id="itemcode1-input" placeholder="검색내용을 입력후 ENTER 입력하세요"
            style="width: 500px;" onkeypress="handleKeyPress3(event)" autocomplete="off">
        <button class="delete-button" style="margin-left: 30px; margin-top: 20px;" onclick="closeModal1()">닫기</button>
        <div class="modal-content" style="max-height: 70%;">
            <table class="styled-table" id="Podatatable" style="height: 350px; border: 1px solid whitesmoke;">
                <thead id="tableHead">
                    <tr>
                        <th>자재명</th>
                        <th>자재폭(mm)</th>
                        <th>길이(M)</th>
                        <th>구매처</th>
                        <th>자재종류</th>
                        <th>NO</th>
                        <th style="width:50px;"></th>
                    </tr>
                </thead>
                <tbody id="itemtbody1">
                </tbody>
            </table>

        </div>

    </div>
    <script>
        var server = '';
        var gridApi;
        if (window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost') {
            server = 'http://localhost:8080';
        } else {
            server = 'http://techonmes.co.kr';
        }


        function handleKeyPress(event) {
            if (event.keyCode === 13) { // 엔터 키의 keyCode는 13입니다.
                load1(); // 엔터 키가 눌렸을 때 실행할 함수 호출
            }
        }

        $(document).ready(function () {
            var today = new Date();
            var year = today.getFullYear();
            var month = String(today.getMonth() + 1).padStart(2, '0'); // 월은 0부터 시작하므로 1을 더해준다.
            var day = String(today.getDate()).padStart(2, '0'); // 일
            var formattedDate = year + '-' + month + '-' + day;
            load()
        });

        function load() {
            var spinnerOverlay = document.querySelector('.spinner-overlay');
            spinnerOverlay.style.display = 'flex'; // Spinner 표시

            $('#iteminfobody').empty();
            $.ajax({
                type: 'POST',
                url: server + '/api/iteminfobom',
                dataType: 'json',
                success: function (data) {
                    if (data.length === 0) {
                        $('#iteminfobody').append(
                            '<tr><td colspan="13" style="text-align:center;">데이터가 없습니다</td></tr>'
                        );
                    } else {
                        for (var i = 0; i < data.length; i++) {
                            var totalcost = data[i].cost !== null ? data[i].cost.toLocaleString() : '';
                            var itemprice = data[i].itemprice !== null ? data[i].itemprice.toLocaleString() : '';
                            var costPriceRatio = data[i].costPriceRatio !== null ? data[i].costPriceRatio : '';
                            var itemcode1 = data[i].itemcode !== null ? data[i].itemcode : '';
                            var fontColor = data[i].status === '미사용' ? 'silver' : '';

                            var rowData = JSON.stringify(data[i]);

                            $('#iteminfobody').append(
                                '<tr style="color: ' + fontColor + ';">' +
                                '<td>' + data[i].bomno + '</td>' +
                                '<td>' + data[i].part + '</td>' +
                                '<td>' + data[i].customer + '</td>' +
                                '<td>' + data[i].modelname + '</td>' +
                                '<td>' + data[i].itemname + '</td>' +
                                '<td>' + itemcode1 + '</td>' +
                                '<td>' + data[i].type + '</td>' +
                                '<td>' + data[i].workpart + '</td>' +
                                '<td style="text-align:right;">' + totalcost + '</td>' +
                                '<td style="text-align:right;">' + itemprice + '</td>' +
                                '<td style="text-align:right;">' + costPriceRatio.toFixed(2) + '</td>' +
                                '<td style="text-align:right;">' + data[i].materialcount + '</td>' +
                                '<td><button class="btninfo" onclick=\'showinfo(' + rowData + ')\'>상세정보</button></td>' +
                                '</tr>'
                            );
                        }
                    }
                    setTimeout(function () {
                        spinnerOverlay.style.display = 'none'; // 1초 후에 Spinner 숨김
                    }, 1100);
                }
            });
        }


        $(document).on('click', '#deleteRowBtn', function () {
            const currentRow = $(this).closest('tr');
            const tbodyLength = $('#bomtableBody').find('tr').length;


            if (tbodyLength === 1) {
                // Swal.fire({
                //     icon: 'error',
                //     title: '삭제 불가',
                //     text: '첫 행은 삭제할 수 없습니다.',
                // });
            } else {
                currentRow.remove();

            }
        });

        function openEditModal() {

            $('#overlay').fadeIn();
            $('#modal').fadeIn();
            $('[id$="-save"]').val('');
            $('#costsum-save').val('0');
            $('#bomid-save').val(new Date().getTime());
            $('#bomid-edit').val('');
            $('#ordercount-save').val('1');
            $('#additionalNote').val('');
            $('#bomtableBody').empty();
            var container = document.getElementById('containers');
            container.scrollLeft = 0;
            // Create a new row
            var newRow = $('<tr></tr>');

            newRow.append('<td><button id="deleteRowBtn" class="close-button" style="background-color: red; color:white; ">삭제</button></td>');
            newRow.append('<td><button id="RowBtnadd" class="rowadd-button" style="background-color: #4f56b6; color:white; ">+</button></td>');
            newRow.append('<td><input type="checkbox" id="check-input" onchange="handleCheckboxChange(this)" style="text-align:right; width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>');
            newRow.append('<td><input type="text" id="char-input" style="text-align:right;" value="1" autocomplete="off"></td>');
            newRow.append('<td><input type="checkbox" id="main-edit" onchange="handleCheckboxChange(this)" style="text-align:right; width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>');
            newRow.append('<td><input type="text" id="materialname-input" placeholder="자재명검색" ondblclick="handleKeyPress2(event)" onkeypress="handleKeyPress1(event)" style="cursor: pointer;" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" id="materialclassification-input" style="background-color:whitesmoke; "  value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" id="etc-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="checkbox" onclick="handleCheckboxChange(this)" id="chk1-input" style="width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>');
            newRow.append('<td><input type="checkbox" onclick="handleCheckboxChange(this)" id="chk2-input" style="width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>');
            newRow.append('<td><input type="checkbox" onclick="handleCheckboxChange(this)" id="chk3-input" style="width: 20px; height: 20px; cursor:pointer;" autocomplete="off" checked></td>');
            newRow.append('<td><input type="text" style="text-align:right;" id="materialwidth-input" onkeypress="return onlyNumberKey(event)" placeholder="숫자" oninput="updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost(); validateNumericInput(this);" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right;" id="useable-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right;" id="onepidding-input" placeholder="숫자" oninput="formatDecimalInput(this, 2); updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost();  validateNumericInput(this);" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right;" id="twopidding-input" placeholder="숫자" oninput="formatDecimalInput(this, 2); updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost(); " value="0" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" id="soyo-input" value="0" autocomplete="off" ></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;"  id="ta-input" oninput="updateSoyoValue()" value="1" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right;" id="allta-input" oninput="updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost(); formatDecimalInput(this, 2);" value="1" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right;" id="talength-input" oninput="formatDecimalInput(this, 2); updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost();" value="0" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right;" id="loss-input" oninput="formatDecimalInput(this, 2); updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost();" value="3" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right;" id="costloss-input" oninput="formatDecimalInput(this, 2); updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost();" value="3" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" oninput="formatDecimalInput(this, 2); calculateCost();" id="costsum-input" readonly value="0" autocomplete="off"></td>');

            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="materialaname-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="width-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="usewidth-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="length-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="sqmprice-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="rollprice-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:center; background-color: whitesmoke;" readonly id="unit-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:center; background-color: whitesmoke;" readonly id="manufacterer-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:center; background-color: whitesmoke;" readonly id="supplier-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:center; background-color: whitesmoke;" readonly id="codenumber-input"  autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="cost-input"  autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="rlcut-input"  autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="rlproduct-input"  value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="hap-materialname-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="hap-width-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="hap-usewidth-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="hap-length-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="hap-sqmprice-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="hap-rollprice-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:center; background-color: whitesmoke;" readonly id="hap-unit-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:center; background-color: whitesmoke;" readonly id="hap-manufacterer-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:center; background-color: whitesmoke;" readonly id="hap-supplier-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:center; background-color: whitesmoke;" readonly id="hap-codenumber-input"  autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="hap-cost-input"  autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="hap-rlcut-input"  autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="hap-rlproduct-input"  value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="cavity-input" onchange="updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost();" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="num-input"  autocomplete="off"></td>');

            $('#bomtableBody').append(newRow);

        }

        function showinfo(rowData) {
            document.getElementById('modal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
            $('#bomid-save').val(new Date().getTime());
            $('#bomid-edit').val(rowData.bomid)
            $('#bomno-save').val(rowData.bomno)
            $('#customer-save').val(rowData.customer)
            $('#modelname-save').val(rowData.modelname)
            $('#itemname-save').val(rowData.itemname)
            $('#pcs-save').val(rowData.pcs)
            $('#cavity-save').val(rowData.cavity)
            $('#itemcode-save').val(rowData.itemcode)
            $('#workpart-save').val(rowData.workpart)
            $('#working-save').val(rowData.working)
            $('#direction-save').val(rowData.direction)
            $('#additionalNote').val(rowData.additionalnotes)
            // console.log(rowData.direction)
            $('#type-save').val(rowData.type)
            var counter = 1;
            $('#bomtableBody').empty();
            var container = document.getElementById('containers');
            container.scrollLeft = 0;
            $.ajax({
                type: 'POST',
                url: server + '/api/selectwherebomnobommanagement1',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    "bomno": rowData.bomno
                }),
                success: function (result) {
                    let totalSum = 0; // Initialize total sum
                    if (result.length === 0) {

                    } else {
                        for (var i = 0; i < result.length; i++) {
                            let cost = parseFloat(result[i].cost);
                            let hapCost = parseFloat(result[i].hapcost || '0');
                            let sum = cost + hapCost;
                            totalSum += sum; // Accumulate total sum
                            $('#bomtableBody').append(
                                '<tr>' +
                                '<td><button id="deleteRowBtn" class="close-button" style="background-color: red; color:white; ">삭제</button></td>' +
                                '<td><button id="RowBtnadd" class="rowadd-button" style="background-color: #4f56b6; color:white; ">+</button></td>' +
                                '<td><input type="checkbox" id="check-input" onchange="handleCheckboxChange(this)" style="text-align:right; width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>' +
                                '<td><input type="text" id="char-input" style="text-align:right;" value=' + (result[i].char || '') + ' autocomplete="off"></td>' +
                                '<td><input type="checkbox" id="main-edit" ' + (result[i].main === '메인자재' ? 'checked' : '') + ' style="width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>' +
                                '<td><input type="text" id="materialname-input"  onkeypress="handleKeyPress1(event)" style="cursor: pointer;"  value="' + (result[i].savematerialname || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" id="materialclassification-input" style="background-color: whitesmoke; " readonly value="' + (result[i].typecategory || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" id="etc-input" value="' + (result[i].etc || '') + '" autocomplete="off"></td>' +
                                '<td><input type="checkbox" onclick="handleCheckboxChange(this)" id="chk1-input" ' + (result[i].chk1 === 'true' ? 'checked' : '') + ' style="width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>' +
                                '<td><input type="checkbox" onclick="handleCheckboxChange(this)" id="chk2-input" ' + (result[i].chk2 === 'true' ? 'checked' : '') + ' style="width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>' +
                                '<td><input type="checkbox" onclick="handleCheckboxChange(this)" id="chk3-input" ' + (result[i].chk3 === 'true' ? 'checked' : '') + ' style="width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right;" id="materialwidth-input" oninput="updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost();" value="' + (result[i].materialwidth || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" id="useable-input" style="text-align:right;" value="' + (result[i].useable || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right;" id="onepidding-input" oninput="formatDecimalInput(this, 2); updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost();" value="' + (result[i].onepid || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right;" id="twopidding-input" oninput="formatDecimalInput(this, 2); updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost();" value="' + (result[i].twopid || '0') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" id="soyo-input" value="' + (result[i].soyo || '') + '" autocomplete="off" readonly></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="ta-input" oninput="updateSoyoValueedit()" value="' + (result[i].ta || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right;" id="allta-input" oninput="updateSoyoValueedit(); updateRlProductedit(); updateRlcutValueedit();calculateCostedit(); formatDecimalInput(this, 2);" value="' + (result[i].allta || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right;" id="talength-input" oninput="formatDecimalInput(this, 2); updateSoyoValueedit(); updateRlProductedit(); updateRlcutValueedit(); calculateCostedit();" value="' + (result[i].talength || '0') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right;" id="loss-input" oninput="formatDecimalInput(this, 2); updateSoyoValueedit(); updateRlProductedit(); updateRlcutValueedit(); calculateCostedit();" value="' + (result[i].loss || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right;" id="costloss-input" oninput="formatDecimalInput(this, 2); updateSoyoValueedit(); updateRlProductedit(); updateRlcutValueedit(); calculateCostedit();" value="' + (result[i].costloss || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" oninput="formatDecimalInput(this, 2); calculateCost();" id="costsum-input" readonly value="' + (parseFloat(result[i].cost) + parseFloat(result[i].hapcost || '0')).toFixed(2) + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:center; background-color: whitesmoke;" id="materialname-input" readonly  value="' + (result[i].materialname || '0') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="width-input" value="' + (result[i].width || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="usewidth-input" oninput="updateRlcutValueedit()" value="' + (result[i].usewidth || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="length-input" oninput="updateRlProductedit()" value="' + (result[i].length || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="sqmprice-input" value="' + (result[i].sqmprice || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="rollprice-input" value="' + (result[i].rollprice || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:center; background-color: whitesmoke;" readonly id="unit-input" value="' + (result[i].unit || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:center; background-color: whitesmoke;" readonly id="manufacterer-input" value="' + (result[i].manufacterer || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:center; background-color: whitesmoke;" readonly id="supplier-input" value="' + (result[i].supplier || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:center; readonly background-color: whitesmoke;" id="codenumber-input" value="' + (result[i].codenumber || '') + '"  autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; readonly background-color: whitesmoke;" oninput="formatDecimalInput(this, 2); calculateCostedit();" id="cost-input" value="' + (result[i].cost || '0') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="rlcut-input" value="' + (result[i].rlcut || '') + '" oninput="updateRlProductedit()" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="rlproduct-input" oninput="updateRlProductedit()" value="' + (result[i].prdouctcount || '') + '" autocomplete="off"></td>' +

                                '<td><input type="text" readonly style="text-align:center; background-color: whitesmoke;" id="hapmaterialname-input" value="' + (result[i].hapmaterialname || '') + '"  autocomplete="off"></td>' +
                                '<td><input type="text" readonly style="text-align:right; background-color: whitesmoke;" id="hapwidth-input" value="' + (result[i].hapwidth || '') + '"  autocomplete="off"></td>' +
                                '<td><input type="text" readonly style="text-align:right; background-color: whitesmoke;" id="hapusewidth-input" value="' + (result[i].hapusewidth || '') + '"  autocomplete="off"></td>' +
                                '<td><input type="text" readonly style="text-align:right; background-color: whitesmoke;" id="haplength-input" value="' + (result[i].haplength || '') + '"  autocomplete="off"></td>' +
                                '<td><input type="text" readonly style="text-align:right; background-color: whitesmoke;" id="hapsqmprice-input" value="' + (result[i].hapsqmprice || '') + '"  autocomplete="off"></td>' +
                                '<td><input type="text" readonly style="text-align:right; background-color: whitesmoke;" id="haprollprice-input" value="' + (result[i].haprollprice || '') + '"  autocomplete="off"></td>' +
                                '<td><input type="text" readonly style="text-align:center; background-color: whitesmoke;" id="hapunit-input" value="' + (result[i].hapunit || '') + '"  autocomplete="off"></td>' +
                                '<td><input type="text" readonly style="text-align:center; background-color: whitesmoke;" id="hapmanufacterer-input" value="' + (result[i].hapmanufacterer || '') + '"  autocomplete="off"></td>' +
                                '<td><input type="text" readonly style="text-align:center; background-color: whitesmoke;" id="hapsupplier-input" value="' + (result[i].hapsupplier || '') + '"  autocomplete="off"></td>' +
                                '<td><input type="text" readonly style="text-align:center; background-color: whitesmoke;" id="hapcodenumber-input" value="' + (result[i].hapcodenumber || '') + '"  autocomplete="off"></td>' +
                                '<td><input type="text" readonly style="text-align:right; background-color: whitesmoke;" id="hapcost-input" value="' + (result[i].hapcost || '') + '"  autocomplete="off"></td>' +
                                '<td><input type="text" readonly style="text-align:right; background-color: whitesmoke;" id="haprlcut-input" value="' + (result[i].haprlcut || '') + '"  autocomplete="off"></td>' +
                                '<td><input type="text" readonly style="text-align:right; background-color: whitesmoke;" id="happrdouctcount-input" value="' + (result[i].happrdouctcount || '') + '"  autocomplete="off"></td>' +

                                '<td><input type="text" readonly style="text-align:right; background-color: whitesmoke;" id="cavity-input" value="' + (result[i].cavity || '') + '" onchange="updateSoyoValueedit(); updateRlProductedit(); updateRlcutValueedit();calculateCostedit();" autocomplete="off"></td>' +
                                '<td><input type="text" readonly style="text-align:right; background-color: whitesmoke;" id="num-input" value="' + (result[i].num || '') + '"  autocomplete="off" ></td>' +
                                '</tr>'
                            )
                            $('#costsum-save').val(totalSum.toFixed(2))
                            counter++;
                        }

                    }
                }
            });
        }

        function validateNumericInput(input) {
            // 숫자와 소수점만 입력 가능하게 함
            input.value = input.value.replace(/[^0-9.]/g, '');

            // 소수점이 여러 개 입력되지 않도록 함
            if ((input.value.match(/\./g) || []).length > 1) {
                input.value = input.value.replace(/\.+$/, '');
            }
        }

        function formatDecimalInput(input, decimalPlaces) {
            // 소수두째짜리까지만 입력가능
            input.value = input.value.replace(/[^0-9.]/g, '');
            const parts = input.value.split('.');
            if (parts.length > 1) {
                input.value = `${parts[0]}.${parts[1].slice(0, decimalPlaces)}`;
            }
        }



        function load1() {
            var spinnerOverlay = document.querySelector('.spinner-overlay');
            spinnerOverlay.style.display = 'flex'; // Spiner 표시

            $.ajax({
                url: server + '/api/iteminfobom11',
                method: 'post',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    input: $('#inputdata').val()
                }),

                success: function (result) {
                    $('#iteminfobody').empty();

                    for (var i = 0; i < result.length; i++) {
                        $('#iteminfobody').append(
                            '<tr>' +
                            '<td>' + (result[i].bomno || '') + '</td>' +
                            '<td>' + (result[i].part || '') + '</td>' +
                            '<td>' + (result[i].modelname || '') + '</td>' +
                            '<td>' + (result[i].itemname || '') + '</td>' +
                            '<td>' + (result[i].customer || '') + '</td>' +
                            '<td>' + (result[i].class || '') + '</td>' +
                            '<td>' + (result[i].itemprice.toLocaleString() || '') + '</td>' +
                            '<td>' + (result[i].cost.toLocaleString() || '') + '</td>' +
                            '<td>' + (result[i].costPriceRatio.toLocaleString() || '') + '</td>' +
                            '<td><button class="btninfo" onclick="showinfo()">상세정보</button></td>' +
                            '</tr>'
                        );

                        // 합계 계산

                    }

                    // tfoot에 합계 추가


                    $('td#data-id').hide();
                    setTimeout(function () {
                        spinnerOverlay.style.display = 'none'; // 1초 후에 Spiner 숨김
                    }, 1100);

                }
            });


        }


        $('#searchInput').on('keyup', function (event) {
            if (event.key === 'Enter') { // 엔터 키가 눌렸는지 확인
                var spinnerOverlay = document.querySelector('.spinner-overlay');
                spinnerOverlay.style.display = 'flex'; // Spinner 표시
                searchTable();
                setTimeout(function () {
                    spinnerOverlay.style.display = 'none'; // 1초 후에 Spiner 숨김
                }, 1100);
            }
        });
        // updateaccountiteminfo
        function searchTable() {
            var searchText = $('#searchInput').val().toLowerCase();
            $('#iteminfobody tr').filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(searchText) > -1);
            });
        }


        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }

        function closeModal1() {
            document.getElementById('modal1').style.display = 'none';
            document.getElementById('overlay1').style.display = 'none';
        }

        function checkData() {
            var rowCount = $('#accountdatatbody tr').length; // 테이블의 행 수 확인
            if (rowCount == 0) { // 행 수가 0인 경우
                $('#accountdatatbody').append('<tr><td colspan="12">데이터가 없습니다.</td></tr>'); // 메시지 추가
            }
        }

        function openProductModal() {


            $.ajax({
                type: 'POST',
                url: server + '/api/selectmaterialinfoinformation',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                }),
                success: function (result) {
                    $('#itemtbody1').empty();
                    for (var i = 0; i < result.length; i++) {
                        var row = '<tr>' +
                            '<td>' + result[i].materialname + '</td>' +
                            '<td>' + result[i].width + '</td>' +
                            '<td>' + result[i].length + '</td>' +
                            '<td>' + result[i].supplier + '</td>' +
                            '<td class="data-width">' + result[i].width + '</td>' +
                            '<td class="data-usewidth">' + result[i].usewidth + '</td>' +
                            '<td class="data-length">' + result[i].length + '</td>' +
                            '<td class="data-sqmprice">' + result[i].sqmprice + '</td>' +
                            '<td class="data-rollprice">' + result[i].rollprice + '</td>' +
                            '<td class="data-unit">' + result[i].unit + '</td>' +
                            '<td class="data-manufacterer">' + result[i].manufacterer + '</td>' +
                            '<td class="data-supplier">' + result[i].supplier + '</td>' +
                            '<td class="data-typecategory">' + result[i].typecategory + '</td>' +
                            '<td class="data-codenumber">' + result[i].codenumber + '</td>' +
                            '<td>' + result[i].num + '</td>' +
                            '<td><button class="btninfo" onclick="insertmaterialdata(this)" >추가</button></td>' +
                            '</tr>';

                        $('#itemtbody1').append(row);
                    }

                    // 한 번의 선택으로 모든 숨길 요소를 처리합니다.
                    $('#itemtbody1').find('.data-width, .data-usewidth, .data-length, .data-sqmprice, .data-rollprice, .data-unit, .data-manufacterer, .data-supplier, .data-codenumber').hide();
                }
            });

            document.getElementById('modal1').style.display = 'block';
            document.getElementById('overlay1').style.display = 'block';
        }
        function searchingmaterial() {

            var cavitySaveValue = $("#cavity-save").val();

            if (cavitySaveValue === '') {
                // Show alert when cavity-save is empty
                Swal.fire({
                    icon: 'error',
                    title: '누락',
                    text: `CAVITY가 누락되었습니다.`,
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: '확인',
                    background: '#f4f4f4',
                    customClass: {
                        title: 'my-title',
                        content: 'my-content',
                    },
                    padding: '2rem',
                    width: '500px',
                }).then((result) => { });
                return;  // Stop further execution
            }
            if ($('#bomtableBody tr:eq(' + $("#numericPart").val() + ') #materialname-input').val() === '') {
                $('#itemtbody1').empty();

                var noDataMessage = '<tr><td colspan="15">데이터가 없습니다</td></tr>';
                $('#itemtbody1').append(noDataMessage);
                $('#itemcode1-input').focus();
            } else {
                $.ajax({
                    type: 'POST',
                    url: server + '/api/selectbommaterial',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        materialname: $('#bomtableBody tr:eq(' + $("#numericPart").val() + ') #materialname-input').val()
                    }),
                    success: function (result) {
                        $('#itemtbody1').empty();
                        if (result.length === 0) {
                            var noDataMessage = '<tr><td colspan="15">데이터가 없습니다</td></tr>';
                            $('#itemtbody1').append(noDataMessage);
                        } else {
                            for (var i = 0; i < result.length; i++) {
                                var row = '<tr>' +
                                    '<td>' + result[i].materialname + '</td>' +
                                    '<td>' + result[i].width + '</td>' +
                                    '<td>' + result[i].length + '</td>' +
                                    '<td>' + result[i].supplier + '</td>' +
                                    '<td class="data-width">' + result[i].width + '</td>' +
                                    '<td class="data-usewidth">' + result[i].usewidth + '</td>' +
                                    '<td class="data-length">' + result[i].length + '</td>' +
                                    '<td class="data-sqmprice">' + result[i].sqmprice + '</td>' +
                                    '<td class="data-rollprice">' + result[i].rollprice + '</td>' +
                                    '<td class="data-unit">' + result[i].unit + '</td>' +
                                    '<td class="data-manufacterer">' + result[i].manufacterer + '</td>' +
                                    '<td class="data-supplier">' + result[i].supplier + '</td>' +
                                    '<td class="data-typecategory">' + result[i].typecategory + '</td>' +
                                    '<td class="data-codenumber">' + result[i].codenumber + '</td>' +
                                    '<td>' + result[i].num + '</td>' +
                                    '<td><button class="btninfo" onclick="insertmaterialdata(this)" >추가</button></td>' +
                                    '</tr>';

                                $('#itemtbody1').append(row);
                            }

                            // 한 번의 선택으로 모든 숨길 요소를 처리합니다.
                            $('#itemtbody1').find('.data-width, .data-usewidth, .data-length, .data-sqmprice, .data-rollprice, .data-unit, .data-manufacterer, .data-supplier, .data-codenumber').hide();
                        }
                    }
                });
            }



            $("#itemcode1-input").val('');

            document.getElementById('modal1').style.display = 'block';
            document.getElementById('overlay1').style.display = 'block';
        }
        function searchingmaterial1() {


            $.ajax({
                type: 'POST',
                url: server + '/api/selectbommaterial',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    materialname: $('#itemcode1-input').val()
                }),
                success: function (result) {
                    $('#itemtbody1').empty();
                    if (result.length === 0) {
                        var noDataMessage = '<tr><td colspan="15">데이터가 없습니다</td></tr>';
                        $('#itemtbody1').append(noDataMessage);
                    } else {
                        for (var i = 0; i < result.length; i++) {
                            var row = '<tr>' +
                                '<td>' + result[i].materialname + '</td>' +
                                '<td>' + result[i].width + '</td>' +
                                '<td>' + result[i].length + '</td>' +
                                '<td>' + result[i].supplier + '</td>' +
                                '<td class="data-width">' + result[i].width + '</td>' +
                                '<td class="data-usewidth">' + result[i].usewidth + '</td>' +
                                '<td class="data-length">' + result[i].length + '</td>' +
                                '<td class="data-sqmprice">' + result[i].sqmprice + '</td>' +
                                '<td class="data-rollprice">' + result[i].rollprice + '</td>' +
                                '<td class="data-unit">' + result[i].unit + '</td>' +
                                '<td class="data-manufacterer">' + result[i].manufacterer + '</td>' +
                                '<td class="data-supplier">' + result[i].supplier + '</td>' +
                                '<td class="data-typecategory">' + result[i].typecategory + '</td>' +
                                '<td class="data-codenumber">' + result[i].codenumber + '</td>' +
                                '<td>' + result[i].num + '</td>' +
                                '<td><button class="btninfo" onclick="insertmaterialdata(this)" >추가</button></td>' +
                                '</tr>';

                            $('#itemtbody1').append(row);
                        }

                        // 한 번의 선택으로 모든 숨길 요소를 처리합니다.
                        $('#itemtbody1').find('.data-width, .data-usewidth, .data-length, .data-sqmprice, .data-rollprice, .data-unit, .data-manufacterer, .data-supplier, .data-codenumber').hide();
                    }
                }
            });

        }
        function searchingmaterial1() {

            var cavitySaveValue = $("#cavity-save").val();

            if (cavitySaveValue === '') {
                // Show alert when cavity-save is empty
                Swal.fire({
                    icon: 'error',
                    title: '누락',
                    text: `CAVITY가 누락되었습니다.`,
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: '확인',
                    background: '#f4f4f4',
                    customClass: {
                        title: 'my-title',
                        content: 'my-content',
                    },
                    padding: '2rem',
                    width: '500px',
                }).then((result) => { });
                return;  // Stop further execution
            }
            $.ajax({
                type: 'POST',
                url: server + '/api/selectbommaterial',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    materialname: $('#itemcode1-input').val()
                }),
                success: function (result) {
                    $('#itemtbody1').empty();
                    for (var i = 0; i < result.length; i++) {
                        var row = '<tr>' +
                            '<td>' + result[i].materialname + '</td>' +
                            '<td>' + result[i].width + '</td>' +
                            '<td>' + result[i].length + '</td>' +
                            '<td>' + result[i].supplier + '</td>' +
                            '<td class="data-width">' + result[i].width + '</td>' +
                            '<td class="data-usewidth">' + result[i].usewidth + '</td>' +
                            '<td class="data-length">' + result[i].length + '</td>' +
                            '<td class="data-sqmprice">' + result[i].sqmprice + '</td>' +
                            '<td class="data-rollprice">' + result[i].rollprice + '</td>' +
                            '<td class="data-unit">' + result[i].unit + '</td>' +
                            '<td class="data-manufacterer">' + result[i].manufacterer + '</td>' +
                            '<td class="data-supplier">' + result[i].supplier + '</td>' +
                            '<td class="data-typecategory">' + result[i].typecategory + '</td>' +
                            '<td class="data-codenumber">' + result[i].codenumber + '</td>' +
                            '<td>' + result[i].num + '</td>' +
                            '<td><button class="btninfo" onclick="insertmaterialdata(this)" >추가</button></td>' +
                            '</tr>';

                        $('#itemtbody1').append(row);
                    }
                    // 한 번의 선택으로 모든 숨길 요소를 처리합니다.
                    $('#itemtbody1').find('.data-width, .data-usewidth, .data-length, .data-sqmprice, .data-rollprice, .data-unit, .data-manufacterer, .data-supplier, .data-codenumber').hide();
                }
            });

        }

        function saveprocessname() {
            $.ajax({
                url: server + '/api/insertprocessname',
                method: 'post',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    processname: $('#processname-input').val()
                }),
                success: function (data) {

                }
            });
            $('#processnametbody').empty()
            selectprocessname()
        }
        // 상세 정보 버튼에 대한 클릭 이벤트 처리
        $(document).on('click', '.btninfo', function () {
            // 클릭된 버튼이 속한 행(row)을 선택합니다.
            var rowData = $(this).closest('tr');

            // 행에 포함된 데이터 셀들을 선택하여 데이터를 가져옵니다.
            var customer = rowData.find('td:eq(0)').text();
            var modelname = rowData.find('td:eq(1)').text();
            var itemname = rowData.find('td:eq(2)').text();
            var itemcode = rowData.find('td:eq(3)').text();
            var processname = rowData.find('td:eq(9)').text();
            var bucakcustomer = rowData.find('td:eq(10)').text();
            var id = rowData.find('td:eq(11)').text();

            $('#customer').text(customer)
            $('#modelname').text(modelname)
            $('#itemname').text(itemname)
            $('#itemcode').text(itemcode)
            $('#processname').text(processname)
            $('#bucakcustomer').text(bucakcustomer)
            // $('#cutomer').text(customer)
            // $('#customer').text(customer)s
        });

        function openModal() {
            document.getElementById('modal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
            $('#itemcode-input').focus()
            $('#itemcode-input').val('')
            $('#accountdatatbody').empty()
            checkData()
        }


        function addRow() {

            var newRow = $('#bomtableBody tr:first').clone();
            $('#bomtableBody').append(newRow);
            var rowIndex = $('#bomtableBody tr').length - 1;

            newRow.find('input').each(function () {
                var originalId = $(this).attr('id');
                var newId = originalId.replace(/\d+$/, rowIndex);
                $(this).attr('id', newId);
            });

            newRow.find('#char-input').val($('#char-input:last').val());
            newRow.find('#onepidding-input').val($('#onepidding-input:first').val());
            newRow.find('#twopidding-input').val($('#twopidding-input:first').val());
            newRow.find('#ta-input').val($('#ta-input:first').val());
            newRow.find('#allta-input').val($('#allta-input:first').val());
            newRow.find('#loss-input').val($('#loss-input:first').val());
            newRow.find('#talength-input').val($('#talength-input:first').val());
            newRow.find('#cost-input').val('0');
            newRow.find('#rlcut-input').val('');
            newRow.find('#rlproduct-input').val('');
            newRow.find('#materialname-input').val('');
            newRow.find('#width-input').val('');
            newRow.find('#usewidth-input').val('');
            newRow.find('#length-input').val('');
            newRow.find('#sqmprice-input').val('');
            newRow.find('#rollprice-input').val('');
            newRow.find('#unit-input').val('');
            newRow.find('#manufacterer-input').val('');
            newRow.find('#supplier-input').val('');

            newRow.find('#hap-rlcut-input').val('');
            newRow.find('#hap-rlproduct-input').val('');
            newRow.find('#hap-materialname-input').val('');
            newRow.find('#hap-width-input').val('');
            newRow.find('#hap-usewidth-input').val('');
            newRow.find('#hap-length-input').val('');
            newRow.find('#hap-sqmprice-input').val('');
            newRow.find('#hap-rollprice-input').val('');
            newRow.find('#hap-unit-input').val('');
            newRow.find('#hap-manufacterer-input').val('');
            newRow.find('#hap-supplier-input').val('');
            newRow.find('#hap-codenumber-input').val('');
            newRow.find('#hap-cost-input').val('');
            newRow.find('#hap-rlcut-input').val('');
            newRow.find('#hap-rlproduct-input').val('');

            newRow.find('#materialwidth-input').val('');
            newRow.find('#usable-input').val('');
            newRow.find('#etc-input').val('');
            newRow.find('#codenumber-input').val('');
            newRow.find('#num-input').val('');
            newRow.find('#chk1-input').prop('checked', false);
            newRow.find('#chk2-input').prop('checked', false);
            newRow.find('#chk3-input').prop('checked', true);
            newRow.find('#check-input').prop('checked', false);
            newRow.find('#main-edit').prop('checked', false);
            newRow.find('#materialclassification-input').val('');
        }

        // $(document).on('click', '#RowBtnadd', function () {
        //     var newRow = '<tr><td>New Row</td><td><button id="RowBtnadd" class="rowadd-button">+</button></td></tr>';
        //     $(this).closest('tr').after(newRow);
        // });

        // $(document).on('click', '.rowadd-button', function () {
        //     var newRow =
        //         '<tr>' +
        //         '<td><button id="deleteRowBtn" class="close-button" style="background-color: red; color:white; ">삭제</button></td>' +
        //         '<td><button id="RowBtnadd" class="rowadd-button" style="background-color: #4f56b6; color:white; ">+</button></td>' +
        //         '<td><input type="checkbox" id="check-input" onchange="handleCheckboxChange(this)" style="text-align:right; width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>' +
        //         '<td><input type="text" id="char-input" style="text-align:right;" value="1" autocomplete="off"></td>' +
        //         '<td><input type="checkbox" id="main-edit" onchange="handleCheckboxChange(this)" style="text-align:right; width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>' +
        //         '<td><input type="text" id="materialname-input"  onkeypress="handleKeyPress1(event)" style="cursor: pointer;" value="" autocomplete="off"></td>' +
        //         '<td><input type="text" id="materialclassification-input" style="background-color:whitesmoke; "  value="" autocomplete="off"></td>' +
        //         '<td><input type="text" id="etc-input" value="" autocomplete="off"></td>' +
        //         '<td><input type="checkbox" onclick="handleCheckboxChange(this)" id="chk1-input" style="width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>' +
        //         '<td><input type="checkbox" onclick="handleCheckboxChange(this)" id="chk2-input" style="width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>' +
        //         '<td><input type="checkbox" onclick="handleCheckboxChange(this)" id="chk3-input" style="width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right;" id="materialwidth-input" oninput="updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost();" value="" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right;" id="useable-input" value="" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right;" id="onepidding-input" oninput="formatDecimalInput(this, 2); updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost();" value="0" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right;" id="twopidding-input" oninput="formatDecimalInput(this, 2); updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost();" value="0" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right; background-color: whitesmoke;" id="soyo-input" value="0" autocomplete="off" ></td>' +
        //         '<td><input type="text" style="text-align:right; background-color: whitesmoke;"  id="ta-input" oninput="updateSoyoValue()" value="1" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right;" id="allta-input" oninput="updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost(); formatDecimalInput(this, 2);" value="1" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right;" id="talength-input" oninput="formatDecimalInput(this, 2); updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost();" value="0" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right;" id="loss-input" oninput="formatDecimalInput(this, 2); updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost();" value="3" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right;" id="costloss-input" oninput="formatDecimalInput(this, 2); updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost();" value="3" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right; background-color: whitesmoke;" oninput="formatDecimalInput(this, 2); calculateCost();" id="cost-input" readonly value="0" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="rlcut-input"  autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="rlproduct-input"  value="" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="width-input" value="" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="usewidth-input" value="" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="length-input" value="" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="sqmprice-input" value="" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="rollprice-input" value="" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:center; background-color: whitesmoke;" readonly id="unit-input" value="" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:center; background-color: whitesmoke;" readonly id="manufacterer-input" value="" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:center; background-color: whitesmoke;" readonly id="supplier-input" value="" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="cavity-input" onchange="updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost();" autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:center; background-color: whitesmoke;" readonly id="codenumber-input"  autocomplete="off"></td>' +
        //         '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="num-input"  autocomplete="off"></td>' +
        //         '</tr>';

        //     // Insert new row below the clicked row
        //     $(this).closest('tr').after(newRow);
        // });
        // document.addEventListener('DOMContentLoaded', (event) => {
        //     document.getElementById('bomtableBody').addEventListener('click', function (event) {
        //         if (event.target && event.target.id === 'deleteRowBtn') {
        //             const row = event.target.closest('tr');
        //             row.parentNode.removeChild(row);
        //             console.log('123123123')
        //         }
        //     });
        // });
        function Bomsave() {

            function showMissingFieldAlert(fieldName, message) {
                Swal.fire({
                    icon: 'error',
                    title: '오류',
                    text: message,
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: '확인',
                    background: '#f4f4f4',
                    customClass: {
                        title: 'my-title',
                        content: 'my-content',
                    },
                    padding: '2rem',
                    width: '500px',
                });
            }

            if ($('#bomno-save').val() === '') {
                showMissingFieldAlert('BOMNO', 'BOMNO가 누락되었습니다');
                return;
            }
            if ($('#customer-save').val() === '') {
                showMissingFieldAlert('고객사', '고객사가 누락되었습니다');
                return;
            }
            if ($('#modelname-save').val() === '') {
                showMissingFieldAlert('모델명', '모델명이 누락되었습니다');
                return;
            }
            if ($('#itemname-save').val() === '') {
                showMissingFieldAlert('제품명', '제품명이 누락되었습니다');
                return;
            }
            if ($('#pcs-save').val() === '') {
                showMissingFieldAlert('PCS', 'PCS가 누락되었습니다');
                return;
            }
            if ($('#cavity-save').val() === '') {
                showMissingFieldAlert('cavity', 'cavity가 누락되었습니다');
                return;
            }
            if ($('#itemcode-save').val() === '') {
                showMissingFieldAlert('itemcode', '고객코드가 누락되었습니다');
                return;
            }
            if ($('#workpart-save').val() === '') {
                showMissingFieldAlert('공정구분', '공정구분이 누락되었습니다');
                return;
            }
            if ($('#working-save').val() === '') {
                showMissingFieldAlert('작업차수', '작업차수가 누락되었습니다');
                return;
            }
            if ($('#direction-save').val() === '') {
                showMissingFieldAlert('타발방향', '타발방향이 누락되었습니다');
                return;
            }
            if ($('#type-save').val() === '') {
                showMissingFieldAlert('type', 'type이 누락되었습니다');
                return;
            }


            let tableBody = document.getElementById('bomtableBody');
            if (tableBody) {
                let rowCount = tableBody.children.length;

                for (let i = 0; i < rowCount; i++) {
                    var materialname = $('#bomtableBody tr:eq(' + i + ') #materialname-input').val();
                    var materialwidth = $('#bomtableBody tr:eq(' + i + ') #materialwidth-input').val();
                    var onepidding = $('#bomtableBody tr:eq(' + i + ') #onepidding-input').val();
                    var twopidding = $('#bomtableBody tr:eq(' + i + ') #twopidding-input').val();
                    var char = $('#bomtableBody tr:eq(' + i + ') #char-input').val();
                    if (materialname === '' || materialwidth === '' || onepidding === '' || twopidding === '' || char === '') {
                        Swal.fire({
                            icon: 'error',
                            title: '누락',
                            text: `${i + 1}번째 필수 입력 항목이 누락되었습니다.`,
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: '확인',
                            background: '#f4f4f4',
                            customClass: {
                                title: 'my-title',
                                content: 'my-content',
                            },
                            padding: '2rem',
                            width: '500px',
                        }).then((result) => { });
                        return;
                    }
                }
            } else { }

            if (tableBody) {
                let rowCount = tableBody.children.length;

                for (let i = 0; i < rowCount; i++) {
                    var materialWidthValue = $('#bomtableBody tr:eq(' + i + ') #materialwidth-input').val();
                    var useWidthValue = $('#bomtableBody tr:eq(' + i + ') #usewidth-input').val();

                    if (parseFloat(materialWidthValue) > parseFloat(useWidthValue)) {
                        Swal.fire({
                            icon: 'error',
                            title: '오류',
                            text: `${i + 1}번째 원단폭이 유효폭보다 클 수 없습니다.`,
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: '확인',
                            background: '#f4f4f4',
                            customClass: {
                                title: 'my-title',
                                content: 'my-content',
                            },
                            padding: '2rem',
                            width: '500px',
                        }).then((result) => { });

                        return;
                    }
                }
            } else { }
            if ($('#bomid-edit').val()) {
                var insertdate = new Date().toISOString().slice(0, 10);
                Swal.fire({
                    icon: 'info',
                    title: 'BOM 정보 수정',
                    text: 'BOM정보(양산) 데이터를 수정하시겠습니까?',
                    showCancelButton: true, // 취소 버튼 표시
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: '확인',
                    cancelButtonText: '취소', // 취소 버튼 텍스트
                    background: '#f4f4f4',
                    customClass: {
                        title: 'my-title',
                        content: 'my-content',
                    },
                    padding: '2rem',
                    width: '500px',
                }).then((result) => {
                    if (result.isConfirmed) {

                        $.ajax({
                            type: 'POST',
                            url: server + '/api/updateiteminformation',
                            dataType: 'json',
                            async: false,
                            contentType: 'application/json',
                            data: JSON.stringify({
                                "bomno": $('#bomno-save').val(),
                                "modelname": $('#modelname-save').val(),
                                "itemname": $('#itemname-save').val(),
                                "customer": $('#customer-save').val(),
                                "itemcode": $('#itemcode-save').val(),
                                "pcs": $('#pcs-save').val(),
                                "cavity": $('#cavity-save').val(),
                                "direction": $('#direction-save').val(),
                                "workpart": $('#workpart-save').val(),
                                "additionalnotes": $('#additionalNote').val(),
                                "working": $('#working-save').val(),
                                "type": $('#type-save').val(),
                            }),
                            success: function (result) {
                            }
                        });

                        $.ajax({
                            type: 'POST',
                            url: server + '/api/updatebomstatus',
                            dataType: 'json',
                            async: false,
                            contentType: 'application/json',
                            data: JSON.stringify({
                                "bomid": $('#bomid-edit').val(),
                                "status": 'false'
                            }),
                            success: function (result) {
                            }
                        });



                        $('[id^="num-input"]').each(function (index) {
                            var cavity = $('#cavity-save').val();
                            var bomno = $('#bomno-save').val();
                            var model = $('#modelname-save').val();
                            var itemname = $('#itemname-save').val();
                            var materialname = $('[id^="materialname-input"]').eq(index).val();
                            var char = $('[id^="char-input"]').eq(index).val();
                            var main = $('[id^="main-edit"]').eq(index).prop('checked') ? '메인자재' : '';
                            var etc = $('[id^="etc-input"]').eq(index).val();
                            var materialwidth = parseFloat($('[id^="materialwidth-input"]').eq(index).val()) || 0;
                            var onepid = ($('[id^="onepidding-input"]').eq(index).val())
                            var twopid = ($('[id^="twopidding-input"]').eq(index).val())
                            var soyo = ($('[id^="soyo-input"]').eq(index).val())
                            var ta = ($('[id^="ta-input"]').eq(index).val())
                            var allta = ($('[id^="allta-input"]').eq(index).val())
                            var talength = ($('[id^="talength-input"]').eq(index).val())
                            var loss = ($('[id^="loss-input"]').eq(index).val())
                            var num = ($('[id^="num-input"]').eq(index).val());
                            var cavity = ($('[id^="cavity-input"]').eq(index).val());
                            var codenumber = ($('[id^="codenumber-input"]').eq(index).val());
                            var useable = ($('[id^="useable-input"]').eq(index).val());
                            var bomid = $('#bomid-save').val();
                            var costloss = ($('[id^="costloss-input"]').eq(index).val());
                            var chk1 = $('[id^="chk1-input"]').eq(index).prop('checked') ? true : false;
                            var chk2 = $('[id^="chk2-input"]').eq(index).prop('checked') ? true : false;
                            var chk3 = $('[id^="chk3-input"]').eq(index).prop('checked') ? true : false;

                            $.ajax({
                                type: 'POST',
                                url: server + '/api/bommasssavebommanagement',
                                dataType: 'json',
                                contentType: 'application/json',
                                data: JSON.stringify({
                                    "savedate": insertdate,
                                    "bomno": bomno,
                                    "model": model,
                                    "itemname": itemname,
                                    "materialname": materialname,
                                    "status": 'true',
                                    "char": char,
                                    "main": main,
                                    "etc": etc,
                                    "materialwidth": materialwidth,
                                    "onepid": onepid,
                                    "twopid": twopid,
                                    "ta": ta,
                                    "allta": allta,
                                    "talength": talength,
                                    "loss": loss,
                                    "cavity": cavity,
                                    "codenumber": codenumber,
                                    "useable": useable,
                                    "num": num,
                                    "costloss": costloss,
                                    "bomid": bomid,
                                    "chk1": chk1,
                                    "chk2": chk2,
                                    "chk3": chk3
                                }),
                                success: function (result) {
                                    // Handle success
                                },
                                error: function (error) {
                                    // Handle error
                                },
                            });
                        });

                        $('#overlay').fadeOut();
                        $('#modal').fadeOut();
                        Swal.fire({
                            icon: 'success',
                            title: 'Bom 수정 완료',
                            text: '데이터가 성공적으로 수정 되었습니다.',
                        }).then((result) => {
                            if (result.isConfirmed) {
                                load();
                            }
                        });
                    } else if (result.dismiss === Swal.DismissReason.cancel) {
                        // 취소 버튼이 클릭되었을 때 실행할 작업
                    }
                });

            } else {
                $.ajax({
                    type: 'POST',
                    url: server + '/api/selectbomno',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        "bomno": $('#bomno-save').val(),
                    }),
                    success: function (result) {
                        if (result && result.length > 0) {
                            // alert('BOM NO가 중복되었습니다.');
                            showMissingFieldAlert('BOMNO중복', 'BOMNO가 기존에 등록되었습니다');
                            return;
                        } else {
                        }
                    }
                });

                var insertdate = new Date().toISOString().slice(0, 10);
                var rowCount = $('#bomtableBody tr').length;
                for (var i = 0; i < rowCount; i++) {
                    $('#bomtableBody tr:eq(' + i + ') #num-input').val(i + 1);
                }

                var bomno = $('#bomno-save').val();
                var customer = $('#customer-save').val();
                var modelname = $('#modelname-save').val();
                var itemname = $('#itemname-save').val();
                var pcs = $('#pcs-save').val();
                var cavity = $('#cavity-save').val();
                var itemcode = $('#itemcode-save').val();
                var workpart = $('#workpart-save').val();
                var working = $('#working-save').val();
                var direction = $('#direction-save').val();
                var costsum = $('#costsum-save').val();
                var additionalnotes = $('#additionalNote').val();
                var type = $('#type-save').val();

                // if (bomno !== '' && modelname !== '') {
                if (bomno !== '') {
                    Swal.fire({
                        icon: 'info',
                        title: 'BOM 신규등록',
                        text: 'BOM정보(양산) 데이터를 저장하시겠습니까?',
                        showCancelButton: true, // 취소 버튼 표시
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: '확인',
                        cancelButtonText: '취소', // 취소 버튼 텍스트
                        background: '#f4f4f4',
                        customClass: {
                            title: 'my-title',
                            content: 'my-content',
                        },
                        padding: '2rem',
                        width: '500px',
                    }).then((result) => {
                        if (result.isConfirmed) {
                            $.ajax({
                                type: 'POST',
                                url: server + '/api/selectbomno',
                                dataType: 'json',
                                contentType: 'application/json',
                                data: JSON.stringify({
                                    "bomno": $('#bomno-save').val(),
                                }),
                                success: function (result) {

                                }
                            });
                            $.ajax({
                                type: 'POST',
                                url: server + '/api/bommasssaveiteminfo',
                                dataType: 'json',
                                contentType: 'application/json',
                                data: JSON.stringify({
                                    "insertdate": insertdate,
                                    "updatedate": insertdate,
                                    "bomno": bomno,
                                    "customer": customer,
                                    "modelname": modelname,
                                    "itemname": itemname,
                                    "pcs": pcs,
                                    "cavity": cavity,
                                    "itemcode": itemcode,
                                    "part": "양산",
                                    "workpart": workpart,
                                    "working": working,
                                    "direction": direction,
                                    "costsum": costsum,
                                    "additionalnotes": additionalnotes,
                                    "type": type,
                                    "itemprice": '0',
                                }),
                                success: function (result) {

                                }
                            });
                            $('[id^="num-input"]').each(function (index) {
                                var cavity = $('#cavity-save').val();
                                var bomno = $('#bomno-save').val();
                                var model = $('#modelname-save').val();
                                var itemname = $('#itemname-save').val();
                                var materialname = $('[id^="materialname-input"]').eq(index).val();
                                var char = $('[id^="char-input"]').eq(index).val();
                                var main = $('[id^="main-edit"]').eq(index).prop('checked') ? '메인자재' : '';
                                var etc = $('[id^="etc-input"]').eq(index).val();
                                var materialwidth = parseFloat($('[id^="materialwidth-input"]').eq(index).val()) || 0;
                                var onepid = ($('[id^="onepidding-input"]').eq(index).val())
                                var twopid = ($('[id^="twopidding-input"]').eq(index).val())
                                var soyo = ($('[id^="soyo-input"]').eq(index).val())
                                var ta = ($('[id^="ta-input"]').eq(index).val())
                                var allta = ($('[id^="allta-input"]').eq(index).val())
                                var talength = ($('[id^="talength-input"]').eq(index).val())
                                var loss = ($('[id^="loss-input"]').eq(index).val())
                                var num = ($('[id^="num-input"]').eq(index).val());
                                var cavity = ($('[id^="cavity-input"]').eq(index).val());
                                var codenumber = ($('[id^="codenumber-input"]').eq(index).val());
                                var useable = ($('[id^="useable-input"]').eq(index).val());
                                var bomid = $('#bomid-save').val();
                                var costloss = ($('[id^="costloss-input"]').eq(index).val());
                                var chk1 = $('[id^="chk1-input"]').eq(index).prop('checked') ? true : false;
                                var chk2 = $('[id^="chk2-input"]').eq(index).prop('checked') ? true : false;
                                var chk3 = $('[id^="chk3-input"]').eq(index).prop('checked') ? true : false;

                                $.ajax({
                                    type: 'POST',
                                    url: server + '/api/bommasssavebommanagement',
                                    dataType: 'json',
                                    contentType: 'application/json',
                                    data: JSON.stringify({
                                        "savedate": insertdate,
                                        "bomno": bomno,
                                        "model": model,
                                        "itemname": itemname,
                                        "materialname": materialname,
                                        "status": 'true',
                                        "char": char,
                                        "main": main,
                                        "etc": etc,
                                        "materialwidth": materialwidth,
                                        "onepid": onepid,
                                        "twopid": twopid,
                                        "ta": ta,
                                        "allta": allta,
                                        "talength": talength,
                                        "loss": loss,
                                        "cavity": cavity,
                                        "codenumber": codenumber,
                                        "useable": useable,
                                        "num": num,
                                        "costloss": costloss,
                                        "bomid": bomid,
                                        "chk1": chk1,
                                        "chk2": chk2,
                                        "chk3": chk3
                                    }),
                                    success: function (result) {
                                        // Handle success
                                    },
                                    error: function (error) {
                                        // Handle error
                                    },
                                });
                            });

                            $('#overlay').fadeOut();
                            $('#modal').fadeOut();
                            Swal.fire({
                                icon: 'success',
                                title: 'Bom 저장 완료',
                                text: '데이터가 성공적으로 저장 되었습니다.',
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    load();
                                }
                            });
                        } else if (result.dismiss === Swal.DismissReason.cancel) {
                            // 취소 버튼이 클릭되었을 때 실행할 작업
                        }
                    });



                }
            }



        }


        function bomchanged() {
            var bomnoSaveValue = $('#bomno-save').val().toUpperCase();
            var numericPart = parseInt(bomnoSaveValue.split('-')[1], 10);

            // Check if bomnoSaveValue is at least 3 characters long
            if (bomnoSaveValue.length >= 3) {
                var customerinitial = bomnoSaveValue.substring(0, 3);
                $.ajax({
                    type: 'POST',
                    url: server + '/api/selectcustomerinformationwhere',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        customerinitial: customerinitial
                    }),
                    success: function (result) {
                        $('#customer-save').val(result[0].customername);
                    }
                });
            }

            // Check if bomnoSaveValue is at least 5 characters long
            if (bomnoSaveValue.length >= 5) {
                // Use a regular expression to check if the middle part is numeric
                var middlePart = bomnoSaveValue.split('-')[1];
                if (/^\d+$/.test(middlePart)) {
                    $('#working-save').val(numericPart);
                } else {
                    $('#working-save').val('');
                }
            }
        }
        function handleCheckboxChange(checkbox) {
            // Get all checkboxes with the same class
            var checkboxes = document.getElementsByClassName('checkbox');

            // Loop through all checkboxes
            for (var i = 0; i < checkboxes.length; i++) {
                // If the checkbox is not the one clicked, uncheck it
                if (checkboxes[i] !== checkbox) {
                    checkboxes[i].checked = false;
                }
            }
        }

        function handleKeyPress(event) {
            if (event.key === "Enter") {
                openProductModal(event.target.value)

            }
        }
        function handleKeyPress1(event) {
            if (event.key === "Enter") {
                var parentRow = $(event.target).closest('tr');
                // Extract data from the parent row
                var rowData = parentRow.find('td').map(function () {
                    return $(this).text();
                }).get();
                var rowIndex = parentRow.index();
                $("#numericPart").val(rowIndex);

                searchingmaterial();

            }
        }

        function handleKeyPress2(event) {
            var parentRow = $(event.target).closest('tr');
            // Extract data from the parent row
            var rowData = parentRow.find('td').map(function () {
                return $(this).text();
            }).get();
            var rowIndex = parentRow.index();
            $("#numericPart").val(rowIndex);

            searchingmaterial();
        }
        function handleKeyPress3(event) {
            if (event.key === "Enter") {

                searchingmaterial1();

            }
        }

        // function habji() {
        //     var checkedMaterialnames = [];
        //     $('input[type="checkbox"]').each(function () {
        //         if (this.checked) {
        //             var materialnameValue = $(this).closest('tr').find('#materialname-input').val();
        //             checkedMaterialnames.push(materialnameValue);
        //         }
        //     });

        //     var concatenatedValue = checkedMaterialnames.join('+');

        //     if (checkedMaterialnames.length > 1) {
        //         concatenatedValue = checkedMaterialnames.slice(0, -1).join('+') + '+' + checkedMaterialnames.slice(-1) + '(합지)';
        //     }

        //     // Set the concatenated value to the etc-input in the same row
        //     $('input[type="checkbox"]').each(function () {
        //         if (this.checked) {
        //             $(this).closest('tr').find('#etc-input').val(concatenatedValue);
        //         }

        //     });
        //     $('input[type="checkbox"]').prop('checked', false);
        // }
        function habji() {
            // Collect checked rows and their relevant data
            var checkedRows = $('input[id="check-input"]:checked').map(function () {
                var row = $(this).closest('tr');
                var materialnameValue = row.find('#materialname-input').val();
                var materialWidthValue = row.find('#width-input').val();
                var useWidthValue = row.find('#usewidth-input').val();
                var lengthValue = row.find('#length-input').val();
                var sqmpriceValue = row.find('#sqmprice-input').val();
                var rollpriceValue = row.find('#rollprice-input').val();
                var unitValue = row.find('#unit-input').val();
                var manufactererValue = row.find('#manufacterer-input').val();
                var supplierValue = row.find('#supplier-input').val();
                var codenumberValue = row.find('#codenumber-input').val();
                return {
                    row: row,
                    materialnameValue: materialnameValue,
                    materialWidthValue: materialWidthValue,
                    useWidthValue: useWidthValue,
                    lengthValue: lengthValue,
                    sqmpriceValue: sqmpriceValue,
                    rollpriceValue: rollpriceValue,
                    unitValue: unitValue,
                    manufactererValue: manufactererValue,
                    supplierValue: supplierValue,
                    codenumberValue: codenumberValue
                };
            }).get();

            // Check if exactly two rows are selected
            if (checkedRows.length === 2) {
                var concatenatedValue = checkedRows[0].materialnameValue + '+' + checkedRows[1].materialnameValue;

                // Update the first row with concatenated value and clear the second row's inputs
                checkedRows[0].row.find('#materialname-input').val(concatenatedValue);
                checkedRows[0].row.find('#materialclassification-input').val('HAP');
                checkedRows[1].row.find('#materialname-input').val('');
                checkedRows[1].row.find('#materialaname-input').val('');
                checkedRows[1].row.find('#materialclassification-input').val('');
                checkedRows[1].row.find('#cost-input').val('');
                checkedRows[1].row.find('#rlcut-input').val('');
                checkedRows[1].row.find('#rlproduct-input').val('');
                checkedRows[1].row.find('#width-input').val('');
                checkedRows[1].row.find('#usewidth-input').val('');
                checkedRows[1].row.find('#length-input').val('');
                checkedRows[1].row.find('#sqmprice-input').val('');
                checkedRows[1].row.find('#rollprice-input').val('');
                checkedRows[1].row.find('#unit-input').val('');
                checkedRows[1].row.find('#manufacterer-input').val('');
                checkedRows[1].row.find('#supplier-input').val('');
                checkedRows[1].row.find('#hap-cost-input').val('');
                checkedRows[1].row.find('#hap-rlcut-input').val('');
                checkedRows[1].row.find('#hap-rlproduct-input').val('');
                checkedRows[1].row.find('#hap-width-input').val('');
                checkedRows[1].row.find('#hap-usewidth-input').val('');
                checkedRows[1].row.find('#hap-length-input').val('');
                checkedRows[1].row.find('#hap-sqmprice-input').val('');
                checkedRows[1].row.find('#hap-rollprice-input').val('');
                checkedRows[1].row.find('#hap-unit-input').val('');
                checkedRows[1].row.find('#hap-manufacterer-input').val('');
                checkedRows[1].row.find('#hap-supplier-input').val('');
                checkedRows[1].row.find('#hap-rlcut-input').val('');
                checkedRows[1].row.find('#hap-rlproduct-input').val('');
                checkedRows[1].row.find('#codenumber-input').val('');
                checkedRows[1].row.find('#num-input').val('');
                checkedRows[1].row.find('#materialwidth-input').val('');
                checkedRows[1].row.find('#onepidding-input').val('');
                checkedRows[1].row.find('#costsum-input').val('');

                // Additional update and focus on the first row
                checkedRows[0].row.find('#materialwidth-input').val('');
                checkedRows[0].row.find('#materialwidth-input').focus();

                // Update the hap fields in the first row
                checkedRows[0].row.find('#hap-materialname-input').val(checkedRows[1].materialnameValue);
                checkedRows[0].row.find('#hap-width-input').val(checkedRows[1].materialWidthValue);
                checkedRows[0].row.find('#hap-usewidth-input').val(checkedRows[1].useWidthValue);
                checkedRows[0].row.find('#hap-length-input').val(checkedRows[1].lengthValue);
                checkedRows[0].row.find('#hap-sqmprice-input').val(checkedRows[1].sqmpriceValue);
                checkedRows[0].row.find('#hap-rollprice-input').val(checkedRows[1].rollpriceValue);
                checkedRows[0].row.find('#hap-unit-input').val(checkedRows[1].unitValue);
                checkedRows[0].row.find('#hap-manufacterer-input').val(checkedRows[1].manufactererValue);
                checkedRows[0].row.find('#hap-supplier-input').val(checkedRows[1].supplierValue);
                checkedRows[0].row.find('#hap-codenumber-input').val(checkedRows[1].codenumberValue);

                // Uncheck all checked checkboxes
                $('input[id="check-input"]:checked').prop('checked', false);
            } else {
                // Show an error message if exactly two rows are not selected
                Swal.fire({
                    icon: 'error',
                    title: '자재 선택 오류',
                    text: '합지는 2개 선택 시 가능합니다',
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Optional: Add any additional actions if needed
                    }
                });
            }
        }






        function habji1() {
            var checkedMaterialnames = [];
            $('input[type="checkbox"]').each(function () {
                if (this.checked) {
                    var materialnameValue = $(this).closest('tr').find('#materialname-edit').val();
                    checkedMaterialnames.push(materialnameValue);
                }
            });

            // Concatenate the checked materialnames with '+' and add "합지" between the last two
            var concatenatedValue = checkedMaterialnames.join('+');

            if (checkedMaterialnames.length > 1) {
                concatenatedValue = checkedMaterialnames.slice(0, -1).join('+') + '+' + checkedMaterialnames.slice(-1) + '(합지)';
            }

            // Set the concatenated value to the etc-input in the same row
            $('input[type="checkbox"]').each(function () {
                if (this.checked) {
                    $(this).closest('tr').find('#etc-edit').val(concatenatedValue);
                }

            });
            $('input[type="checkbox"]').prop('checked', false);
        }
        function handleDoubleClick() {
            var parentRow = $(event.target).closest('tr');
            // Extract data from the parent row
            var rowData = parentRow.find('td').map(function () {
                return $(this).text();
            }).get();
            var rowIndex = parentRow.index();
            $("#numericPart").val(rowIndex);
            var cavitySaveValue = $("#cavity-save").val();

            if (cavitySaveValue === '') {
                // Show alert when cavity-save is empty
                Swal.fire({
                    icon: 'error',
                    title: '누락',
                    text: `CAVITY가 누락되었습니다.`,
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: '확인',
                    background: '#f4f4f4',
                    customClass: {
                        title: 'my-title',
                        content: 'my-content',
                    },
                    padding: '2rem',
                    width: '500px',
                }).then((result) => { });
                return;  // Stop further execution
            }



            document.getElementById('modal1').style.display = 'block';
            document.getElementById('overlay1').style.display = 'block';

            $('#searchingmaterialinfobody-edit').empty()
            $("#materialnameinput-edit").val('')
            $("#materialnameinput-edit").focus()

            var currentRow = $(event.target).closest('tr');

            var rowIndex = currentRow.index();



            $("#numericPart-edit").val(rowIndex);
        }
        function insertmaterialdata(button) {
            document.getElementById('modal1').style.display = 'none';
            document.getElementById('overlay1').style.display = 'none';

            var parentRow = $(button).closest('tr');

            var rowData = parentRow.find('td').map(function () {
                return $(this).text();
            }).get();

            console.log(rowData); // 행 데이터 확인

            var rowIndex = $('#numericPart').val();
            var targetRow = $('#bomtableBody tr:eq(' + rowIndex + ')');

            // Ensure the row exists
            if (targetRow.length === 0) {
                console.error('Specified row does not exist');
                return;
            }
            console.log(rowIndex)
            // Update the materialname-input in the specified row
            targetRow.find('#materialname-input').val(rowData[0]);
            targetRow.find('#materialaname-input').val(rowData[0]);
            targetRow.find('#materialclassification-input').val(rowData[12]);
            targetRow.find('#width-input').val(rowData[4]);
            targetRow.find('#usewidth-input').val(rowData[5]);
            targetRow.find('#length-input').val(rowData[6]);
            targetRow.find('#sqmprice-input').val(rowData[7]);
            targetRow.find('#rollprice-input').val(rowData[8]);
            targetRow.find('#unit-input').val(rowData[9]);
            targetRow.find('#manufacterer-input').val(rowData[10]);
            targetRow.find('#supplier-input').val(rowData[11]);
            targetRow.find('#codenumber-input').val(rowData[13]);
            targetRow.find('#num-input').val(parseFloat(rowIndex) + 1);

            var useWidth = parseFloat(targetRow.find('#usewidth-input').val().replace(/,/g, '')) || 0;
            var materialWidth = parseFloat(targetRow.find('#materialwidth-input').val().replace(/,/g, '')) || 0;

            targetRow.find('.rlcut-input').val(Math.floor(useWidth / materialWidth));

            let lengthValue = parseFloat(targetRow.find('#length-input').val()) || 0;
            let rlcutValue = parseFloat(targetRow.find('#rlcut-input').val()) || 0;
            let cavitySaveValue = parseFloat(targetRow.find('#cavity-input').val()) || 0;
            let onepiddingValue = parseFloat(targetRow.find('#onepidding-input').val()) || 0;
            let taLengthValue = parseFloat(targetRow.find('#talength-input').val()) || 0;
            let twopiddingValue = parseFloat(targetRow.find('#twopidding-input').val()) || 0;
            let alltaValue = parseFloat(targetRow.find('#allta-input').val()) || 0;
            let lossValue = parseFloat(targetRow.find('#loss-input').val()) || 0;

            let rlproductValue = ((lengthValue * 1000 * rlcutValue * cavitySaveValue * (1 + (lossValue / 100))) / ((onepiddingValue + taLengthValue + twopiddingValue) / alltaValue)).toFixed(0);
            targetRow.find('#rlproduct-input').val(rlproductValue);

            const rollpriceInput = targetRow.find('#rollprice-input');
            const rollpriceValue = parseFloat(rollpriceInput.val().replace(/,/g, '')) || 0;
            const costValue = rollpriceValue / rlproductValue;

            targetRow.find('#cost-input').val(costValue.toFixed(2));
        }

        function insertmaterialdataedit(row) {
            document.getElementById('materialnamesearchedit').style.display = 'none';
            var rowData = $(row).find('td').map(function () {
                return $(this).text();
            }).get();

            // Assuming rowIndex is the index of the row where you want to update the materialname-input
            var rowIndex = $('#numericPart-edit').val()

            // Update the materialname-input in the specified row
            $('#bomtableBody-edit tr:eq(' + rowIndex + ') #materialname-edit').val(rowData[0]);
            $('#bomtableBody-edit tr:eq(' + rowIndex + ') #materialclassification-edit').val(rowData[12]);
            $('#bomtableBody-edit tr:eq(' + rowIndex + ') #width-edit').val(rowData[4]);
            $('#bomtableBody-edit tr:eq(' + rowIndex + ') #usewidth-edit').val(rowData[5]);
            $('#bomtableBody-edit tr:eq(' + rowIndex + ') #length-edit').val(rowData[6]);
            $('#bomtableBody-edit tr:eq(' + rowIndex + ') #sqmprice-edit').val(rowData[7]);
            $('#bomtableBody-edit tr:eq(' + rowIndex + ') #rollprice-edit').val(rowData[8]);
            $('#bomtableBody-edit tr:eq(' + rowIndex + ') #unit-edit').val(rowData[9]);
            $('#bomtableBody-edit tr:eq(' + rowIndex + ') #manufacterer-edit').val(rowData[10]);
            $('#bomtableBody-edit tr:eq(' + rowIndex + ') #supplier-edit').val(rowData[11]);
            $('#bomtableBody-edit tr:eq(' + rowIndex + ') #codenumber-edit').val(rowData[13]);

            $('#bomtableBody tr:eq(' + rowIndex + ') #rlcut-edit').val(
                Math.floor(
                    parseFloat($('#bomtableBody tr:eq(' + rowIndex + ') #usewidth-edit').val().replace(/,/g, '')) /
                    parseFloat($('#bomtableBody tr:eq(' + rowIndex + ') #materialwidth-edit').val().replace(/,/g, ''))
                )
            );
            let lengthValue = parseFloat($('#bomtableBody tr:eq(' + rowIndex + ') #length-edit').val())
            let rlcutValue = parseFloat($('#bomtableBody tr:eq(' + rowIndex + ') #rlcut-edit').val())
            let cavitySaveValue = parseFloat($('#bomtableBody tr:eq(' + rowIndex + ') #cavity-edit').val())
            let onepiddingValue = parseFloat($('#bomtableBody tr:eq(' + rowIndex + ') #onepidding-edit').val())
            let taLengthValue = parseFloat($('#bomtableBody tr:eq(' + rowIndex + ') #talength-edit').val())
            let twopiddingValue = parseFloat($('#bomtableBody tr:eq(' + rowIndex + ') #twopidding-edit').val())
            let alltaValue = parseFloat($('#bomtableBody tr:eq(' + rowIndex + ') #allta-edit').val())
            let lossValue = parseFloat($('#bomtableBody tr:eq(' + rowIndex + ') #loss-edit').val())

            // Calculate rlproduct-input value
            let rlproductValue = ((lengthValue * 1000 * rlcutValue * cavitySaveValue * (1 + (lossValue / 100))) / ((onepiddingValue + taLengthValue + twopiddingValue) / alltaValue)).toFixed(0);

            // Update rlproduct-input value
            $('#bomtableBody-edit tr:eq(' + rowIndex + ') #rlproduct-edit').val(rlproductValue);

            const rollpriceInput = $('#bomtableBody-edit tr:eq(' + rowIndex + ') #rollprice-edit');
            const rollpriceValue = parseFloat(rollpriceInput.val().replace(/,/g, '')) || 0;

            // Calculate cost value
            const costValue = rollpriceValue / rlproductValue;

            // Update cost-input value
            $('#bomtableBody-edit tr:eq(' + rowIndex + ') #cost-edit').val(costValue.toFixed(2));
        }

        function onlyNumberKey(event) {
            // Only allows number keys, backspace, delete, left and right arrows
            const charCode = event.which ? event.which : event.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                return false;
            }
            return true;
        }
    </script>


</body>

</html>
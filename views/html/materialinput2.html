<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="/css/accountinformation.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/buttons/2.0.1/css/buttons.dataTables.min.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.dataTables.min.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.4/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/select/1.3.4/css/select.dataTables.min.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript"
        src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/select/1.3.4/js/dataTables.select.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.0.1/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.html5.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.print.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.colVis.min.js"></script>

    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script type="text/javascript" src="qrcode.js"></script>
</head>
<style>
    .box1 {
        /* float: left; */
        width: 100%;
        /* height: 100px; */
        background-color: white;
        border: 0.5px rgb(177, 173, 173) solid;
        text-align: center;
    }

    .box2 {
        width: 100%;
        height: 100%;
        background-color: white;
        border: 0.5px rgb(177, 173, 173) solid;
        text-align: center;
        /* margin-left: 10px; */
    }
</style>


<body>



    <div style="height:50px; border: 1px solid black;">
        <p style="margin-left:20px; margin-top:10px; font-size: 20px; font-weight: bold;">자재-자재입고</p>
    </div>



    <div class="box1">
        <div class="box1-1" style="width: 100%; height:30px; background-color:navy;">
            <a style="color: white; text-align:center; font-size: 24px;">자재정보</a>
        </div>
        <table id="fileinfo" class="display" style="width:100%; height:200px;">
            <thead>
                <tr>


                    <th> </th>
                    <th>원자재명</th>
                    <th>원자재코드</th>
                    <th>분류</th>
                    <th>자재폭(mm)</th>
                    <th>고객사</th>
                    <th>유수명</th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <div class="box2">
        <div class="box1-1" style="width: 100%; height:30px; background-color:navy;">
            <a style="color: white; text-align:center; font-size: 24px;">자재입고현황</a>
            <!-- <button onclick="aaa()">add</button> -->
        </div>
        <table id="fileinfo1" class="display" style="width:100%">
            <thead>
                <tr>
                    <th> </th>
                    <th>입고날짜</th>
                    <th>자재명</th>
                    <th>LOTNO.</th>
                    <th>제조일자</th>
                    <th>만료일자</th>
                    <th>자재폭(mm)</th>
                    <th>수량(M)</th>

                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="fileinfobody">
            </tbody>
        </table>
    </div>


    <div id="addEmployeeModal" class="modal fade">
        <div class="modal-dialog" style="width: 1800px;">
            <div class="modal-content">
                <form>
                    <div class="modal-header">
                        <h4 class="modal-title">원자재입고</h4>

                    </div>

                    <div class="modal-body">
                        <div class="form-group">
                            <label>원자재명:</label>
                            <input type="text" class="form-control" id="materialname" required>
                        </div>
                        <div class="form-group">
                            <label>원자재코드:</label>
                            <input type="text" class="form-control" id="materialcode" required>
                        </div>
                        <div class="form-group">
                            <label>분류:</label>
                            <input type="text" class="form-control" id="classification" required>
                        </div>
                        <div class="form-group">
                            <label>자재폭:</label>
                            <input type="text" class="form-control" id="materialwidth" required>
                        </div>
                        <div class="form-group">
                            <label>거래처:</label>
                            <input type="text" class="form-control" id="customer" required>
                        </div>
                        <div class="form-group">
                            <label>유수명:</label>
                            <input type="text" class="form-control" id="day" required>
                        </div>
                        <div class="form-group">
                            <label>LOTNO.:</label>
                            <input type="text" class="form-control" id="lotno" required>
                        </div>
                        <div class="form-group">
                            <label>수량:</label>
                            <input type="text" class="form-control" id="quantity" required>
                        </div>
                        <div class="form-group">
                            <label>롤:</label>
                            <input type="text" class="form-control" id="roll" required>
                        </div>
                        <div class="form-group">
                            <label>제조일자:</label>
                            <input type="date" class="form-control" id="datepicker1" required>
                        </div>


                    </div>

                    <div class="modal-footer">
                        <input type="button" class="btn btn-default" data-dismiss="modal" value="취소">
                        <input type="button" data-dismiss="modal" id="addbutton" class="btn btn-success" value="저장">
                    </div>
                </form>
            </div>
        </div>
    </div>





</body>




<script>

</script>
<script type="text/javascript">
    $(document).ready(function () {
        settingDate()



        $.ajax({
            url: 'http://techonmes.co.kr/api/materialoption',
            method: 'post',
            dataType: 'json',
            success: function (data) {
                $('#fileinfo1').dataTable({
                    deferLender: true,
                    lengthMenu: [2, 4, 6],
                    paging: true,
                    sort: true,
                    pageLength: 5,
                    searching: true,
                    data: data,
                    responsive: true,
                    deferLoading: [0, 10],
                    columns: [



                        { "data": "id" },
                        { "data": "date" },
                        { "data": "materialname" },
                        { "data": "lotno" },
                        { "data": "manufacturedate" },
                        { "data": "expirationdate" },
                        { "data": "materialwidth" },
                        { "data": "quantity" }
                    ],
                    columnDefs: [

                        {
                            targets: 0,
                            visible: false
                        },
                        {
                            targets: 8,
                            data: null,
                            defaultContent: '<button id="openModaldelete" class="btn btn-primary" style="background-color:red;"  > 삭제 </button>',
                            width: 70
                        }

                    ],
                    createdRow: function (row, data, index) {




                    },
                    "language": {
                        emptyTable: "데이터가 없습니다.",
                        lengthMenu: "페이지당 _MENU_ 개씩 보기",
                        info: "현재 _START_ - _END_ / _TOTAL_건",
                        infoEmpty: "데이터 없음",
                        infoFiltered: "( _MAX_건의 데이터에서 필터링됨 )",
                        search: "검색:",
                        zeroRecords: "일치하는 데이터가 없습니다.",
                        loadingRecords: "로딩중...",
                        processing: "잠시만 기다려 주세요.",
                        paginate: {
                            next: "다음",
                            previous: "이전",
                        },
                    },
                    destroy: true,
                });
            }, error: function (response) {
                alert(response.responseText);
            }
        });


        $.ajax({
            url: 'http://techonmes.co.kr/api/materialbase',
            method: 'post',
            dataType: 'json',
            success: function (data) {
                $('#fileinfo').dataTable({
                    deferLender: true,
                    lengthMenu: [5, 10, 15],
                    paging: true,
                    sort: true,
                    pageLength: 5,
                    searching: true,
                    data: data,
                    responsive: true,
                    deferLoading: [0, 10],
                    columns: [



                        { "data": "id" },
                        { "data": "materialname" },
                        { "data": "codenumber" },
                        { "data": "classification" },
                        { "data": "fullwidth" },
                        { "data": "customer" },
                        { "data": "day" }
                    ],
                    columnDefs: [

                        {
                            targets: 0,
                            visible: false
                        },
                        {
                            targets: 7,
                            data: null,
                            defaultContent: '<a href="#addEmployeeModal" class="edit" data-toggle="modal"><i class="material-icons" data-toggle="tooltip" title="Edit">&#xE254;</i></a>',
                            width: 70
                        }

                    ],
                    createdRow: function (row, data, index) {

                        // Updated Schedule Week 1 - 07 Mar 22

                        // if (data.possible == '가능') {
                        //     $('td:eq(7)', row).css('background-color', 'lime');  //Original Date\
                        //     $('td:eq(7)', row).css('color', 'black');  //Original Date\
                        // } else {
                        //     $('td:eq(7)', row).css('background-color', 'Red');  //Original Date\
                        //     $('td:eq(7)', row).css('color', 'white');  //Original Date\
                        // }


                    },
                    "language": {
                        emptyTable: "데이터가 없습니다.",
                        lengthMenu: "페이지당 _MENU_ 개씩 보기",
                        info: "현재 _START_ - _END_ / _TOTAL_건",
                        infoEmpty: "데이터 없음",
                        infoFiltered: "( _MAX_건의 데이터에서 필터링됨 )",
                        search: "검색:",
                        zeroRecords: "일치하는 데이터가 없습니다.",
                        loadingRecords: "로딩중...",
                        processing: "잠시만 기다려 주세요.",
                        paginate: {
                            next: "다음",
                            previous: "이전",
                        },
                    },
                    destroy: true,
                });
            }, error: function (response) {
                alert(response.responseText);
            }
        });
    });
    $.ajax({
        url: 'http://techonmes.co.kr/api/materialbase',
        method: 'post',
        dataType: 'json',
        success: function (data) {
            $('#fileinfo3').dataTable({
                deferLender: true,
                lengthMenu:false,
                autoWidth: false,
                paging: true,
                sort: true,
                pageLength: 10,
                searching: true,
                data: data,
                responsive: true,
                deferLoading: [0, 10],
              
                columns: [



                    { "data": "id" },
                    { "data": "materialname" },
                    { "data": "codenumber" },
                    { "data": "classification" },
                    { "data": "fullwidth" },
                    { "data": "customer" },
                    { "data": "day" }
                ],
                columnDefs: [

                    {
                        targets: 0,
                        visible: false
                    },
                    {
                        targets: 7,
                        data: null,
                        defaultContent: '<a href="#addEmployeeModal" class="edit" data-toggle="modal"><i class="material-icons" data-toggle="tooltip" title="Edit">&#xE254;</i></a>',
                        width: 70
                    }

                ],
                createdRow: function (row, data, index) {

                    // Updated Schedule Week 1 - 07 Mar 22

                    // if (data.possible == '가능') {
                    //     $('td:eq(7)', row).css('background-color', 'lime');  //Original Date\
                    //     $('td:eq(7)', row).css('color', 'black');  //Original Date\
                    // } else {
                    //     $('td:eq(7)', row).css('background-color', 'Red');  //Original Date\
                    //     $('td:eq(7)', row).css('color', 'white');  //Original Date\
                    // }


                },
                "language": {
                    emptyTable: "데이터가 없습니다.",
                    lengthMenu: "페이지당 _MENU_ 개씩 보기",
                    info: "현재 _START_ - _END_ / _TOTAL_건",
                    infoEmpty: "데이터 없음",
                    infoFiltered: "( _MAX_건의 데이터에서 필터링됨 )",
                    search: "검색:",
                    zeroRecords: "일치하는 데이터가 없습니다.",
                    loadingRecords: "로딩중...",
                    processing: "잠시만 기다려 주세요.",
                    paginate: {
                        next: "다음",
                        previous: "이전",
                    },
                },
                destroy: true,
            });
        }, error: function (response) {
            alert(response.responseText);
        }
    });

</script>
<script type="text/javascript">



    $('#fileinfo tbody').on('click', 'a', function () {
        table1 = $('#fileinfo').DataTable();
        var data1 = table1.row($(this).parents('tr')).data(); // getting 

        $('#materialname').val(data1.materialname);
        $('#materialcode').val(data1.codenumber);
        $('#classification').val(data1.classification);
        $('#materialwidth').val(data1.fullwidth);
        $('#customer').val(data1.customer);
        $('#day').val(data1.day);




    });

    // $('#fileinfo1 tbody').on('click', 'button', function () {
    //     table1 = $('#fileinfo1').DataTable();
    //     var row = table1.row($(this).parents('tr'));
    //     var rowNode = row.node();
    //     row.remove();

    // });


    function SomeDeleteRowFunction(o) {
        //no clue what to put here?
        var p = o.parentNode.parentNode;
        p.parentNode.removeChild(p);
    }


    $('#myModalsave').on('shown.bs.modal', function () {
        var table = $('#fileinfo').DataTable();
        table.columns.adjust();
    });

    // 숫자 컴마표시
    function inputNumberFormat(obj) {
        obj.value = comma(uncomma(obj.value));
    }
    // 숫자 컴마 제거후 int 변경
    function comma(str) {
        str = String(str);
        return str.replace(/(\d)(?=(?:\d{3})+(?!\d))/g, '$1,');
    }
    function uncomma(str) {
        str = String(str);
        return str.replace(/[^\d]+/g, '');
    }
    ///////=====================



    $('#addEmployeeModal').on('shown.bs.modal', function () {



        // $('#count').val('')
        $('#count').focus();
    })

    function settingDate() {
        const date = new Date();

        var day = date.getDate();
        var month = date.getMonth() + 1;
        var year = date.getFullYear();



        if (month === 1 || month === 2 || month === 3 || month === 4 || month === 5 || month === 6 || month === 7 || month === 8 || month === 9) {
            month = '0' + month

        }

        if (day === 1 || day === 2 || day === 3 || day === 4 || day === 5 || day === 6 || day === 7 || day === 8 || day === 9) {
            day = '0' + day

        }


        // This arrangement can be altered based on how we want the date's format to appear.
        let currentDate = `${year}-${month}-${day}`;
        console.log(year + month + day)

        $('#datepicker1').val(currentDate);


    }
    document.getElementById("addbutton").addEventListener('click', hello);

    function hello() {

        const date = new Date();

        var day = date.getDate();
        var month = date.getMonth() + 1;
        var year = date.getFullYear();

        console.log((month).length, day.length)

        if (month === 1 || month === 2 || month === 3 || month === 4 || month === 5 || month === 6 || month === 7 || month === 8 || month === 9) {
            month = '0' + month
            console.log(month)
        }

        if (day === 1 || day === 2 || day === 3 || day === 4 || day === 5 || day === 6 || day === 7 || day === 8 || day === 9) {
            day = '0' + day
            console.log(day)
        }


        // This arrangement can be altered based on how we want the date's format to appear.
        let currentDate = `${year}-${month}-${day}`;

        var materialname = $('#materialname').val();
        var materialcode = $('#materialcode').val();
        var materialwidth = $('#materialwidth').val();
        var manufacturedate = $('#datepicker1').val();
        var materialday = $('#day').val();
        var customer = $('#customer').val();
        var lotno = $('#lotno').val();
        var roll = $('#roll').val();
        var quantity = $('#quantity').val();

        var today = new Date();
        var dd = String(today.getDate()).padStart(2, '0');
        var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
        var yyyy = today.getFullYear();

        today = yyyy + '-' + mm + '-' + dd

        var sumdate = new Date(Date.parse(manufacturedate) + parseInt(materialday) * 1000 * 60 * 60 * 24);
        var sumdd = String(sumdate.getDate()).padStart(2, '0');
        var summm = String(sumdate.getMonth() + 1).padStart(2, '0'); //January is 0!
        var sumyyyy = sumdate.getFullYear();

        var resultdate = sumyyyy + '-' + summm + '-' + sumdd


        if (confirm("원자재입고 정보를 등록 하시겠습니까??") == true) {
            for (i = 0; i < roll; i++) {
                $.ajax({
                    type: 'POST',
                    url: 'http://techonmes.co.kr/api/materialinputsave',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        "materialname": materialname,
                        "codenumber": materialcode,
                        "manufacturedate": manufacturedate,
                        "expirationdate": resultdate,
                        "materialwidth": materialwidth,
                        "date": currentDate,
                        "lotno": lotno,
                        "quantity": quantity


                    }),
                    success: function (result) {
                        // tableInsert();

                    }
                })

            }


            alert("등록이 완료 되었습니다.");




        } else {
            return false;
        }

        $.ajax({
            url: 'http://techonmes.co.kr/api/materialoption',
            method: 'post',
            dataType: 'json',
            success: function (data) {
                $('#fileinfo1').dataTable({
                    deferLender: true,
                    lengthMenu: [2, 4, 6],
                    paging: true,
                    sort: true,
                    pageLength: 5,
                    searching: true,
                    data: data,
                    responsive: true,
                    deferLoading: [0, 10],
                    columns: [



                        { "data": "id" },
                        { "data": "date" },
                        { "data": "materialname" },
                        { "data": "lotno" },
                        { "data": "manufacturedate" },
                        { "data": "expirationdate" },
                        { "data": "materialwidth" },
                        { "data": "quantity" }
                    ],
                    columnDefs: [

                        {
                            targets: 0,
                            visible: false
                        },
                        {
                            targets: 8,
                            data: null,
                            defaultContent: '<a href="#addEmployeeModal"  class="edit" data-toggle="modal"><i class="material-icons"  data-toggle="tooltip" title="추가">&#xE254;</i></a>',
                            width: 70
                        }

                    ],
                    createdRow: function (row, data, index) {




                    },
                    "language": {
                        emptyTable: "데이터가 없습니다.",
                        lengthMenu: "페이지당 _MENU_ 개씩 보기",
                        info: "현재 _START_ - _END_ / _TOTAL_건",
                        infoEmpty: "데이터 없음",
                        infoFiltered: "( _MAX_건의 데이터에서 필터링됨 )",
                        search: "검색:",
                        zeroRecords: "일치하는 데이터가 없습니다.",
                        loadingRecords: "로딩중...",
                        processing: "잠시만 기다려 주세요.",
                        paginate: {
                            next: "다음",
                            previous: "이전",
                        },
                    },
                    destroy: true,
                });
            }, error: function (response) {
                alert(response.responseText);
            }
        });




    };











</script>
<script>

</script>

<script type="text/javascript">

    function save_open() {
        if ($('#accountname').val() === '') {

            alert("거래처가 누락되었습니다.");
            return
        }
        if (confirm("고객사 :" + $('#accountname').val() + ", 납기일 :" + $('#datepicker1').val() + " 영업 수주 정보를 등록 하시겠습니까??") == true) {

            const $table = document.getElementById('fileinfo1'); // table 엘리먼트 취득

            console.log($table.rows.length);  // 3, 행 갯수 출력

            const trGroup = Array.from(document.querySelectorAll('#fileinfo1 tr'));

            const textGroup = trGroup.map(tr => {
                return Array.from(tr.children).map(input => input.textContent);
            });
            var now = new Date();	// 현재 날짜 및 시간
            var year = now.getFullYear();//202302271130 2023127112916
            var month = parseInt(now.getMonth()) + 1;	// 월
            var date = now.getDate();	// 일
            var hours = now.getHours();	// 시간
            var minutes = now.getMinutes();	// 분
            var seconds = now.getSeconds();	// 초




            for (var i = 0; i < $table.rows.length - 1; i++) {

                var accountdate = $('#datepicker1').val();
                var customer = $('#accountname').val();
                var modelname = textGroup[i + 1][0];
                var itemname = textGroup[i + 1][1];
                var itemprice = textGroup[i + 1][2];
                var quantity = textGroup[i + 1][3];
                var number2 = quantity.replace(/,/g, "");
                var price = textGroup[i + 1][4];
                var number3 = price.replace(/,/g, "");

                var C = $('#countsum').val();
                var countsum = C.replace(/,/g, "");

                var P = $('#pricesum').val();
                var pricesum = P.replace(/,/g, "");

                let currentDate = `${year}${month}${date}${hours}${minutes}${seconds}`;
                $.ajax({
                    type: 'POST',
                    url: 'http://techonmes.co.kr/api/openinsertdata',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        "accountdate": accountdate,
                        "deliverydate": accountdate,
                        "customer": customer,
                        "modelname": modelname,
                        "itemname": itemname,
                        "itemprice": itemprice,
                        "quantity": number2,
                        "price": number3,
                        "contentname": currentDate,
                        "countsum": countsum,
                        "pricesum": pricesum



                    }),
                    success: function (result) {
                        console.log(result)
                    }
                })

            }
            $('#accountname').val('');
            $('#pricesum').val('0');
            $('#countsum').val('0');
            settingDate()
            $('#fileinfobody').empty()
            alert("저장이 완료 되었습니다.");






        } else {
            return false;
        }


    }

    //체크박스 클릭 아이디찾기
    $(document).on('click', "#deletbtn", function (e) {
        var str = "";
        var tdArr = new Array();// 배열 선언            
        var checkBtn = $(this);

        var tr = checkBtn.parent().parent();
        var td = tr.children();

        // tr.text()는 클릭된 Row 즉 tr에 있는 모든 값을 가져온다.

        // 반복문을 이용해서 배열에 값을 담아 사용할 수 도 있다.
        td.each(function (i) {
            tdArr.push(td.eq(i).text());
        });



        // td.eq(index)를 통해 값을 가져올 수도 있다.

        var D = td.eq(3).text();
        var E = td.eq(4).text();



        var countsum = $('#countsum').val();
        var number3 = uncomma(countsum)
        var number4 = uncomma(D)
        var finalcountsum = parseInt(number3) - parseInt(number4)
        var a = finalcountsum.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",")
        $('#countsum').val(a);

        var pricesum = $('#pricesum').val();
        var number1 = uncomma(pricesum)
        var number2 = uncomma(E)
        var finalpricesum = parseInt(number1) - parseInt(number2)
        var b = finalpricesum.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",")
        $('#pricesum').val(b);

    })
    // $('#addEmployeeModal').on('shown.bs.modal', function () {
    //     var table = $('#fileinfo3').DataTable();
    //     table.columns.adjust();
    // });

    // $('#addEmployeeModal').on('shown.bs.modal', function (e) {
    //     var table = $('#fileinfo3').DataTable();
    //     table.columns.adjust();
    // })
    // $(document).on('click', ".adjust", function (e) {
    //     var table = $('#fileinfo3').DataTable();
    //     table.adjust();
    //     console.log(11)
    // });



</script>
<script>
    $("#addEmployeeModal").on("shown.bs.modal", function () {
        var table = $('#fileinfo3').DataTable();
        table.columns.adjust();
    });
</script>

</html>
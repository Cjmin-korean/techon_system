<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Local IP Address</title>
    <script>
        function getLocalIP(callback) {
            // Create a hidden iframe
            var iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            document.body.appendChild(iframe);

            // Run WebRTC in the iframe context
            var win = iframe.contentWindow;
            var RTCPeerConnection = win.RTCPeerConnection || win.mozRTCPeerConnection || win.webkitRTCPeerConnection;
            var useWebKit = !!win.webkitRTCPeerConnection;

            if (!RTCPeerConnection) {
                // WebRTC is not supported in this browser
                callback(null);
                return;
            }

            // Minimal requirements for data connection
            var mediaConstraints = {
                optional: [{RtpDataChannels: true}]
            };

            var servers = {iceServers: [{urls: 'stun:stun.services.mozilla.com'}]};

            var pc = new RTCPeerConnection(servers, mediaConstraints);

            // Create a bogus data channel
            pc.onicecandidate = function (ice) {
                if (ice.candidate) {
                    // Extract IP address from candidate
                    var ip = /([0-9]{1,3}(\.[0-9]{1,3}){3})/.exec(ice.candidate.candidate)[1];
                    callback(ip);
                    // Disconnect after finding the first IP address
                    pc.onicecandidate = null;
                    pc.close();
                    document.body.removeChild(iframe);
                }
            };

            // Create an offer (this will trigger the icecandidate event)
            pc.createDataChannel('');
            pc.createOffer(function (result) {
                pc.setLocalDescription(result, function () {}, function () {});
            }, function () {});

            // Wait for a while to let the ice candidate get triggered
            setTimeout(function () {
                if (pc.iceGatheringState === 'complete') {
                    if (pc.localDescription) {
                        // Extract IP address from local description
                        var ip = /([0-9]{1,3}(\.[0-9]{1,3}){3})/.exec(pc.localDescription.sdp)[1];
                        callback(ip);
                    } else {
                        callback(null);
                    }
                    document.body.removeChild(iframe);
                }
            }, 1000);
        }

        document.addEventListener('DOMContentLoaded', function () {
            getLocalIP(function (ip) {
                if (ip) {
                    document.getElementById('local-ip').textContent = 'Your local IP address is: ' + ip;
                } else {
                    document.getElementById('local-ip').textContent = 'Could not determine local IP address.';
                }
            });
        });
    </script>
</head>
<body>
    <h1>Your Local IP Address</h1>
    <p id="local-ip">Loading...</p>
</body>
</html>

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BOM관리</title>
  <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="../css/main.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css">

</head>
<style>
  .notification {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #f0f0f0;
    padding: 10px;
    border-radius: 4px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    z-index: 9999;
    display: flex;
    align-items: center;
  }

  .notification img {
    width: 100px;
    height: 50px;
    margin-right: 10px;
  }

  .notification-message {
    font-size: 16px;
    color: #333;
  }
</style>

<body>



  <div class="main_header">
    <a>BOM관리</a>

    <button class="styled-button" style="width: 7%; height: 40px; float: right;" onclick="New()">품목(item)추가</button>
  </div>
  <div id="loadingOverlay">
    <img src="/img/테크온로고.PNG" alt="로딩 이미지" class="loadingImage">

  </div>



  <!-- 등록창 -->
  <div style="display: flex; ">
    <div id="popupOverlay" style="display: none;">
      <div id="popupContent" style="width: 80%; height: 100%;">
        <div class="form-group">
          <table style="width: 35%; height: 50%; float: left; ">
            <tr>
              <td colspan="2" class="popup_title">제품 정보</td>
            </tr>
            <!-- <tr>
              <td style="width: 200px">BOMNO</td>
              <td><input type="text" id="itemcode-edit" class="data" autocomplete="off"
                  style="font:10px; font-weight:bold; width:50%; border:1px solid silver;"></td>
            </tr>
            <tr>
              <td style="width: 200px">모델명</td>
              <td><input type="text" id="itemcode-edit" class="data" autocomplete="off"
                  style="font:10px; font-weight:bold; width:50%; border:1px solid silver;"></td>
            </tr> -->
            <tr>
              <td style="width: auto; height: 20px; background-color: whitesmoke;">BOMNO.</td>
              <td><input type="text" id="bomno" class="data" autocomplete="off"
                  style="width:auto; font-size: 16px; font-weight: bold; "></td>

            </tr>
            <tr>
              <td style="width: auto; background-color: whitesmoke;">모델명</td>
              <td><input type="text" id="modelname" class="data" autocomplete="off"
                  style="width:auto; font-size: 16px; font-weight: bold;"></td>

            </tr>
            <tr>
              <td style="width: auto; background-color: whitesmoke;">제품명</td>
              <td><input type="text" id="partname" class="data" autocomplete="off"
                  style="width:auto; font-size: 16px; font-weight: bold;"></td>

            </tr>
            <tr>
              <td style="width: auto; background-color: whitesmoke; ">구분</td>
              <td>
                <select id="production"
                  style="padding: 5px; width:100%; border-radius: 5px; font-size: 16px; font-weight: bold; ">

                  <option value="양산">양산</option>
                  <option value="샘플">샘플</option>
                </select>
              </td>


            </tr>
            <tr>
              <td style="width: auto; background-color: whitesmoke;">단가(원)</td>
              <td><input type="text" id="unitprice" class="data" autocomplete="off" readonly
                  style="width:auto; font-size: 16px; font-weight: bold;"></td>

            </tr>
            <tr>
              <td style="width: auto; background-color: whitesmoke;">원가(원)</td>
              <td>
                <input type="text" id="cost" class="data" autocomplete="off" readonly
                  style="width:auto; font-size: 16px; font-weight: bold;">
              </td>
            </tr>

            <tr>
              <td style="width: auto; background-color: whitesmoke;">재료비(%)</td>
              <td><input type="text" id="percent" class="data" autocomplete="off" readonly value="0"
                  style="width:auto; font-size: 16px; font-weight: bold;"></td>

            </tr>
            <tr>
              <td style="width: auto; background-color: whitesmoke;">고객사</td>
              <td>
                <select id="customer-select"
                  style="padding: 5px; width:100%; border-radius: 5px; font-size: 16px; font-weight: bold; ">

                  <option value=""></option>

                </select>

            </tr>
            <tr>
              <td style="width: auto; background-color: whitesmoke;">고객사코드</td>
              <td><input type="text" id="customercode" class="data" autocomplete="off"
                  style="width:auto; font-size: 16px; font-weight: bold;"></td>

            </tr>


            <tr>
              <td style="width: auto; background-color: whitesmoke;">공용코드</td>
              <td><input type="text" id="allcode" class="data" autocomplete="off"
                  style="width:auto; font-size: 16px; font-weight: bold;"></td>

            </tr>
            <tr>
              <td style="width: auto; background-color: whitesmoke;">작업차수</td>
              <td> <select id="tool"
                  style="padding: 5px; width:100%; border-radius: 5px;  font-size: 16px; font-weight: bold;">

                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>

                </select></td>

            </tr>
            <tr>
              <td style="width: auto; background-color: whitesmoke;">작업방식</td>
              <td><input type="text" id="toolmain" class="data" autocomplete="off"
                  style="width:auto; font-size: 16px; font-weight: bold;"></td>

            </tr>
            <tr>
              <td style="width: auto; background-color: whitesmoke;">Cavity(EA)</td>
              <td>
                <input type="text" id="cavity" class="data" autocomplete="off" placeholder="필수 입력항목 입니다"
                  style="width:auto; font-size: 16px; font-weight: bold;"
                  oninput="this.value = validateNumber(this.value);">
              </td>
            </tr>


            <tr>
              <td style="width: auto; background-color: whitesmoke; ">1차피딩(mm)</td>
              <td><input type="text" id="onepid" class="data" autocomplete="off" placeholder="필수 입력항목 입니다"
                  style="width:auto; font-size: 16px; font-weight: bold;"
                  oninput="this.value = validateNumber(this.value);"></td>

            </tr>
            <tr>
              <td style="width: auto; background-color: whitesmoke; ">2차피딩(mm)</td>
              <td><input type="text" id="twopid" class="data" autocomplete="off" placeholder="필수 입력항목 입니다"
                  style="width:auto; font-size: 16px; font-weight: bold;"
                  oninput="this.value = validateNumber(this.value);"></td>

            </tr>
            <tr>
              <td style="width: auto; background-color: whitesmoke; ">Loss율(%)</td>
              <td><input type="text" id="loss" class="data" autocomplete="off" placeholder="필수 입력항목 입니다"
                  style="width:auto; font-size: 16px; font-weight: bold;"
                  oninput="this.value = validateNumber(this.value);"></td>

            </tr>
            <tr>
              <td style="width: auto; background-color: whitesmoke; ">2차피딩계산용1</td>
              <td><input type="text" id="twopid1" class="data" autocomplete="off" placeholder="필수 입력항목 입니다"
                  style="width:auto; font-size: 16px; font-weight: bold;"
                  oninput="this.value = validateNumber(this.value);"></td>

            </tr>
            <tr>
              <td style="width: auto; background-color: whitesmoke;">2차피딩계산용2</td>
              <td><input type="text" id="twopid2" class="data" autocomplete="off" placeholder="필수 입력항목 입니다"
                  style="width:auto;  font-size: 16px; font-weight: bold;"
                  oninput="this.value = validateNumber(this.value);"></td>

            </tr>


          </table>


          <div
            style="width:64%; height: 80%;; max-height: 80%; overflow-y: scroll; float: right; border: 1px solid silver;">
            <table class="styled-table" id="datatable">
              <!-- <div class="form-group"  style="width:64%; height: 80%;; max-height: 80%; overflow-y: scroll; float: right; border: 1px solid silver;">
            <table style="width: 100%; height: auto; " id="datatable"> -->
              <thead>

                <tr>
                  <td colspan="6" class="popup_title">제품 BOM 정보</td>
                  <td>
                    <button id="material_search"
                      style="cursor:pointer; font-weight: bold; background-color: navy; color: white; border: none; border-radius: 4px; padding: 8px; width: 100%; height: 100%;">자재조회</button>
                  </td>
                  <td>
                    <button id="hapji" onclick="mergeSelectedRows()"
                      style="cursor:pointer; font-weight: bold; background-color: rgb(18, 90, 72); color: white; border: none; border-radius: 4px; padding: 8px; width: 100%; height: 100%;">합지</button>
                  </td>
                </tr>


                <tr>
                  <th style="width: 20px;"></th>
                  <th>자재명</th>
                  <th>원단폭(mm)</th>
                  <th>소요량(SQM)</th>
                  <th>D피딩</th>
                  <th>원가(원)</th>
                  <th>메인자재</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="materialalltabletbody">
              </tbody>
              <tfoot style="background-color: #d4d4d4;">
                <tr>
                  <td style="background-color: whitesmoke; padding: 10px;">기타사항</td>
                  <td colspan="7">
                    <input type="text" id="bomno" class="data" autocomplete="off"
                      style="width: 98%; font-size: 16px; font-weight: bold; padding: 6px; border: 1px solid #ccc; border-radius: 4px;">
                  </td>
                </tr>
              </tfoot>


            </table>
          </div>
        </div>
        <button id="popupCloseBtn-save-close">취소</button>
        <button id="popupCloseBtn-save" onclick="Datasave()">저장</button>
      </div>


      <br>




    </div>
  </div>









  <!-- <div>
    <table class="styled-table" id="POdatatable"> -->
  <div id="datatable-container">

    <table class="styled-table" id="POdatatable">
      <thead>

        <tr>
          <th style=" width: auto;" onclick="sortTable(0)">BOMNO</th>
          <th style=" width: auto;" onclick="sortTable(1)">구분</th>
          <th style=" width: auto;" onclick="sortTable(2)">모델명</th>
          <th style=" width: auto;" onclick="sortTable(3)">품목명</th>
          <th style=" width: auto;" onclick="sortTable(4)">납품처</th>
          <th style=" width: auto;" onclick="sortTable(5)">제품코드</th>
          <th style=" width: auto;" onclick="sortTable(6)">최초등록날짜</th>
          <th style=" width: auto;" onclick="sortTable(7)">최초수정날짜</th>
          <th style=" width:auto;"></th>
          <th style=" width:auto;"></th>
        </tr>
      </thead>
      <tbody id="PODatatbody">
      </tbody>
    </table>
  </div>
  <!-- 품목조회창 -->

  <!-- <div id="popupContent">
      <div class="form-group" style="max-height: 600px; overflow-y: scroll;">
        <table style="width: 100%; height: auto;" id="Materialdatatable"> -->
  <!-- <div id="popupOverlay3" style="display: none;">

    <div id="popupContent">
      <div class="form-group">
        <table style="width:100%;">
          <thead>
            <tr>
              <td colspan="6" class="popup_title">자재(Material)정보</td>
            </tr>
            <tr>
              <td style="width: 200px; background-color: whitesmoke; color: black;">자재검색</td>
              <td><input type="text" id="myInput1" onkeydown="handleKeyPress(event)" class="data" autocomplete="off"
                  placeholder="입력 후 Enter 눌러주세요" style="width:100%; border:1px solid silver;"></td>

              </td>
            </tr>
            <tr>
              <th>자재코드</th>
              <th>자재채번</th>
              <th>자재분류</th>
              <th>전폭(mm)</th>
              <th>SQM단가</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="MaterialDatatbody">
          </tbody>
        </table>
      </div>


    </div>
    <button id="popupCloseBtn-search-close">닫기</button>
  </div> -->

  <div id="popupOverlay3" style="display: none;">

    <div id="popupContent">
      <div class="form-group">
        <table style="width:100%;">

          <thead>

            <tr>
              <td colspan="6" class="popup_title">제품 BOM 정보</td>
              <td>
                <button id="material_search"
                  style="cursor:pointer; font-weight: bold; background-color: navy; color: white; border: none; border-radius: 4px; padding: 8px; width: 100%; height: 100%;">자재조회</button>
              </td>
              <td>
                <button id="hapji" onclick="mergeSelectedRows()"
                  style="cursor:pointer; font-weight: bold; background-color: rgb(18, 90, 72); color: white; border: none; border-radius: 4px; padding: 8px; width: 100%; height: 100%;">합지</button>
              </td>
            </tr>


            <tr>
              <th style="width: 20px;"></th>
              <th>자재명</th>
              <th>원단폭(mm)</th>
              <th>소요량(SQM)</th>
              <th>D피딩</th>
              <th>원가(원)</th>
              <th>메인자재</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="materialalltabletbody">
          </tbody>



        </table>
      </div>
    </div>
  </div>


  <!-- 수정창 -->
  <div id="popupOverlay1" style="display: none;">
    <div id="popupContent1" style="width: 700px; height: 550px;">
      <div class="form-group">
        <table style="width:100%;">
          <tr>
            <td style="background-color: black; color: white;">PO Item 등록</td>
            <td style="visibility: hidden;"><input type="text" id="id-edit" class="data" autocomplete="off"
                style="width:100%; border:1px solid silver; "></td>

          </tr>
          <tr>
            <td style="width: 200px">품목코드</td>
            <td><input type="text" id="itemcode-edit" class="data" autocomplete="off" readonly
                style="width:100%; border:1px solid silver;"></td>
          </tr>
          <tr>
            <td style="width: 200px">BOMNO</td>
            <td><input type="text" id="bomno-edit" class="data" autocomplete="off" readonly
                style="width:100%; border:1px solid silver;"></td>
          </tr>
          <tr>
            <td style="width: 200px">모델명</td>
            <td><input type="text" id="modelname-edit" class="data" autocomplete="off" readonly
                style="width:100%; border:1px solid silver;"></td>
          </tr>
          <tr>
            <td style="width: 200px">제품명</td>
            <td><input type="text" id="itemname-edit" class="data" autocomplete="off" readonly
                style="width:100%; border:1px solid silver;"></td>
          </tr>
          <tr>
            <td style="width: 200px">고객사</td>
            <td><input type="text" id="customer-edit" class="data" autocomplete="off" readonly
                style="width:100%; border:1px solid silver;"></td>
          </tr>
          <tr>
            <td style="width: 200px">단가(원)</td>
            <td><input type="text" id="itemprice-edit" class="data" autocomplete="off" readonly
                style="width:100%; border:1px solid silver;"></td>
          </tr>
          <tr>
            <td style="width: 200px; background-color: whitesmoke; ">원가(원)</td>
            <td><input type="text" id="cost-edit" class="data" autocomplete="off" readonly
                style="width:100%; border:1px solid silver;"></td>
          </tr>
          <tr>
            <td style="width: 200px">재료비(%)</td>
            <td><input type="text" id="costpg-edit" class="data" autocomplete="off" readonly
                style="width:100%; border:1px solid silver;"></td>
          </tr>
          <tr>
            <td style="width: 200px; background-color: whitesmoke; color: blue;">PO수량</td>
            <td><input type="text" id="count-edit" class="data" autocomplete="off"
                style="width:100%; border:1px solid silver;"></td>
          </tr>


        </table>
      </div>
      <button id="popupCloseBtn-edit-close">취소</button>
      <button id="popupCloseBtn-edit" onclick="Dataedit()">추가</button>
    </div>
  </div>


  <!-- 영업수량수정창 -->
  <div id="popupOverlay4" style="display: none;">
    <div id="popupContent4" style="width: 700px; height: 550px;">
      <div class="form-group">
        <table style="width:100%;">
          <tr>
            <td style="background-color: black; color: white;">PO Item 수정</td>
            <td><input type="text" id="id-POedit" class="data" autocomplete="off"
                style="width:100%; border:1px solid silver; "></td>

          </tr>
          <tr>
            <td style="width: 200px">품목코드</td>
            <td><input type="text" id="itemcode-POedit" class="data" autocomplete="off" readonly
                style="width:100%; border:1px solid silver;"></td>
          </tr>
          <tr>
            <td style="width: 200px">BOMNO</td>
            <td><input type="text" id="bomno-POedit" class="data" autocomplete="off" readonly
                style="width:100%; border:1px solid silver;"></td>
          </tr>
          <tr>
            <td style="width: 200px">모델명</td>
            <td><input type="text" id="modelname-POedit" class="data" autocomplete="off" readonly
                style="width:100%; border:1px solid silver;"></td>
          </tr>
          <tr>
            <td style="width: 200px">제품명</td>
            <td><input type="text" id="itemname-POedit" class="data" autocomplete="off" readonly
                style="width:100%; border:1px solid silver;"></td>
          </tr>
          <tr>
            <td style="width: 200px">고객사</td>
            <td><input type="text" id="customer-POedit" class="data" autocomplete="off" readonly
                style="width:100%; border:1px solid silver;"></td>
          </tr>
          <tr>
            <td style="width: 200px">단가(원)</td>
            <td><input type="text" id="itemprice-POedit" class="data" autocomplete="off" readonly
                style="width:100%; border:1px solid silver;"></td>
          </tr>
          <tr>
            <td style="width: 200px; background-color: whitesmoke; ">원가(원)</td>
            <td><input type="text" id="cost-POedit" class="data" autocomplete="off" readonly
                style="width:100%; border:1px solid silver;"></td>
          </tr>

          <tr>
            <td style="width: 200px; background-color: whitesmoke; color: blue;">PO수량</td>
            <td><input type="text" id="count-POedit" class="data" autocomplete="off"
                style="width:100%; border:1px solid silver;"></td>
          </tr>


        </table>
        <tbody>

        </tbody>
      </div>
      <button id="popupCloseBtn-POedit-close">취소</button>
      <button id="popupCloseBtn-POedit" onclick="PODataedit()">수정</button>
    </div>
  </div>
  <!-- 삭제창 -->
  <div id="popupOverlay5" style="display: none;">
    <div id="popupContent5" style="width: 700px; height: auto;">
      <div class="form-group">
        <table style="width:100%;">
          <tr>
            <td style="background-color: black; color: white; width: 200px;">품목 정보 삭제</td>
            <td><input type="text" id="id-edit3" class="data" autocomplete="off"
                style="width:100%; border:1px solid silver; "></td>
            <!-- style="visibility: hidden;" -->
          </tr>
          <tr>
            <td colspan="2" class="popup_title">품목 정보를 삭제하시겠습니까?</td>
          </tr>

        </table>
      </div>
      <button id="popupCloseBtn-delete-close1">취소</button>
      <button id="popupCloseBtn-delete" onclick="Datadelte()">삭제</button>
    </div>
  </div>

  <!-- 삭제창 -->
  <div id="popupOverlay2" style="display: none;">
    <div id="popupContent2" style="width: 700px; height: auto;">
      <div class="form-group">
        <table style="width:100%;">
          <tr>
            <td style="background-color: black; color: white; width: 200px;">BOM자재 추가</td>
          </tr>
          <tr>
            <td style="width: 200px; background-color: whitesmoke; ">자재명</td>
            <td><input type="text" id="materialname" class="data" autocomplete="off" readonly
                style="width:100%; border:1px solid silver;"></td>
          </tr>
          <tr>
            <td style="width: 200px; background-color: whitesmoke; ">소요자재폭(mm)</td>
            <td><input type="text" id="materialwidth" class="data" autocomplete="off"
                style="width:100%; border:1px solid silver;"></td>
          </tr>
          <tr>
            <td style="width: 200px; background-color: whitesmoke; ">D피딩(mm)</td>
            <td><input type="text" id="dpidding" class="data" autocomplete="off"
                style="width:100%; border:1px solid silver;"></td>
          </tr>
          <tr>
            <td style="width: 200px; background-color: whitesmoke; ">SQM단가(원)</td>
            <td><input type="text" id="sqmprice" class="data" autocomplete="off" readonly
                style="width:100%; border:1px solid silver;"></td>
          </tr>

        </table>
      </div>
      <button id="popupCloseBtn-delete-close">취소</button>
      <button id="popupCloseBtn-delete" class="materialadd" onclick="Materailadd()">추가</button>
    </div>
  </div>

  <script>
    var server = '';

    if (window.location.hostname == 'localhost') {
      server = 'http://localhost:8080';
    } else {
      server = 'http://techonmes.co.kr';
    }
    $(document).ready(function () {
      showLoading()
      load()




      $('#POdatatable').on('click', '.datadelete1', function () {
        var str = "";
        var tdArr = new Array();// 배열 선언            
        var checkBtn = $(this);

        var tr = checkBtn.parent().parent();
        var td = tr.children();


        var id = td.eq(10).text();
        $('#id-edit3').val(id)
        $('#popupOverlay5').fadeIn()
      })

      $('#POdatatable').on('click', '.data-content', function () {
        var str = "";
        var tdArr = new Array();// 배열 선언            
        var checkBtn = $(this);

        var tr = checkBtn.parent().parent();
        var td = tr.children();

        var accountname = td.eq(2).text();
        var dd = td.eq(1).text();

        $('#popupOverlaycontent').fadeIn()
        $('#customer-content').val(accountname)

        $.ajax({
          type: 'POST',
          url: server + '/api/POaccountinputponum',
          dataType: 'json',
          contentType: 'application/json',
          data: JSON.stringify({
            ponum: td.eq(3).text()
          }),
          success: function (result) {
            for (var i = 0; i < result.length; i++) {
              $('#POdatatbody-content-tbody').empty()
              $('#POdatatable-content').append(
                '<tr>' +
                '<td>' + result[i].itemcode + '</td>' +
                '<td>' + result[i].bomno + '</td>' +
                '<td>' + result[i].modelname + '</td>' +
                '<td>' + result[i].itemname + '</td>' +
                '<td>' + result[i].customer + '</td>' +
                '<td>' + result[i].itemcost + '</td>' +
                '<td>' + result[i].itemprice + '</td>' +
                '<td>' + result[i].quantity + '</td>' +
                '<td>' + result[i].price + '</td>' +
                '<td><a class="data-edit"  style="cursor:pointer; color:blue;">수정</a></td>' +
                '<td><a class="data-edit"  style="cursor:pointer; color:red;">삭제</a></td>' +
                '</tr>'

              )

            }

          }

        })

        $('#datepicker-content').val(dd)
        var total8 = 0;
        var total9 = 0;
        $('#POdatatable-content td:nth-child(8)').each(function () {
          var count8 = parseFloat($(this).text().replace(/,/g, ''));
          if (!isNaN(count8)) {
            total8 += count8;
          }
        });

        $('#POdatatable-content td:nth-child(9)').each(function () {
          var count9 = parseFloat($(this).text().replace(/,/g, ''));
          if (!isNaN(count9)) {
            total9 += count9;
          }
        });
        // 합계 표시
        $('#POdatatable-content tfoot').remove(); // 기존의 tfoot 제거
        $('#POdatatable-content').append(
          '<tfoot>' +
          '<tr>' +
          '<td style="border:1px solid silver; background-color:whitesmoke;"colspan="7">합계</td>' +
          '<td style="border:1px solid silver; text-align:right;"><strong>' + addCommas(total8.toFixed(0)) + '</strong></td>' +
          '<td style="border:1px solid silver; text-align:right;"><strong>' + addCommas(total9.toFixed(0)) + '</strong></td>' +
          '<td style="border:1px solid silver; background-color:whitesmoke; "colspan="2"></td>' +
          '</tr>' +
          '</tfoot>'
        );
      })

      $('#Podatatable').on('click', '.data-edit', function () {
        var str = "";
        var tdArr = new Array();// 배열 선언            
        var checkBtn = $(this);

        var tr = checkBtn.parent().parent();
        var td = tr.children();

        var itemcode = td.eq(0).text();
        var bomno = td.eq(1).text();
        var modelname = td.eq(2).text();
        var itemname = td.eq(3).text();
        var customer = td.eq(4).text();
        var itemprice = td.eq(5).text();
        var cost = td.eq(6).text();
        var costpg = td.eq(7).text();
        var id = td.eq(10).text();

        $('#itemcode-edit').val(itemcode)
        $('#bomno-edit').val(bomno)
        $('#modelname-edit').val(modelname)
        $('#itemname-edit').val(itemname)
        $('#customer-edit').val(customer)
        $('#itemprice-edit').val(itemprice)
        $('#cost-edit').val(cost)
        $('#costpg-edit').val(costpg)
        $('#id-edit').val(id)
        $('#count-edit').val('')

        $('#popupOverlay1').fadeIn();
        $('#count-edit').focus()
      });

      $('#POdatatable').on('click', '.databomedit', function () {
        var str = "";
        var tdArr = new Array();// 배열 선언            
        var checkBtn = $(this);

        var tr = checkBtn.parent().parent();
        var td = tr.children();

        var bomno = td.eq(0).text();
        var production = td.eq(1).text();
        var modelname = td.eq(2).text();
        var itemname = td.eq(3).text();
        var customer = td.eq(4).text();
        var itemcode = td.eq(5).text();
        var working = td.eq(11).text();
        var cavity = td.eq(12).text();
        var onepidding = td.eq(13).text();
        var twopidding = td.eq(14).text();
        var twopidding1 = td.eq(15).text();
        var twopidding2 = td.eq(16).text();
        var rev = td.eq(17).text();
        var cost = td.eq(18).text();




        $('#materialalltabletbody').empty()
        $.ajax({
          type: 'POST',
          url: server + '/api/bommanagement1',
          dataType: 'json',
          contentType: 'application/json',
          data: JSON.stringify({
            bomno: bomno
          }),

          success: function (result) {
            console.log(result)
            for (var i = 0; i < result.length; i++) {
              $('#datatable').append(
                '<tr>' +
                '<td></td>' +
                '<td>' + result[i].materialname + '</td>' +
                '<td style="text-align:right;">' + result[i].swidth + '</td>' +
                '<td style="text-align:right;">' + result[i].mwidth + '</td>' +
                '<td style="text-align:right;">' + result[i].dpid + '</td>' +
                '<td style="text-align:right;">' + result[i].cost + '</td>' +
                '<td ><select id ="production' + (i + 1) + '" style = "padding: 5px; width:100%; border-radius: 5px;">' +
                '<option value=""></option>' +
                '<option value="메인자재"' + (result[i].classification === '메인자재' ? ' selected' : '') + '>메인자재</option>' +

                '</select></td>' +
                '<td><a class="databomdelete"  style="cursor:pointer; color:red;">삭제</a></td>' +
                '</tr>'

              )

            }

          }

        })

        var tbody = document.getElementById('materialalltabletbody');
        tbody.innerHTML = '';
        var total8 = 0;
        var total9 = 0;
        $('#Podatatable td:nth-child(8)').each(function () {
          var count8 = parseFloat($(this).text().replace(/,/g, ''));
          if (!isNaN(count8)) {
            total8 += count8;
          }
        });

        $('#Podatatable td:nth-child(9)').each(function () {
          var count9 = parseFloat($(this).text().replace(/,/g, ''));
          if (!isNaN(count9)) {
            total9 += count9;
          }
        });
        // 합계 표시
        $('#Podatatable tfoot').remove(); // 기존의 tfoot 제거
        $('#Podatatable').append(
          '<tfoot>' +
          '<tr>' +
          '<td style="border:1px solid silver; background-color:whitesmoke;"colspan="7">합계</td>' +
          '<td style="border:1px solid silver; text-align:right;"><strong>' + addCommas(total8.toFixed(0)) + '</strong></td>' +
          '<td style="border:1px solid silver; text-align:right;"><strong>' + addCommas(total9.toFixed(0)) + '</strong></td>' +
          '<td style="border:1px solid silver; background-color:whitesmoke; "colspan="2"></td>' +
          '</tr>' +
          '</tfoot>'
        );
        $('#modelname').val(modelname);
        $('#partname').val(itemname);
        $('#unitprice').val('0');
        $('#cost').val(cost);
        $('#percent').val('0');
        $('#customer-select').val(customer);
        $('#bomno').val(bomno);
        $('#customercode').val('');
        $('#allcode').val(rev);
        $('#toolmain').val('');
        $('#cavity').val(cavity);
        $('#onepid').val(onepidding);
        $('#twopid').val(twopidding);
        $('#twopid1').val(twopidding1);
        $('#twopid2').val(twopidding2);
        $('#loss').val('3');
        $('#tool').val(working);
        $('#production').val(production);
        $('#popupCloseBtn-save').val('수정');

        $('#popupOverlay').fadeIn();
      })

      $('#Podatatable').on('click', '.POdata-edit', function () {
        var clickedRow = $(this); // 클릭한 행(tr) 요소
        var rowIndex = clickedRow.index() + 1; // 클릭한 행의 인덱스 + 1

        var str = "";
        var tdArr = new Array();// 배열 선언            
        var checkBtn = $(this);

        var tr = checkBtn.parent().parent();
        var td = tr.children();

        var itemcode = td.eq(0).text();
        var bomno = td.eq(1).text();
        var modelname = td.eq(2).text();
        var itemname = td.eq(3).text();
        var customer = td.eq(4).text();
        var itemprice = td.eq(5).text();
        var cost = td.eq(6).text();
        var costpg = td.eq(7).text();

        $('#itemcode-POedit').val(itemcode)
        $('#bomno-POedit').val(bomno)
        $('#modelname-POedit').val(modelname)
        $('#itemname-POedit').val(itemname)
        $('#customer-POedit').val(customer)
        $('#itemprice-POedit').val(itemprice)
        $('#cost-POedit').val(cost)
        $('#costpg-POedit').val(costpg)
        $('#count-POedit').val('')
        $('#id-POedit').val(rowIndex)
        $('#popupOverlay4').fadeIn();
        $('#count-POedit').focus()
      });





      $('#datatable').on('click', '.databomdelete', function () {
        $(this).closest('tr').remove();
      })
      $('#Materialdatatable').on('click', '.data-edit', function () {
        var str = "";
        var tdArr = new Array();// 배열 선언            
        var checkBtn = $(this);

        var tr = checkBtn.parent().parent();
        var td = tr.children();


        var materialname = td.eq(0).text();
        var sqmprice = td.eq(4).text();
        $('#materialname').val(materialname)
        $('#materialwidth').val('')
        $('#dpidding').val('0')
        $('#sqmprice').val(sqmprice)

        $('#popupOverlay2').fadeIn();
        $('#materialwidth').focus()
      });


      $('#popupCloseBtn-save-close').click(function () {
        $('#popupOverlay').fadeOut();
      });
      $('#popupCloseBtn-edit-close').click(function () {
        $('#popupOverlay1').fadeOut();
      });
      $('#popupCloseBtn-delete-close').click(function () {
        $('#popupOverlay2').fadeOut();
      });
      $('#popupCloseBtn-delete-close1').click(function () {
        $('#popupOverlay5').fadeOut();
      });
      $('#popupCloseBtn-search-close').click(function () {
        $('#popupOverlay3').fadeOut();
      });
      $('#popupCloseBtn-search').click(function () {
        $('#popupOverlay3').fadeIn();
      });
      $('#popupCloseBtn-content-close').click(function () {
        $('#popupOverlaycontent').fadeOut();
      });
      $('#popupCloseBtn-POedit-close').click(function () {
        $('#popupOverlay4').fadeOut();
      });


      const selectElement = document.getElementById("customer-select");
      if (selectElement) {
        $.ajax({
          type: 'POST',
          url: server + '/api/accountnamegroup',
          dataType: 'json',
          contentType: 'application/json',
          success: function (result) {
            for (let i = 0; i < result.length; i++) {
              const option = document.createElement("option");
              option.text = result[i].accountname;
              option.value = result[i].accountname;
              selectElement.add(option);
            }
          },
        });
      }

    });



    //오름차순 내림차순
    function sortTable(columnIndex) {
      var table, rows, switching, i, x, y, shouldSwitch, direction, switchcount = 0;
      table = document.getElementById("datatable");
      switching = true;
      direction = "asc"; // 기본 정렬 방향은 오름차순

      while (switching) {
        switching = false;
        rows = table.getElementsByTagName("tr");

        for (i = 1; i < (rows.length - 1); i++) {
          shouldSwitch = false;
          x = rows[i].getElementsByTagName("td")[columnIndex];
          y = rows[i + 1].getElementsByTagName("td")[columnIndex];

          if (direction == "asc") {
            if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
              shouldSwitch = true;
              break;
            }
          } else if (direction == "desc") {
            if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
              shouldSwitch = true;
              break;
            }
          }
        }

        if (shouldSwitch) {
          rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
          switching = true;
          switchcount++;
        } else {
          if (switchcount == 0 && direction == "asc") {
            direction = "desc";
            switching = true;
          }
        }
      }
    }

    //검색

    function showLoading() {
      var loadingOverlay = document.getElementById("loadingOverlay");
      loadingOverlay.style.display = "flex";

      // 로딩 완료 후 일정 시간 후 로딩 창 숨기기 (테스트용)
      setTimeout(function () {
        loadingOverlay.style.display = "none";
      }, 1000);
    }

    function New() {
      var tbody = document.getElementById('materialalltabletbody');
      tbody.innerHTML = '';
      var total8 = 0;
      var total9 = 0;
      $('#Podatatable td:nth-child(8)').each(function () {
        var count8 = parseFloat($(this).text().replace(/,/g, ''));
        if (!isNaN(count8)) {
          total8 += count8;
        }
      });

      $('#Podatatable td:nth-child(9)').each(function () {
        var count9 = parseFloat($(this).text().replace(/,/g, ''));
        if (!isNaN(count9)) {
          total9 += count9;
        }
      });
      // 합계 표시
      $('#Podatatable tfoot').remove(); // 기존의 tfoot 제거
      $('#Podatatable').append(
        '<tfoot>' +
        '<tr>' +
        '<td style="border:1px solid silver; background-color:whitesmoke;"colspan="7">합계</td>' +
        '<td style="border:1px solid silver; text-align:right;"><strong>' + addCommas(total8.toFixed(0)) + '</strong></td>' +
        '<td style="border:1px solid silver; text-align:right;"><strong>' + addCommas(total9.toFixed(0)) + '</strong></td>' +
        '<td style="border:1px solid silver; background-color:whitesmoke; "colspan="2"></td>' +
        '</tr>' +
        '</tfoot>'
      );
      $('#modelname').val('');
      $('#partname').val('');
      $('#unitprice').val('0');
      $('#cost').val('0');
      $('#percent').val('0');
      $('#customer').val('');
      $('#bomno').val('');
      $('#customercode').val('');
      $('#allcode').val('');
      $('#toolmain').val('');
      $('#cavity').val('');
      $('#onepid').val('');
      $('#twopid').val('');
      $('#twopid1').val('');
      $('#twopid2').val('');
      $('#loss').val('3');
      $('#tool').val('1');
      $('#production').val('양산');
      $('#popupCloseBtn-save').val('저장');
      $('#popupOverlay').fadeIn();
    }

    function Datasave() {
      if ($('#popupCloseBtn-save').val() === '저장') {
        if ($('#toolmain').val() === "" || $('#allcode').val() === "" || $('#customercode').val() === "" || $('#customer').val() === "" || $('#partname').val() === "" || $('#modelname').val() === "" || $('#cavity').val() === "" || $('#bomno').val() === "" || $('#onepid').val() === "" || $('#twopid').val() === "" || $('#loss').val() === "" || $('#twopid1').val() === "" || $('#twopid2').val() === "") {

          var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span style="color:red;" class="notification-message">누락된 정보가 있습니다</span></div>');
          $('body').append(notification);
          setTimeout(function () {
            notification.fadeOut(function () {
              $(this).remove();
            });
          }, 3000); // 3초 후에 알림을 사라지게 설정
        } else {
          if (confirm("BOM 정보를 저장 하시겠습니까??") == true) {

            const $table = document.getElementById('datatable'); // table 엘리먼트 취득


            const trGroup = Array.from(document.querySelectorAll('#datatable tr'));

            const textGroup = trGroup.map(tr => {
              return Array.from(tr.children).map(input => input.textContent);
            });
            var today = new Date();
            var now = new Date();	// 현재 날짜 및 시간
            var year = today.getFullYear();
            var month = ('0' + (today.getMonth() + 1)).slice(-2);
            var day = ('0' + today.getDate()).slice(-2);
            var hours = now.getHours();	// 시간
            var minutes = now.getMinutes();	// 분
            var seconds = now.getSeconds();	// 초

            var bomno = textGroup[1][1];


            var today = new Date();
            var year = today.getFullYear();
            var month = ('0' + (today.getMonth() + 1)).slice(-2);
            var day = ('0' + today.getDate()).slice(-2);


            var modelname = $('#modelname').val();
            var itemname = $('#partname').val();
            var bomno = $('#bomno').val();
            var itemcode = $('#allcode').val();
            var customer = $('#customer-select').val();
            var working = $('#tool').val();
            var cost = $('#cost').val();
            var cavity = $('#cavity').val();
            var onepidding = $('#onepid').val();
            var twopidding = $('#twopid').val();
            var one = $('#twopid1').val();
            var two = $('#twopid2').val();
            var rev = $('#customercode').val();
            var minus = $('#loss').val();
            var part = $('#production').val();
            var itemprice = '0'

            $.ajax({
              type: 'POST',
              url: server + '/api/iteminfoinsertdata',
              dataType: 'json',
              contentType: 'application/json',
              data: JSON.stringify({

                "modelname": modelname,
                "itemname": itemname,
                "itemcode": itemcode,
                "bomno": bomno,
                "customer": customer,
                "working": working,
                "cost": cost,
                "cavity": cavity,
                "onepidding": onepidding,
                "twopidding": twopidding,
                "one": one,
                "two": two,
                "rev": rev,
                "insertdate": year + '-' + month + '-' + day,
                "minus": minus,
                "part": part,
                "itemprice": itemprice






              }),
              success: function (result) {
                console.log(result)
              }
            })

            for (var i = 0; i < $table.rows.length - 3; i++) {



              var model = $('#modelname').val();
              var itemname = $('#partname').val();
              var materialname = textGroup[i + 2][1];
              var swidth = textGroup[i + 2][2];
              var mwidth = textGroup[i + 2][3];
              var dpid = textGroup[i + 2][4];
              var cost = textGroup[i + 2][5];
              var main = $('#production' + (i + 1) + '').val();


              $.ajax({
                type: 'POST',
                url: server + '/api/updatebom',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({

                  "bomno": bomno,
                  "model": model,
                  "itemname": itemname,
                  "materialname": materialname,
                  "swidth": swidth,
                  "mwidth": mwidth,
                  "savedate": year + '-' + month + '-' + day,
                  "status": "true",
                  "dpid": dpid,
                  "cost": cost,
                  "classification": main

                }),
                success: function (result) {
                }
              })

            }


            var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span style="color:navy;" class="notification-message">품목 저장 완료</span></div>');
            $('body').append(notification);
            setTimeout(function () {
              notification.fadeOut(function () {
                $(this).remove();
              });
            }, 3000); // 3초 후에 알림을 사라지게 설정
            setTimeout(function () {
              load()
            }, 30); // 3초 후에 알림을 사라지게 설정
            $('#popupOverlay').fadeOut();

          }
        }
      }
      else if ($('#popupCloseBtn-save').val() === '수정') {
        const $table = document.getElementById('datatable'); // table 엘리먼트 취득

        console.log($table.rows.length);  // 3, 행 갯수 출력

        const trGroup = Array.from(document.querySelectorAll('#datatable tr'));

        const textGroup = trGroup.map(tr => {
          return Array.from(tr.children).map(input => input.textContent);
        });
        var today = new Date();
        var now = new Date();	// 현재 날짜 및 시간
        var year = today.getFullYear();
        var month = ('0' + (today.getMonth() + 1)).slice(-2);
        var day = ('0' + today.getDate()).slice(-2);
        var hours = now.getHours();	// 시간
        var minutes = now.getMinutes();	// 분
        var seconds = now.getSeconds();	// 초

        var bomno = textGroup[1][1];


        var today = new Date();
        var year = today.getFullYear();
        var month = ('0' + (today.getMonth() + 1)).slice(-2);
        var day = ('0' + today.getDate()).slice(-2);


        var modelname = $('#modelname').val();
        var itemname = $('#partname').val();
        var bomno = $('#bomno').val();
        var itemcode = $('#allcode').val();
        var customer = $('#customer').val();
        var working = $('#tool').val();
        var cost = $('#cost').val();
        var cavity = $('#cavity').val();
        var onepidding = $('#onepid').val();
        var twopidding = $('#twopid').val();
        var one = $('#twopid1').val();
        var two = $('#twopid2').val();
        var rev = $('#customercode').val();
        var minus = $('#loss').val();
        var part = $('#production').val();
        var itemprice = $('#unitprice').val();

        if (confirm("BOM 정보를 수정 하시겠습니까??") == true) {

          $.ajax({
            // bomno,,,,,,,
            type: 'POST',
            url: server + '/api/falsebom',
            dataType: 'json',
            contentType: 'application/json',
            data: JSON.stringify({

              "bomno": $('#bomno').val(),
              "status": 'false',


            }),
            success: function (result) {
              console.log(result)
            }
          })




          $.ajax({
            type: 'POST',
            url: server + '/api/updatebominput',
            dataType: 'json',
            contentType: 'application/json',
            data: JSON.stringify({

              "modelname": modelname,
              "itemname": itemname,
              "itemcode": itemcode,
              "bomno": bomno,
              "customer": customer,
              "working": working,
              "cost": cost,
              "cavity": cavity,
              "onepidding": onepidding,
              "twopidding": twopidding,
              "one": one,
              "two": two,
              "rev": rev,
              "updatedate": year + '-' + month + '-' + day,
              "minus": minus,
              "part": part,
              "itemprice": itemprice






            }),
            success: function (result) {
              console.log(result)
            }
          })
          for (var i = 0; i < $table.rows.length - 3; i++) {



            var model = $('#modelname').val();
            var itemname = $('#partname').val();
            var materialname = textGroup[i + 2][1];
            var swidth = textGroup[i + 2][2];
            var mwidth = textGroup[i + 2][3];
            var dpid = textGroup[i + 2][4];
            var cost = textGroup[i + 2][5];
            var main = $('#production' + (i + 1) + '').val();

            $.ajax({
              // bomno,,,,,,,
              type: 'POST',
              url: server + '/api/updatebom',
              dataType: 'json',
              contentType: 'application/json',
              data: JSON.stringify({

                "bomno": bomno,
                "model": model,
                "itemname": itemname,
                "materialname": materialname,
                "swidth": swidth,
                "mwidth": mwidth,
                "savedate": year + '-' + month + '-' + day,
                "status": "true",
                "dpid": dpid,
                "cost": cost,
                "classification": main

              }),
              success: function (result) {
              }
            })
            $('#popupOverlay').fadeOut();
          }


        }
      }
    }



    function PODataedit() {



      if ($('#count-POedit').val() === '' || $('#count-POedit').val() === '0') {
        var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span style="font-weight:bold; color:red;" class="notification-message">PO수량 확인바랍니다</span></div>');
        $('body').append(notification);
        setTimeout(function () {
          notification.fadeOut(function () {
            $(this).remove();
          });
        }, 3000);

      } else {
        var tr = $(this).closest('tr'); // 현재 버튼이 속한 행(tr)을 가져옵니다.
        var tdArr = tr.find('td'); // 행(tr)에서 모든 셀(td)을 가져옵니다.

        var POeditcount = $('#count-POedit', window.opener.document).val(); // 다른 창에서 값을 가져옵니다.

        // 원하는 셀에 접근하여 값을 변경합니다.
        tdArr.eq(7).text(POeditcount); // 8번째 셀의 값을 변경 (0부터 시작하는 인덱스)


        $('#popupOverlay4').fadeOut();

        var total8 = 0;
        var total9 = 0;
        $('#Podatatable td:nth-child(8)').each(function () {
          var count8 = parseFloat($(this).text().replace(/,/g, ''));
          if (!isNaN(count8)) {
            total8 += count8;
          }
        });

        $('#Podatatable td:nth-child(9)').each(function () {
          var count9 = parseFloat($(this).text().replace(/,/g, ''));
          if (!isNaN(count9)) {
            total9 += count9;
          }
        });
        // 합계 표시
        $('#Podatatable tfoot').remove(); // 기존의 tfoot 제거
        $('#Podatatable').append(
          '<tfoot>' +
          '<tr>' +
          '<td style="border:1px solid silver; background-color:whitesmoke;"colspan="7">합계</td>' +
          '<td style="border:1px solid silver; text-align:right;"><strong>' + addCommas(total8.toFixed(0)) + '</strong></td>' +
          '<td style="border:1px solid silver; text-align:right;"><strong>' + addCommas(total9.toFixed(0)) + '</strong></td>' +
          '<td style="border:1px solid silver; background-color:whitesmoke; "colspan="2"></td>' +
          '</tr>' +
          '</tfoot>'
        );

        var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span style="font-weight:bold; color:navy;" class="notification-message">PO수량 수정되었습니다</span></div>');
        $('body').append(notification);
        setTimeout(function () {
          notification.fadeOut(function () {
            $(this).remove();
          });
        }, 3000); // 3초 후에 알림을 사라지게 설정
      }

    }

    function Dataedit() {
      if ($('#count-edit').val() === '' || $('#count-edit').val() === '0') {
        var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span style="font-weight:bold; color:red;" class="notification-message">PO수량 확인바랍니다</span></div>');
        $('body').append(notification);
        setTimeout(function () {
          notification.fadeOut(function () {
            $(this).remove();
          });
        }, 3000); // 3초 후에 알림을 사라지게 설정

      } else {
        var count = $('#count-edit').val().replace(/[^0-9]/g, ''); // 숫자 이외의 문자 제거
        var item = $('#itemprice-edit').val().replace(/[^0-9]/g, ''); // 숫자 이외의 문자 제거
        var total = count * item;

        $('#Podatatable').append(
          '<tr>' +
          '<td>' + $('#itemcode-edit').val() + '</td>' +
          '<td>' + $('#bomno-edit').val() + '</td>' +
          '<td>' + $('#modelname-edit').val() + '</td>' +
          '<td>' + $('#itemname-edit').val() + '</td>' +
          '<td>' + $('#customer-edit').val() + '</td>' +
          '<td style="text-align:right;">' + $('#cost-edit').val() + '</td>' +
          '<td style="text-align:right;">' + addCommas($('#itemprice-edit').val()) + '</td>' +
          '<td style="text-align:right;">' + addCommas($('#count-edit').val()) + '</td>' +
          '<td style="text-align:right;">' + addCommas(total.toLocaleString()) + '</td>' +
          '<td><a class="POdata-edit"  style="cursor:pointer; color:navy;">수정</a></td>' +
          '<td><a class="data-delete" style="cursor:pointer; color:red;">삭제</a></td>' +
          '</tr>'

        )
        // 합계 계산
        var total8 = 0;
        var total9 = 0;
        $('#Podatatable td:nth-child(8)').each(function () {
          var count8 = parseFloat($(this).text().replace(/,/g, ''));
          if (!isNaN(count8)) {
            total8 += count8;
          }
        });

        $('#Podatatable td:nth-child(9)').each(function () {
          var count9 = parseFloat($(this).text().replace(/,/g, ''));
          if (!isNaN(count9)) {
            total9 += count9;
          }
        });
        // 합계 표시
        $('#Podatatable tfoot').remove(); // 기존의 tfoot 제거
        $('#Podatatable').append(
          '<tfoot>' +
          '<tr>' +
          '<td style="border:1px solid silver; background-color:whitesmoke;"colspan="7">합계</td>' +
          '<td style="border:1px solid silver; text-align:right;"><strong>' + addCommas(total8.toFixed(0)) + '</strong></td>' +
          '<td style="border:1px solid silver; text-align:right;"><strong>' + addCommas(total9.toFixed(0)) + '</strong></td>' +
          '<td style="border:1px solid silver; background-color:whitesmoke; "colspan="2"></td>' +
          '</tr>' +
          '</tfoot>'
        );



        var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span class="notification-message">' + $('#itemname-edit').val() + '(' + $('#count-edit').val() + ') 제품이 추가되었습니다.</span></div>');
        $('body').append(notification);
        setTimeout(function () {
          notification.fadeOut(function () {
            $(this).remove();
          });
        }, 3000); // 3초 후에 알림을 사라지게 설정


        $('#popupOverlay1').fadeOut();
      }

    }

    // 천 단위마다 콤마를 추가하는 함수
    function addCommas(value) {
      return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function Datadelte() {
      $('#popupOverlay2').fadeIn();
    }


    $(document).on('click', '.data-delete', function () {
      $(this).closest('tr').remove();
      var total8 = 0;
      var total9 = 0;
      $('#Podatatable td:nth-child(8)').each(function () {
        var count8 = parseFloat($(this).text().replace(/,/g, ''));
        if (!isNaN(count8)) {
          total8 += count8;
        }
      });

      $('#Podatatable td:nth-child(9)').each(function () {
        var count9 = parseFloat($(this).text().replace(/,/g, ''));
        if (!isNaN(count9)) {
          total9 += count9;
        }
      });
      // 합계 표시
      $('#Podatatable tfoot').remove(); // 기존의 tfoot 제거
      $('#Podatatable').append(
        '<tfoot>' +
        '<tr>' +
        '<td style="border:1px solid silver; background-color:whitesmoke;"colspan="7">합계</td>' +
        '<td style="border:1px solid silver; text-align:right;"><strong>' + addCommas(total8.toFixed(0)) + '</strong></td>' +
        '<td style="border:1px solid silver; text-align:right;"><strong>' + addCommas(total9.toFixed(0)) + '</strong></td>' +
        '<td style="border:1px solid silver; background-color:whitesmoke; "colspan="2"></td>' +
        '</tr>' +
        '</tfoot>'
      );

      var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span class="notification-message"> 제품이 삭제되었습니다.</span></div>');
      $('body').append(notification);
      setTimeout(function () {
        notification.fadeOut(function () {
          $(this).remove();
        });
      }, 3000); // 3초 후에 알림을 사라지게 설정
    });
    $(document).on('click', '.POdata-edit', function () {
    })




  </script>
  <script>
    function settingDate() {
      const date = new Date();

      var day = date.getDate();
      var month = date.getMonth() + 1;
      var year = date.getFullYear();


      if (month === 1 || month === 2 || month === 3 || month === 4 || month === 5 || month === 6 || month === 7 || month === 8 || month === 9) {
        month = '0' + month
      }

      if (day === 1 || day === 2 || day === 3 || day === 4 || day === 5 || day === 6 || day === 7 || day === 8 || day === 9) {
        day = '0' + day
      }


      // This arrangement can be altered based on how we want the date's format to appear.
      let currentDate = `${year}-${month}-${day}`;


      $('#datepicker').val(currentDate);
      $('#datepicker1').val(currentDate);
      $('#datepicker2').val(currentDate);

    }
  </script>
  <script>
    function POsearching() {
      showLoading()

      $('#PODatatbody').empty()
      $.ajax({
        type: 'POST',
        url: server + '/api/POaccountinput',
        dataType: 'json',
        contentType: 'application/json',
        data: JSON.stringify({
          start: $('#datepicker1').val(),
          finish: $('#datepicker2').val()
        }),
        success: function (result) {
          for (var i = 0; i < result.length; i++) {

            $('#POdatatable').append(
              '<tr>' +
              '<td>' + result[i].accountdate + '</td>' +
              '<td>' + result[i].deliverydate + '</td>' +
              '<td>' + result[i].ponum + '</td>' +
              '<td>' + result[i].customer + '</td>' +
              '<td>' + result[i].contentname + '</td>' +
              '<td><a class="data-edit"  style="cursor:pointer; color:blue;">상세</a></td>' +
              '<td><a class="data-edit"  style="cursor:pointer; color:red;">삭제</a></td>' +
              '</tr>'

            )

          }
          var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span style="color:navy;" class="notification-message">' + $('#datepicker1').val() + '/' + $('#datepicker2').val() + ' 조회 완료</span></div>');
          $('body').append(notification);
          setTimeout(function () {
            notification.fadeOut(function () {
              $(this).remove();
            });
          }, 3000); // 3초 후에 알림을 사라지게 설정
        }

      })
    }
  </script>
  <script>
    $(document).on('click', '#material_search', function () {
      var cavityValue = $('#cavity').val().trim();
      var onepidValue = $('#onepid').val().trim();
      var twopidValue = $('#twopid').val().trim();
      var twopid1Value = $('#twopid1').val().trim();
      var twopid2Value = $('#twopid2').val().trim();

      if (cavityValue === '' || onepidValue === '' || twopidValue === '' || twopid1Value === '' || twopid2Value === '') {
        var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span style="color:red;" class="notification-message">수식항목을 확인바랍니다</span></div>');
        $('body').append(notification);
        setTimeout(function () {
          notification.fadeOut(function () {
            $(this).remove();
          });
        }, 3000);
        return false;
      }
      $('#myInput1').val('');
      $('#MaterialDatatbody').empty();

      $('#popupOverlay3').fadeIn();
      $('#myInput1').focus();
    });

    $(document).on('click', '#hapji', function () {
      mergeSelectedRows()
    })


    function Materailadd() {
      const $table = document.getElementById('datatable'); // table 엘리먼트 취득


      const trGroup = Array.from(document.querySelectorAll('#datatable tr'));

      const textGroup = trGroup.map(tr => {
        return Array.from(tr.children).map(input => input.textContent);
      });

      var one = parseFloat($('#onepid').val());
      var two = parseFloat($('#twopid').val());
      var cavity = parseInt($('#cavity').val());
      var onepid = parseFloat($('#twopid1').val());
      var twopid = parseFloat($('#twopid2').val());
      var dpid = parseFloat($('#dpidding').val());
      var sqm = parseFloat($('#sqmprice').val());
      var unitprice = parseFloat($('#unitprice').val());

      // 1/(CV+2차계산1)*((1차피딩+D피딩)+2차계산2)*0.001*1.03
      var soyo = 1 / (cavity + onepid) * (one + dpid + twopid) * 0.001 * 1.03;

      console.log(soyo); // 수정된 부분

      var soyodata = soyo.toFixed(2);
      var costdata = soyodata * sqm;
      var cost = costdata.toFixed(2);
      $('#materialalltabletbody').append(
        '<tr>' +
        '<td><input type="checkbox" ></td>' +
        '<td>' + $('#materialname').val() + '</td>' +
        '<td style="text-align:right;">' + $('#materialwidth').val() + '</td>' +
        '<td style="text-align:right;">' + soyodata + '</td>' +
        '<td style="text-align:right;">' + $('#dpidding').val() + '</td>' +
        '<td style="text-align:right;" id="costsum">' + cost + '</td>' +
        '<td ><select id ="production' + ($table.rows.length - 2) + '" style = "padding: 5px; width:100%; border-radius: 5px;"><option value=""></option><option value="메인자재">메인자재</option></td>' +
        '<td><a class="databomdelete"  style="cursor:pointer; color:red;">삭제</a></td>' +
        '</tr>'
      );

      var costa = $('#cost').val();
      var costsum = parseFloat($('#cost').val()) + parseFloat(cost);
      $('#cost').val(costsum);

      // var percent = (unitprice / costsum * 100).toFixed(2);
      // $('#percent').val(percent);
      var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span style="color:navy;" class="notification-message">' + $('#materialname').val() + ' 자재 추가 완료</span></div>');
      $('body').append(notification);
      setTimeout(function () {
        notification.fadeOut(function () {
          $(this).remove();
        });
      }, 3000); // 3초 후에 알림을 사라지게 설정

      $('#popupOverlay2').fadeOut();
    }




    function handleKeyPress(event) {
      if (event.keyCode === 13) { // Enter 키를 눌렀을 때

        $.ajax({
          type: 'POST',
          url: server + '/api/materialbase',
          dataType: 'json',
          contentType: 'application/json',
          data: JSON.stringify({
            searchText: $('#myInput1').val()
          }),
          success: function (result) {
            $('#MaterialDatatbody').empty();

            for (var i = 0; i < result.length; i++) {
              $('#Materialdatatable').append(
                '<tr>' +
                '<td>' + result[i].materialname + '</td>' +
                '<td>' + result[i].codenumber + '</td>' +
                '<td>' + result[i].classification + '</td>' +
                '<td style="text-align:right;">' + result[i].fullwidth + '</td>' +
                '<td style="text-align:right;">' + result[i].sqmprice + '</td>' +
                '<td><a class="data-edit"  style="cursor:pointer; color:navy;">추가</a></td>' +
                '</tr>'
              );
            }
          }
        });


      }
    }
    function rowMoveEvent(direction) {


      var checkbox1 = $("input[name=chkradio]:checked");

      // 체크된 행(row)의 존재 여부를 파악한다.

      if (jQuery(".chkRadio:checked").val()) {



        // 체크된 라디오 박스의 행(row)을 변수에 담는다.

        var row = jQuery(".chkRadio:checked").parent().parent();



        // 체크된 행(row)의 이동 한계점을 파악하기 위해 인덱스를 파]악한다.

        var num = row.index();



        // 전체 행의 개수를 구한다.

        var max = (jQuery(".chkRadio").length - 1);	   // index는 0부터 시작하기에 -1을 해준다.



        if (direction == "up") {
          if (num == 0) {
            // 체크된 행(row)의 위치가 최상단에 위치해 있을경우 더이상 올라갈 수 없게 막는다.
            alert("첫번째로 지정되어 있습니다.\n더이상 순서를 변경할 수 없습니다.");
            return false;
          } else {
            // 체크된 행(row)을 한칸 위로 올린다.
            row.prev().before(row);
          }
        } else if (direction == "down") {
          if (num >= max) {
            // 체크된 행(row)의 위치가 최하단에 위치해 있을경우 더이상 내려갈 수 없게 막는다.

            alert("마지막으로 지정되어 있습니다.\n더이상 순서를 변경할 수 없습니다.");

            return false;

          } else {



            // 체크된 행(row)을 한칸 아래로 내린다.

            row.next().after(row);

          }

        }



      } else {

        alert("선택된 행이 존재하지 않습니다\n위치를 이동시킬 행을 하나 선택해 주세요.");

      }

    }

    const selectElement = document.getElementById("customer-select");
    if (selectElement) {
      $.ajax({
        type: 'POST',
        url: server + '/api/accountnamegroup',
        dataType: 'json',
        contentType: 'application/json',
        success: function (result) {
          for (let i = 0; i < result.length; i++) {
            const option = document.createElement("option");
            option.text = result[i].accountname;
            option.value = result[i].accountname;
            selectElement.add(option);
          }
        },
      });
    }
  </script>
  <script>
    function validateNumber(value) {
      // 정규식을 사용하여 유효한 숫자 형식인지 확인합니다.
      var validValue = value.replace(/[^0-9.]/g, ''); // 숫자와 소수점만 남깁니다.
      var parts = validValue.split('.'); // 소수점을 기준으로 분리합니다.

      if (parts.length > 2) {
        // 소수점이 2개 이상인 경우, 마지막 소수점을 제거합니다.
        validValue = parts.slice(0, -1).join('.') + parts[parts.length - 1];
      }

      return validValue;
    }
    function load() {
      $.ajax({
        type: 'POST',
        url: server + '/api/iteminfobom',
        dataType: 'json',
        success: function (data) {
          for (var i = 0; i < data.length; i++) {
            var updatedate = data[i].updatedate !== null ? data[i].updatedate : '';

            $('#POdatatable').append(
              '<tr>' +
              '<td>' + data[i].bomno + '</td>' +
              '<td>' + data[i].part + '</td>' +
              '<td>' + data[i].modelname + '</td>' +
              '<td>' + data[i].itemname + '</td>' +
              '<td>' + data[i].customer + '</td>' +
              '<td>' + data[i].itemcode + '</td>' +
              '<td>' + data[i].insertdate + '</td>' +
              '<td>' + updatedate + '</td>' +
              '<td><a class="databomedit"  style="cursor:pointer; color:navy;">상세</a></td>' +
              '<td><a class="datadelete1"style="cursor:pointer; color:red;">삭제</a></td>' +
              '<td id="data-id">' + data[i].id + '</td>' +
              '<td id="data-working">' + data[i].working + '</td>' +
              '<td id="data-cavity">' + data[i].cavity + '</td>' +
              '<td id="data-onepidding">' + data[i].onepidding + '</td>' +
              '<td id="data-twopidding">' + data[i].twopidding + '</td>' +
              '<td id="data-one">' + data[i].one + '</td>' +
              '<td id="data-two">' + data[i].two + '</td>' +
              '<td id="data-rev">' + data[i].rev + '</td>' +
              '<td id="data-cost">' + data[i].cost + '</td>' +
              '<td id="data-minus">' + data[i].minus + '</td>' +
              '<td id="data-itemprice">' + data[i].itemprice + '</td>' +
              '</tr>'
            );

            $("td#data-id").hide();
            $("td#data-working").hide();
            $("td#data-cavity").hide();
            $("td#data-onepidding").hide();
            $("td#data-twopidding").hide();
            $("td#data-one").hide();
            $("td#data-two").hide();
            $("td#data-rev").hide();
            $("td#data-cost").hide();
            $("td#data-minus").hide();
            $("td#data-itemprice").hide();
          }
        }
      });
    }


  </script>
  <script>
    function mergeSelectedRows() {
      const tableBody = document.getElementById("materialalltabletbody");
      const rows = tableBody.getElementsByTagName("tr");

      let mergedRows = [];
      let currentGroup = [];

      for (let i = 0; i < rows.length; i++) {
        const checkbox = rows[i].querySelector("input[type='checkbox']");

        if (checkbox.checked) {
          currentGroup.push(rows[i]);
        } else {
          if (currentGroup.length > 0) {
            mergedRows.push(currentGroup);
            currentGroup = [];
          }
        }
      }

      if (currentGroup.length > 0) {
        mergedRows.push(currentGroup);
      }

      for (let i = 0; i < mergedRows.length; i++) {
        if (mergedRows[i].length > 1) {
          const rowspan = mergedRows[i].length;
          const materials = [];

          // Get unique materials from the group
          for (let j = 0; j < mergedRows[i].length; j++) {
            const material = mergedRows[i][j].querySelector("td:nth-child(2)").textContent;
            if (!materials.includes(material)) {
              materials.push(material);
            }
          }

          // Apply materials to the first row in the merged group
          mergedRows[i][0].querySelector("td:nth-child(2)").textContent = materials.join(" + ");
          mergedRows[i][0].querySelector("td:nth-child(2)").setAttribute("rowspan", rowspan);

          // Hide other cells in the merged group
          for (let j = 1; j < mergedRows[i].length; j++) {
            mergedRows[i][j].querySelector("td:nth-child(2)").style.display = "none";
            mergedRows[i][j].querySelector("td:first-child input[type='checkbox']").style.display = "none";
          }
        }
      }
    }


  </script>

</body>

</html>
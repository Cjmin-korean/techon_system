<!DOCTYPE html>
<html>

<head>
    <title>jspBoard</title>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

</head>
<style>
    body {
        background-color: #f8f9fa;
    }

    .table-wrap table {
        width: 100%;
        border-collapse: collapse;
    }

    .table-wrap th,
    .table-wrap td {
        padding: 10px;
        border-bottom: 1px solid #dee2e6;
        text-align: center;
        border: 1px solid silver;
        font-weight: bold;

    }

    .table-wrap th {
        background-color: #ffffff;
        color: black;
    }

    .pagination {
        justify-content: center;
        margin-top: 20px;
    }

    .pagination li {
        margin: 0 5px;
        list-style: none;
        display: inline-block;
    }

    .pagination a {
        text-decoration: none;
        padding: 8px 16px;
        background-color: #007bff;
        color: #fff;
        border-radius: 3px;
    }

    .pagination a:hover {
        background-color: #0056b3;
    }

    .pagination .active a {
        background-color: #0056b3;
    }

    #page_info {
        margin-bottom: 10px;
    }
</style>

<body>
  
    <section class="ftco-section" style="height: 1000px;">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-6 text-center mb-5">
                    <h2 class="heading-section">자재 기초정보</h2>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div id="page_info"></div>

                    <div class="table-wrap">
                        <table class="table" style="width:200%;">
                            <thead class="thead-dark">
                                <tr>
                         
                                    <th style="text-align:center;">품목코드</th>
                                    <th style="text-align:center;">자재명</th>
                                    <th style="text-align:center;">전폭<br>(mm)</th>
                                    <th style="text-align:center;">길이<br>(M)</th>
                                    <th style="text-align:center;">유효폭<br>(mm)</th>
                                    <th style="text-align:center;">SQM단가<br>(￦)</th>
                                    <th style="text-align:center;">롤단가<br>(￦)</th>
                                    <th style="text-align:center;">단위</th>
                                    <th style="text-align:center;">유수명<br>(일)</th>
                                    <th style="text-align:center;">순번</th>
                                    <th style="text-align:center;">제조사</th>
                                    <th style="text-align:center;">공급사</th>
                                    <th style="text-align:center;">사용별</th>
                                    <th style="text-align:center;">유형별</th>
                                    <th style="text-align:center;">업체별</th>
                                    <th style="text-align:center;">자재TYPE</th>
                                    <th style="text-align:center;">색상</th>
                                    <th style="text-align:center;">두께</th>
                                    <th style="text-align:center;">점착력</th>
                                    <th style="text-align:center;">점착제</th>
                                    <th style="text-align:center;">원단무게<br>(KG)</th>
                                    <th style="text-align:center;">요청자</th>
                                    <th style="text-align:center;">최초수정날짜</th>
                                    <th style="text-align:center;">등록사유</th>
                                    <th style="text-align:center;">고객사</th>
                                    <th style="text-align:center;">모델</th>
                                </tr>
                            </thead>
                            <tbody id="html_list">
                            </tbody>
                        </table>
                        <!-- pagination -->
                        <nav aria-label="Page navigation example">
                            <ul class="pagination justify-content-center" id="paging">
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </section>
</body>
<script>
    var server = '';
    var totalPage; // Declare totalPage globally
    var nowPage = 1; // Declare nowPage globally

    if (window.location.hostname == 'localhost') {
        server = 'http://localhost:8080';
    } else {
        server = 'http://techonmes.co.kr';
    }

    let video_list = [];

    // 서버에서 데이터 받아오기
    $.ajax({
        type: 'POST',
        url: server + '/api/selectmaterialinformation',
        dataType: 'json',
        success: function (data) {
            // 받아온 데이터를 video_list에 할당
            video_list = data.reverse();

            // 나머지 코드 실행
            totalCount = video_list.length;
            totalPage = Math.ceil(totalCount / 10.0);

            // 페이지네이션 세팅
            setPageHtml();
            // 데이터 세팅
            setList();
        }
    });

    function showList(startPage, endPage) {
        let html = "";

        for (let i = (startPage - 1); i < endPage; i++) {
            let codenumber = video_list[i].codenumber;
            let materialname = video_list[i].materialname;
            let width = video_list[i].width.toLocaleString();
            let length = video_list[i].length.toLocaleString();
            let usewidth = video_list[i].usewidth.toLocaleString();
            let sqmprice = video_list[i].sqmprice.toLocaleString();
            let rollprice = video_list[i].rollprice.toLocaleString();
            let unit = video_list[i].unit;
            let lifetime = video_list[i].lifetime;
            let num = video_list[i].num;
            let manufacterer = video_list[i].manufacterer;
            let supplier = video_list[i].supplier;
            let usagecategory = video_list[i].usagecategory;
            let typecategory = video_list[i].typecategory;
            let companycategory = video_list[i].companycategory;
            let materialtype = video_list[i].materialtype;
            let color = video_list[i].color;
            let thickness = video_list[i].thickness;
            let adhesionstrength = video_list[i].adhesionstrength;
            let adhesive = video_list[i].adhesive;
            let fabricweight = video_list[i].fabricweight;
            let requester = video_list[i].requester;
            let modificationdate = video_list[i].modificationdate;
            let registrationreason = video_list[i].registrationreason;
            let customer = video_list[i].customer;
            let modelname = video_list[i].modelname;

            html += `<tr class="alert" role="alert">
                        <td>${codenumber}</td>
                        <td>${materialname}</td>
                        <td>${width}</td>
                        <td>${length}</td>
                        <td>${usewidth}</td>
                        <td>${sqmprice}</td>
                        <td>${rollprice}</td>
                        <td>${unit}</td>
                        <td>${lifetime}</td>
                        <td>${num}</td>
                        <td>${manufacterer}</td>
                        <td>${supplier}</td>
                        <td>${usagecategory}</td>
                        <td>${typecategory}</td>
                        <td>${companycategory}</td>
                        <td>${materialtype}</td>
                        <td>${color}</td>
                        <td>${thickness}</td>
                        <td>${adhesionstrength}</td>
                        <td>${adhesive}</td>
                        <td>${fabricweight}</td>
                        <td>${requester}</td>
                        <td>${modificationdate}</td>
                        <td>${registrationreason}</td>
                        <td>${customer}</td>
                        <td>${modelname}</td>
                 
                    </tr>`;
        }
        document.getElementById("html_list").innerHTML = html;
    }

    function setPageHtml() {
        let pageHtml = '';

        const maxVisiblePages = 10; // Set the maximum number of visible pages

        let startPage = 1;
        let endPage = totalPage;

        if (totalPage > maxVisiblePages) {
            const halfMaxVisiblePages = Math.floor(maxVisiblePages / 2);

            if (nowPage > halfMaxVisiblePages) {
                startPage = nowPage - halfMaxVisiblePages;
                endPage = nowPage + halfMaxVisiblePages;

                if (endPage > totalPage) {
                    endPage = totalPage;
                    startPage = totalPage - maxVisiblePages + 1;
                }
            } else {
                endPage = maxVisiblePages;
            }
        }

        pageHtml += `<li class="page-item">
                        <a href="#;" class="page-link" onClick="changePage('first');return false;">First</a>
                    </li>
                    <li class="page-item">
                        <a href="#" class="page-link" onClick="changePage('prev');return false;">Prev</a>
                    </li>`;

        for (let i = startPage; i <= endPage; i++) {
            pageHtml += `<li class="page-item">
                            <a href="#;" class="page-link" onClick="changePage(${i});return false;">${i}</a>
                        </li>`;
        }

        pageHtml += `<li class="page-item">
                        <a href="#;" class="page-link" onClick="changePage('next');return false;">Next</a>
                    </li>
                    <li class="page-item">
                        <a href="#;" class="page-link" onClick="changePage('last');return false;">Last</a>
                    </li>`;

        document.getElementById("paging").innerHTML = pageHtml;
    }

    function setList(page) {
        // 페이지 당 표시 될 튜플 수
        let pageCount = 15;
        page = page == null ? 1 : page;

        // 표시될 첫 게시글
        let startPage = (page - 1) * pageCount + 1;
        // 표시될 마지막 게시글
        let endPage = startPage + pageCount - 1;
        // if(마지막 게시글 > 총 게시글) 총 게시글을 마지막 게시글로
        endPage = endPage > video_list.length ? video_list.length : endPage;

        showList(startPage, endPage);

        let html = `${page}/${totalPage} 쪽 [총 <strong>${video_list.length.toLocaleString()}</strong>건]`;
        document.getElementById("page_info").innerHTML = html;

        // 변경된 페이지 표시
        document.querySelectorAll("#paging li").forEach((item) => {
            let str = item.querySelector("#paging li a").innerText;
            if (str.includes(page)) {
                item.classList.add("active");
            } else {
                item.classList.remove("active");
            }
        });
    }

    /**
     * 페이지 클릭 이벤트
     * @param page
     * @returns
     */
    function changePage(page) {
        log("page ==> " + page);

        // 현재 페이지
        let nowPage = parseInt(document.querySelector("#paging .active a").innerText);
        log("nowPage --> " + nowPage);

        if (page === "first") {
            page = "1";
        } else if (page === "prev") {
            page = (nowPage - 1) < 1 ? nowPage : (nowPage - 1);
        } else if (page === "next") {
            page = (nowPage + 1) > totalPage ? totalPage : (nowPage + 1);
        } else if (page === "last") {
            page = totalPage;
        }

        if (nowPage != page)
            setList(page);
    }

    let columnFilter = {
        index: -1,
        order: 'asc'
    };

    // Function to handle column header click
    function handleColumnClick(index) {
        columnFilter.index = index;

        if (columnFilter.order === 'asc') {
            columnFilter.order = 'desc';
        } else {
            columnFilter.order = 'asc';
        }

        // Update the sorting icon
        updateSortingIcons();

        // Apply the filter
        applyColumnFilter();
    }

    // Function to update sorting icons in the header
    function updateSortingIcons() {
        $('.table th i').removeClass('fa-sort-up fa-sort-down');

        if (columnFilter.order === 'asc') {
            $('.table th').eq(columnFilter.index).find('i').addClass('fas fa-sort-up');
        } else {
            $('.table th').eq(columnFilter.index).find('i').addClass('fas fa-sort-down');
        }
    }


</script>


</html>
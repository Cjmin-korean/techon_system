<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>영업수주등록</title>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="../css/main.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>

</head>
<style>
    /* 스타일링을 추가하세요 */
    /* 중복된 데이터를 표시할 스타일 */
    .duplicate-row {
        background-color: red;
        /* 빨간색 배경 */
        color: white;
        /* 흰색 텍스트 */
        font-weight: bold;
        /* 굵은 글씨체 */
    }


    table {
        width: 100%;
        border-collapse: collapse;
    }

    th,
    td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: center;
    }

    th {
        background-color: #007bff;
        color: #fff;
    }

    /* 모달 스타일 */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        justify-content: center;
        align-items: center;
        z-index: 999;
        /* 모달을 다른 요소 위에 표시하기 위한 z-index 설정 */
    }

    .modal-content {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        max-width: 80%;
    }

    /* 내부 테이블 스타일 */
    .modal-content table {
        width: 100%;
    }

    .modal-content th,
    .modal-content td {
        padding: 16px;
    }

    /* 스크롤 가능한 컨테이너 스타일 */
    .table-container {
        max-height: 300px;
        /* 원하는 높이로 조정 */
        overflow-y: auto;
        /* 세로 스크롤 활성화 */
    }

    /* 버튼 스타일 */
    .modal-button {
        background-color: #007bff;
        color: #fff;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
    }

    .modal-button:hover {
        background-color: #0056b3;
    }

    #datatable-container {
        max-height: 1000px;
        /* Adjust the maximum height as needed */
        overflow-y: auto;
        /* Add vertical scrollbars if the content exceeds the container height */
    }

    #datatable {
        width: 100%;
        /* Other table styles */
    }

    .notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #f0f0f0;
        padding: 10px;
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        z-index: 9999;
        display: flex;
        align-items: center;
    }

    .notification img {
        width: 100px;
        height: 50px;
        margin-right: 10px;
    }

    .notification-message {
        font-size: 16px;
        color: #333;
    }

    #customer-select {
        padding: 8px;
        font-size: 14px;
        border: none;
        background-color: #f2f2f2;
        border-radius: 4px;
        width: 100%;
        box-sizing: border-box;
    }

    #house-select {
        display: block;
        width: 100%;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    .custom-file-input {
        background-color: #007bff;
        color: #fff;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 12px;
        display: inline-block;
        /* 인라인 요소로 표시 */
        position: relative;
        /* 위치를 상대적으로 설정 */
    }

    .custom-file-label {
        font-size: 16px;
        padding: 5px 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        display: inline-block;
        /* 인라인 요소로 표시 */
    }
</style>

<body>



    <div class="main_header">
        <a>원자재입고</a>
        <div class="buttons" style="display: flex; justify-content: flex-end;">
            <button onclick="New()">입고추가</button>
            <button onclick="New1()">QRcode</button>
            <div id="uploadContainer">
                <label class="custom-file-input">
                    엑셀 파일 선택
                    <input type="file" id="excelFileInput" onchange="uploadExcelFile()" onclick="resetFileInput()">
                    <!-- <button onclick="resetFileInput()">리셋</button> -->
                </label>
            </div>
        </div>

    </div>
    <div id="myModal" class="modal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation();">
            <span onclick="closeModal()" style="cursor: pointer; float: right;">&times;</span>
            <h3>엑셀 데이터</h3>
            <!-- 테이블을 감싸는 스크롤 가능한 컨테이너 추가 -->
            <div class="table-container">
                <div id="excelData">
                    <!-- 엑셀 데이터를 여기에 표시합니다. -->
                </div>
            </div>
            <!-- 버튼 추가 -->
            <button class="modal-button" onclick="SaveModal()">데이터 저장</button>
        </div>
    </div>
    <div id="loadingOverlay">
        <img src="/img/테크온로고.PNG" alt="로딩 이미지" class="loadingImage">

    </div>
    <div class="form-group">
        <table style="width:30%;">
            <tr>
                <td style="width: 100px; background-color: whitesmoke;">입고날짜</td>
                <td style="width: 100px;"> <input type="date" id="datepicker2"
                        style="width:100%; display: inline-block; font-size: 15px; font-weight:bold; padding: 6px 12px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;">
                </td>
                <td style="width: 100px;"> <input type="date" id="datepicker3"
                        style="width:100%; display: inline-block; font-size: 15px; font-weight:bold; padding: 6px 12px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;">
                </td>
                <td style="width: 50px;"> <input type="button" value="조회" onclick="POsearching()"
                        style="width:100%; cursor: pointer; display: inline-block; font-size: 15px; font-weight:bold; padding: 6px 12px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; background-color: navy; color: white;">
                </td>
            </tr>
        </table>

    </div>


    <!-- 등록창 -->
    <div id="popupOverlay" style="display: none;">
        <div id="popupContent" style="width: 70%; height: auto;">
            <div class="form-group">
                <table style="width: 100%;">
                    <tr>
                        <td colspan="4" style="width: 200px; background-color: black; color: white;">원자재입고등록</td>
                    </tr>




                </table>


            </div>
            <div>
                <button style="float: right;" id="popupCloseBtn-search">원자재조회</button>
            </div>

            <br>

            <div style="width:100%; max-height: 600px; overflow-y: scroll;">
                <table class="styled-table" id="Podatatable">
                    <thead>
                        <tr>
                            <th>자재명</th>
                            <th>LOTNO</th>
                            <th>자재폭(mm)</th>
                            <th>제조일자</th>
                            <th>만료일자</th>
                            <th>수량(M)</th>
                            <th>수입검사</th>
                            <th style="width:100px;"></th>
                            <th style="width:100px;"></th>
                        </tr>
                    </thead>
                    <tbody id="POdatatbody">
                    </tbody>
                    <tfoot>
                        <tr>
                            <td style="border:1px solid silver; background-color:whitesmoke;" colspan="7">합계</td>
                            <td style="border:1px solid silver; text-align:right;"><strong>0
                                </strong></td>
                            <td style="border:1px solid silver; text-align:right;"><strong>0
                                </strong></td>
                            <td style="border:1px solid silver; background-color:whitesmoke; " colspan="2"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>


            <button id="popupCloseBtn-save-close">취소</button>
            <button id="popupCloseBtn-save" onclick="Datasave()">저장</button>
        </div>
    </div>


    <div id="popupOverlaycontent" style="display: none;">
        <div id="popupContentcontent" style="width: 70%; height: auto;">
            <div class="form-group">
                <table style="width: 85%;">
                    <tr>
                        <td colspan="4" style="width: 200px; background-color: black; color: white;">영업수주등록</td>
                    </tr>
                    <tr>
                        <td style="width: 25%; background-color: whitesmoke;">고객사</td>
                        <td><input type="text" id="customer-content" class="data" autocomplete="off" readonly
                                style="width:100%; border:1px solid silver;"></td>
                        <td style="width: 25%; background-color: whitesmoke;">납기일자</td>
                        <td style="width: 25%; background-color: whitesmoke;">

                            <input type="date" id="datepicker-content"
                                style="width:100%; display: inline-block; font-size: 15px; font-weight:bold; padding: 6px 12px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;">
                        </td>
                    </tr>



                </table>


            </div>
            <div>
                <button style="float: right;" id="popupCloseBtn-search">품목조회</button>
            </div>

            <br>

            <div style="width:100%; max-height: 600px; overflow-y: scroll;">
                <table class="styled-table" id="POdatatable-content">
                    <thead>
                        <tr>
                            <th>품목코드</th>
                            <th>BOMNO</th>
                            <th>모델명</th>
                            <th>품목명</th>
                            <th>고객사</th>
                            <th>원가(원)</th>
                            <th>단가(원)</th>
                            <th>PO수량(개)</th>
                            <th>판매금액(원)</th>
                            <th style="width:100px;"></th>
                            <th style="width:100px;"></th>
                        </tr>
                    </thead>
                    <tbody id="POtable-tbody">
                    </tbody>
                    <tfoot>
                        <tr>
                            <td style="border:1px solid silver; background-color:whitesmoke;" colspan="7">합계</td>
                            <td style="border:1px solid silver; text-align:right;"><strong>0
                                </strong></td>
                            <td style="border:1px solid silver; text-align:right;"><strong>0
                                </strong></td>
                            <td style="border:1px solid silver; background-color:whitesmoke; " colspan="2"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>


            <button id="popupCloseBtn-content-close">취소</button>
            <button id="popupCloseBtn-content" onclick="Datasave()">수정</button>
        </div>
    </div>



    <div class="main_header" style="background-color:rgb(0, 0, 0); color:white; width: 100%;">
        <a>원자재 입고 정보</a>

    </div>
    <div id="datatable-container">
        <table class="styled-table" id="materialdatatable">

            <thead>

                <tr>
                    <th>구분</th>
                    <th>입고날짜</th>
                    <th>자재명</th>
                    <th>분류</th>
                    <th>고객사</th>
                    <th>자재채번</th>
                    <th>LOTNO</th>
                    <th>제조일자</th>
                    <th>만료일자</th>
                    <th>자재폭(mm)</th>
                    <th>단가(원)</th>
                    <th>롤</th>
                    <th>수량(M)</th>
                    <th>금액(원)</th>
                    <th>창고위치</th>
                    <th>입고상태</th>

                    <th style="background-color:rgb(82, 80, 80); color:white; width:100px;"><input type="checkbox"
                            id="rollchange">롤 Group</th>
                    <th style="background-color:rgb(82, 80, 80); color:white; width:100px;"></th>
                </tr>
            </thead>
            <tbody id="materialinputtbody">
            </tbody>
        </table>
    </div>
    <!-- 품목조회창 -->
    <div id="popupOverlay3" style="display: none;">
        <div id="popupContent3" style="width: 60%; height: auto;">

            <div style="width:100%; max-height: 600px; overflow-y: scroll;">
                <table class="styled-table" id="datatable">

                    <thead>
                        <tr>
                            <td colspan="9" style="width: 200px; background-color: black; color: white;">원자재 (Material)
                                정보
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3" style="width: 200px; background-color: whitesmoke; color: black;">자재검색</td>
                            <td colspan="6"> <input type="text" id="myInput1" onkeydown="handleKeyPress(event)"
                                    class="data" autocomplete="off" style="width:auto; border:1px solid silver;"></td>
                        </tr>
                        <tr>
                            <th>원자재명</th>
                            <th>원자재코드</th>
                            <th>분류</th>
                            <th>자재폭(mm)</th>
                            <th>고객사</th>
                            <th>유수명(일)</th>
                            <th>단가(원)</th>
                            <th>수입검사(Y/N)</th>
                            <th style="background-color: silver; color:black;" style="width:100px;"></th>
                        </tr>
                    </thead>
                    <tbody id="Datatbody">
                    </tbody>
                </table>
            </div>
            <button id="popupCloseBtn-search-close">닫기</button>

        </div>

    </div>




    <!-- 수정창 -->
    <div id="popupOverlay1" style="display: none;">
        <div id="popupContent1" style="width: 700px; height: auto;">
            <div class="form-group">
                <table style="width:100%;">
                    <tr>
                        <td style="background-color: black; color: white;">원자재 입고 추가</td>
                        <td style="visibility: hidden;"><input type="text" id="id-edit" class="data" autocomplete="off"
                                style="width:auto; border:1px solid silver; "></td>

                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke;">구분</td>
                        <td><input type="text" id="input" class="data" autocomplete="off" readonly
                                style="width:auto; border:1px solid silver;" value="원자재입고"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke;">자재명</td>
                        <td><input type="text" id="materialname" class="data" autocomplete="off" readonly
                                style="width:auto; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke;">원자재코드</td>
                        <td><input type="text" id="materialcode" class="data" autocomplete="off" readonly
                                style="width:auto; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke;">분류</td>
                        <td><input type="text" id="classification" class="data" autocomplete="off" readonly
                                style="width:auto; border:1px solid silver;"></td>
                    </tr>

                    <tr>
                        <td style="width: 200px; background-color: whitesmoke;">고객사</td>
                        <td><input type="text" id="customer" class="data" autocomplete="off" readonly
                                style="width:auto; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke;">유수명(일)</td>
                        <td><input type="text" id="day" class="data" autocomplete="off" readonly
                                style="width:auto; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke; ">수입검사</td>
                        <td><input type="text" id="inspection" class="data" autocomplete="off" readonly
                                style="width:auto; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke; ">단가(원)</td>
                        <td><input type="text" id="sqmprice" class="data" autocomplete="off" readonly
                                style="width:auto; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke; color: blue;">자재폭(mm)</td>
                        <td><input type="text" id="materialwidth" class="data" autocomplete="off"
                                style="width:auto; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke; color: blue;">수량(M) [1Roll기준]</td>
                        <td><input type="text" id="quantity" class="data" autocomplete="off"
                                style="width:auto; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke; color: blue;">롤(roll)</td>
                        <td><input type="text" id="roll" class="data" autocomplete="off"
                                style="width:auto; border:1px solid silver;"></td>
                    </tr>

                    <tr>
                        <td style="width: 200px; background-color: whitesmoke; color: blue;">LOT</td>
                        <td><input type="text" id="lotno" class="data" autocomplete="off"
                                style="width:auto; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke; color: blue;">입고창고</td>
                        <td><select id="house-select">
                                <option></option>

                            </select></td>
                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke; color: blue;">제조일자</td>
                        <td style="width: 100px;"> <input type="date" id="datepicker1"
                                style="width:100%; display: inline-block; font-size: 15px; font-weight:bold; padding: 6px 12px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;">
                        </td>
                    </tr>

                </table>
            </div>
            <button id="popupCloseBtn-edit-close">취소</button>
            <button id="popupCloseBtn-edit" onclick="Dataedit()">추가</button>
        </div>
    </div>


    <!-- 영업수량수정창 -->
    <div id="popupOverlay4" style="display: none;">
        <div id="popupContent4" style="width: 700px; height: 550px;">
            <div class="form-group">
                <table style="width:100%;">
                    <tr>
                        <td style="background-color: black; color: white;">PO Item 수정</td>
                        <td><input type="text" id="id-POedit" class="data" autocomplete="off"
                                style="width:100%; border:1px solid silver; "></td>

                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke;">품목코드</td>
                        <td><input type="text" id="itemcode-POedit" class="data" autocomplete="off" readonly
                                style="width:100%; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke;">BOMNO</td>
                        <td><input type="text" id="bomno-POedit" class="data" autocomplete="off" readonly
                                style="width:100%; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke;">모델명</td>
                        <td><input type="text" id="modelname-POedit" class="data" autocomplete="off" readonly
                                style="width:100%; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke;">제품명</td>
                        <td><input type="text" id="itemname-POedit" class="data" autocomplete="off" readonly
                                style="width:100%; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke;">고객사</td>
                        <td><input type="text" id="customer-POedit" class="data" autocomplete="off" readonly
                                style="width:100%; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke;">단가(원)</td>
                        <td><input type="text" id="itemprice-POedit" class="data" autocomplete="off" readonly
                                style="width:100%; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke; ">원가(원)</td>
                        <td><input type="text" id="cost-POedit" class="data" autocomplete="off" readonly
                                style="width:100%; border:1px solid silver;"></td>
                    </tr>

                    <tr>
                        <td style="width: 200px; background-color: whitesmoke; color: blue;">PO수량</td>
                        <td><input type="text" id="count-POedit" class="data" autocomplete="off"
                                style="width:100%; border:1px solid silver;"></td>
                    </tr>


                </table>
            </div>
            <button id="popupCloseBtn-POedit-close">취소</button>
            <button id="popupCloseBtn-POedit" onclick="PODataedit()">수정</button>
        </div>
    </div>


    <!-- 삭제창 -->
    <div id="popupOverlay2" style="display: none;">
        <div id="popupContent2" style="width: 700px; height: auto;">
            <div class="form-group">
                <table style="width:100%;">
                    <tr>
                        <td style="background-color: black; color: white; width: 200px;">QRcode</td>
                        <td style="visibility: hidden;"><input type="text" id="id-edit" class="data" autocomplete="off"
                                style="width:100%; border:1px solid silver; "></td>

                    </tr>
                    <tr>
                        <td style="width: 200px; background-color: whitesmoke; color: blue;">QRcode</td>
                        <td><input type="text" id="qrcode" class="data" autocomplete="off"
                                style="width:100%; border:1px solid silver;" onkeydown="handleKeyPress1(event)"></td>
                    </tr>

                </table>
            </div>
            <button id="popupCloseBtn-delete-close">취소</button>
            <button id="popupCloseBtn-delete" class="podelete" onclick="POdelte()">삭제</button>
        </div>
    </div>

    <script>
        var server = '';

        if (window.location.hostname == 'localhost') {
            server = 'http://localhost:8080';
        } else {
            server = 'http://techonmes.co.kr';
        }
        $(document).ready(function () {
            showLoading()
            settingDate()
            $('#count-edit').on('input', function () {
                var value = $(this).val().replace(/[^0-9]/g, ''); // 숫자 이외의 문자 제거
                if (value === '') {
                    $(this).val('');
                } else {
                    $(this).val(parseInt(value, 10).toLocaleString());
                }
            });


            load()

            $.ajax({
                type: 'POST',
                url: server + '/api/materialbase',
                dataType: 'json',
                success: function (data) {
                    for (var i = 0; i < data.length; i++) {


                        $('#datatable').append(
                            '<tr>' +
                            '<td>' + data[i].materialname + '</td>' +
                            '<td>' + data[i].codenumber + '</td>' +
                            '<td>' + data[i].classification + '</td>' +
                            '<td>' + data[i].fullwidth + '</td>' +
                            '<td>' + data[i].customer + '</td>' +
                            '<td>' + data[i].day + '</td>' +
                            '<td>' + data[i].sqmprice + '</td>' +
                            '<td>' + data[i].inspection + '</td>' +

                            '<td><a class="data-edit" style="cursor:pointer; color:navy;">추가</a></td>' +


                            '</tr>'

                        );

                    }
                }
            });




            $('#POdatatable').on('click', '.data-content', function () {
                var str = "";
                var tdArr = new Array();// 배열 선언            
                var checkBtn = $(this);

                var tr = checkBtn.parent().parent();
                var td = tr.children();

                var accountname = td.eq(2).text();
                var dd = td.eq(1).text();

                $('#popupOverlaycontent').fadeIn()
                $('#customer-content').val(accountname)

                $.ajax({
                    type: 'POST',
                    url: server + '/api/POaccountinputponum',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        ponum: td.eq(3).text()
                    }),
                    success: function (result) {
                        for (var i = 0; i < result.length; i++) {
                            $('#POdatatbody-content-tbody').empty()
                            $('#POdatatable-content').append(
                                '<tr>' +
                                '<td>' + result[i].itemcode + '</td>' +
                                '<td>' + result[i].bomno + '</td>' +
                                '<td>' + result[i].modelname + '</td>' +
                                '<td>' + result[i].itemname + '</td>' +
                                '<td>' + result[i].customer + '</td>' +
                                '<td>' + result[i].itemcost + '</td>' +
                                '<td>' + result[i].itemprice + '</td>' +
                                '<td>' + result[i].quantity + '</td>' +
                                '<td>' + result[i].price + '</td>' +
                                '<td><a class="data-edit"  style="cursor:pointer; color:blue;">수정</a></td>' +
                                '<td><a class="data-edit"  style="cursor:pointer; color:red;">삭제</a></td>' +
                                '</tr>'

                            )

                        }

                    }

                })

                $('#datepicker-content').val(dd)
                var total8 = 0;
                var total9 = 0;
                $('#POdatatable-content td:nth-child(8)').each(function () {
                    var count8 = parseFloat($(this).text().replace(/,/g, ''));
                    if (!isNaN(count8)) {
                        total8 += count8;
                    }
                });

                $('#POdatatable-content td:nth-child(9)').each(function () {
                    var count9 = parseFloat($(this).text().replace(/,/g, ''));
                    if (!isNaN(count9)) {
                        total9 += count9;
                    }
                });
                // 합계 표시
                $('#POdatatable-content tfoot').remove(); // 기존의 tfoot 제거
                $('#POdatatable-content').append(
                    '<tfoot>' +
                    '<tr>' +
                    '<td style="border:1px solid silver; background-color:whitesmoke;"colspan="7">합계</td>' +
                    '<td style="border:1px solid silver; text-align:right;"><strong>' + addCommas(total8.toFixed(0)) + '</strong></td>' +
                    '<td style="border:1px solid silver; text-align:right;"><strong>' + addCommas(total9.toFixed(0)) + '</strong></td>' +
                    '<td style="border:1px solid silver; background-color:whitesmoke; "colspan="2"></td>' +
                    '</tr>' +
                    '</tfoot>'
                );
            })

            $('#datatable').on('click', '.data-edit', function () {
                var str = "";
                var tdArr = new Array();// 배열 선언            
                var checkBtn = $(this);

                var tr = checkBtn.parent().parent();
                var td = tr.children();

                var materialname = td.eq(0).text();
                var materialcode = td.eq(1).text();
                var classification = td.eq(2).text();
                var materialwidth = td.eq(3).text();
                var customer = td.eq(4).text();
                var day = td.eq(5).text();
                var sqmprice = td.eq(6).text();
                var inspection = td.eq(7).text();


                $('#materialname').val(materialname)
                $('#materialcode').val(materialcode)
                $('#classification').val(classification)
                $('#materialwidth').val('')
                $('#customer').val(customer)
                $('#day').val(day)
                $('#sqmprice').val(sqmprice)


                $('#inspection').val(inspection)

                $('#roll').val('')
                $('#quantity').val('')
                $('#lotno').val('')

                $('#popupOverlay1').fadeIn();
                $('#materialwidth').focus()
            });

            $('#Podatatable').on('click', '.POdata-edit', function () {
                var clickedRow = $(this); // 클릭한 행(tr) 요소
                var rowIndex = clickedRow.index() + 1; // 클릭한 행의 인덱스 + 1

                var str = "";
                var tdArr = new Array();// 배열 선언            
                var checkBtn = $(this);

                var tr = checkBtn.parent().parent();
                var td = tr.children();

                var itemcode = td.eq(0).text();
                var bomno = td.eq(1).text();
                var modelname = td.eq(2).text();
                var itemname = td.eq(3).text();
                var customer = td.eq(4).text();
                var itemprice = td.eq(5).text();
                var cost = td.eq(6).text();
                var costpg = td.eq(7).text();

                $('#itemcode-POedit').val(itemcode)
                $('#bomno-POedit').val(bomno)
                $('#modelname-POedit').val(modelname)
                $('#itemname-POedit').val(itemname)
                $('#customer-POedit').val(customer)
                $('#itemprice-POedit').val(itemprice)
                $('#cost-POedit').val(cost)
                $('#costpg-POedit').val(costpg)
                $('#count-POedit').val('')
                $('#id-POedit').val(rowIndex)
                $('#popupOverlay4').fadeIn();
                $('#count-POedit').focus()
            });




            $('#datatable').on('click', '.data-delete', function () {
                var str = "";
                var tdArr = new Array();// 배열 선언            
                var checkBtn = $(this);

                var tr = checkBtn.parent().parent();
                var td = tr.children();


                var id = td.eq(10).text();
                $('#id-edit').val(id)
                $('#popupOverlay2').fadeIn();
            });


            $('#popupCloseBtn-save-close').click(function () {
                $('#popupOverlay').fadeOut();
            });
            $('#popupCloseBtn-edit-close').click(function () {
                $('#popupOverlay1').fadeOut();
            });
            $('#popupCloseBtn-delete-close').click(function () {
                $('#popupOverlay2').fadeOut();
            });
            $('#popupCloseBtn-search-close').click(function () {
                $('#popupOverlay3').fadeOut();
            });
            $('#popupCloseBtn-search').click(function () {

                $('#popupOverlay3').fadeIn();
                $('#myInput1').focus()
            });
            $('#popupCloseBtn-content-close').click(function () {
                $('#popupOverlaycontent').fadeOut();
            });
            $('#popupCloseBtn-POedit-close').click(function () {
                $('#popupOverlay4').fadeOut();
            });


            const selectElement = document.getElementById("house-select");
            if (selectElement) {
                $.ajax({
                    type: 'POST',
                    url: server + '/api/housegroup',
                    dataType: 'json',
                    contentType: 'application/json',
                    success: function (result) {
                        for (let i = 0; i < result.length; i++) {
                            const option = document.createElement("option");
                            option.text = result[i].housename;
                            option.value = result[i].housename;
                            selectElement.add(option);
                        }
                    },
                });
            }

        });



        //오름차순 내림차순
        function sortTable(columnIndex) {
            var table, rows, switching, i, x, y, shouldSwitch, direction, switchcount = 0;
            table = document.getElementById("datatable");
            switching = true;
            direction = "asc"; // 기본 정렬 방향은 오름차순

            while (switching) {
                switching = false;
                rows = table.getElementsByTagName("tr");

                for (i = 1; i < (rows.length - 1); i++) {
                    shouldSwitch = false;
                    x = rows[i].getElementsByTagName("td")[columnIndex];
                    y = rows[i + 1].getElementsByTagName("td")[columnIndex];

                    if (direction == "asc") {
                        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                            shouldSwitch = true;
                            break;
                        }
                    } else if (direction == "desc") {
                        if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                            shouldSwitch = true;
                            break;
                        }
                    }
                }

                if (shouldSwitch) {
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                    switchcount++;
                } else {
                    if (switchcount == 0 && direction == "asc") {
                        direction = "desc";
                        switching = true;
                    }
                }
            }
        }

        //검색
        function search() {
            const searchInput = document.getElementById('myInput');
            const dataTable = document.getElementById('datatable');
            const tableRows = dataTable.getElementsByTagName('tr');

            searchInput.addEventListener('input', function () {
                const searchValue = this.value.toLowerCase();

                for (let i = 1; i < tableRows.length; i++) {
                    const rowData = tableRows[i].getElementsByTagName('td');

                    let found = false;

                    for (let j = 0; j < rowData.length; j++) {
                        const cellData = rowData[j].textContent.toLowerCase();

                        if (cellData.includes(searchValue)) {
                            found = true;
                            break;
                        }
                    }

                    if (found) {
                        tableRows[i].style.display = '';
                    } else {
                        tableRows[i].style.display = 'none';
                    }

                }
            });
        }
        function showLoading() {
            var loadingOverlay = document.getElementById("loadingOverlay");
            loadingOverlay.style.display = "flex";

            // 로딩 완료 후 일정 시간 후 로딩 창 숨기기 (테스트용)
            setTimeout(function () {
                loadingOverlay.style.display = "none";
            }, 1000);
        }

        function New() {
            $('#Datatbody').empty();

            $('#popupOverlay3').fadeIn();
            $('#myInput1').focus()
            $('#myInput1').val('')
        }
        function New1() {


            $('#popupOverlay2').fadeIn();
            $('#qrcode').focus()
            $('#qrcode').val('')
        }

        function Datasave() {

        }
        function PODataedit() {



            if ($('#count-POedit').val() === '' || $('#count-POedit').val() === '0') {
                var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span style="font-weight:bold; color:red;" class="notification-message">PO수량 확인바랍니다</span></div>');
                $('body').append(notification);
                setTimeout(function () {
                    notification.fadeOut(function () {
                        $(this).remove();
                    });
                }, 3000);

            } else {
                var tr = $(this).closest('tr'); // 현재 버튼이 속한 행(tr)을 가져옵니다.
                var tdArr = tr.find('td'); // 행(tr)에서 모든 셀(td)을 가져옵니다.

                var POeditcount = $('#count-POedit', window.opener.document).val(); // 다른 창에서 값을 가져옵니다.

                // 원하는 셀에 접근하여 값을 변경합니다.
                tdArr.eq(7).text(POeditcount); // 8번째 셀의 값을 변경 (0부터 시작하는 인덱스)


                $('#popupOverlay4').fadeOut();

                var total8 = 0;
                var total9 = 0;
                $('#Podatatable td:nth-child(8)').each(function () {
                    var count8 = parseFloat($(this).text().replace(/,/g, ''));
                    if (!isNaN(count8)) {
                        total8 += count8;
                    }
                });

                $('#Podatatable td:nth-child(9)').each(function () {
                    var count9 = parseFloat($(this).text().replace(/,/g, ''));
                    if (!isNaN(count9)) {
                        total9 += count9;
                    }
                });
                // 합계 표시
                $('#Podatatable tfoot').remove(); // 기존의 tfoot 제거
                $('#Podatatable').append(
                    '<tfoot>' +
                    '<tr>' +
                    '<td style="border:1px solid silver; background-color:whitesmoke;"colspan="7">합계</td>' +
                    '<td style="border:1px solid silver; text-align:right;"><strong>' + addCommas(total8.toFixed(0)) + '</strong></td>' +
                    '<td style="border:1px solid silver; text-align:right;"><strong>' + addCommas(total9.toFixed(0)) + '</strong></td>' +
                    '<td style="border:1px solid silver; background-color:whitesmoke; "colspan="2"></td>' +
                    '</tr>' +
                    '</tfoot>'
                );

                var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span style="font-weight:bold; color:navy;" class="notification-message">PO수량 수정되었습니다</span></div>');
                $('body').append(notification);
                setTimeout(function () {
                    notification.fadeOut(function () {
                        $(this).remove();
                    });
                }, 3000); // 3초 후에 알림을 사라지게 설정
            }

        }

        function Dataedit() {
            if ($('#quantity').val() === '' || $('#roll').val() === '0') {
                var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span style="font-weight:bold; color:red;" class="notification-message">공란 확인바랍니다</span></div>');
                $('body').append(notification);
                setTimeout(function () {
                    notification.fadeOut(function () {
                        $(this).remove();
                    });
                }, 3000);

            } else {
                if (confirm("원자재 입고를 등록 하시겠습니까??") == true) {
                    // printpage()
                    const date = new Date();

                    var day = date.getDate();
                    var month = date.getMonth() + 1;
                    var year = date.getFullYear();

                    console.log((month).length, day.length)

                    if (month === 1 || month === 2 || month === 3 || month === 4 || month === 5 || month === 6 || month === 7 || month === 8 || month === 9) {
                        month = '0' + month
                        console.log(month)
                    }

                    if (day === 1 || day === 2 || day === 3 || day === 4 || day === 5 || day === 6 || day === 7 || day === 8 || day === 9) {
                        day = '0' + day
                        console.log(day)
                    }


                    // This arrangement can be altered based on how we want the date's format to appear.
                    let currentDate = `${year}-${month}-${day}`;

                    var materialname = $('#materialname').val();

                    var materialwidth = $('#materialwidth').val();
                    var materialwidthcomma = materialwidth.replace(/,/g, "");
                    var materialcode = $('#materialcode').val() + '-' + materialwidth.replace(/,/g, "");
                    var manufacturedate = $('#datepicker1').val();
                    var input = $('#input').val();
                    var house = $('#house-select').val();
                    var materialday = $('#day').val();
                    var customer = $('#customer').val();
                    var lotno = $('#lotno').val();
                    var roll = $('#roll').val();
                    var quantity = $('#quantity').val();
                    var sqmprice1 = $('#sqmprice').val();
                    var sqmprice = sqmprice1.replace(/,/g, "");
                    var classification = $('#classification').val();
                    var sum = $('#quantity').val() * $('#roll').val();;
                    var today = new Date();
                    var dd = String(today.getDate()).padStart(2, '0');
                    var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
                    var yyyy = today.getFullYear();

                    today = yyyy + '-' + mm + '-' + dd

                    var sumdate = new Date(Date.parse(manufacturedate) + parseInt(materialday) * 1000 * 60 * 60 * 24);
                    var sumdd = String(sumdate.getDate()).padStart(2, '0');
                    var summm = String(sumdate.getMonth() + 1).padStart(2, '0'); //January is 0!
                    var sumyyyy = sumdate.getFullYear();

                    var expirationdate = sumyyyy + '-' + summm + '-' + sumdd
                    var resultdate = sumyyyy + '-' + summm + '-' + sumdd

                    if ($('#input').val() == "원자재입고" && $('#inspection').val() == "Y") {
                        $.ajax({
                            type: 'POST',
                            url: server + '/api/inspection',
                            dataType: 'json',
                            contentType: 'application/json',
                            data: JSON.stringify({

                                "inputdate": currentDate,
                                "materialname": materialname,
                                "manufacturedate": manufacturedate,
                                "expirationdate": expirationdate,
                                "materialwidth": materialwidthcomma,
                                "lotno": lotno,
                                "quantity": quantity,
                            }),
                            success: function (result) {
                            }
                        })
                        for (i = 0; i < roll; i++) {
                            $.ajax({
                                type: 'POST',
                                url: server + '/api/materialinputsave',
                                dataType: 'json',
                                contentType: 'application/json',
                                data: JSON.stringify({

                                    "materialname": materialname,
                                    "input": input,
                                    "codenumber": materialcode,
                                    "manufacturedate": manufacturedate,
                                    "expirationdate": resultdate,
                                    "materialwidth": materialwidthcomma,
                                    "classification": classification,
                                    "customer": customer,
                                    "date": currentDate,
                                    "lotno": lotno,
                                    "quantity": quantity,
                                    "part": '수입검사대기',
                                    "sqmprice": sqmprice,
                                    "house": house
                                }),
                                success: function (result) {

                                }
                            })

                        }
                        setTimeout(function () {
                            load()
                        }, 50); // 3초 후에 알림을 사라지게 설정

                        var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span class="notification-message">' + $('#materialname').val() + '(' + $('#quantity').val() + ') 입고추가 완료.</span></div>');
                        $('body').append(notification);
                        setTimeout(function () {
                            notification.fadeOut(function () {
                                $(this).remove();
                            });
                        }, 3000); // 3초 후에 알림을 사라지게 설정

                    } else if ($('#input').val() == "원자재입고" && $('#inspection').val() == "N") {
                        for (i = 0; i < roll; i++) {
                            $.ajax({
                                type: 'POST',
                                url: server + '/api/materialinputsave',
                                dataType: 'json',
                                contentType: 'application/json',
                                data: JSON.stringify({

                                    "materialname": materialname,
                                    "input": input,
                                    "codenumber": materialcode,
                                    "manufacturedate": manufacturedate,
                                    "expirationdate": expirationdate,
                                    "materialwidth": materialwidthcomma,
                                    "customer": customer,
                                    "date": currentDate,
                                    "lotno": lotno,
                                    "quantity": quantity,
                                    "roll": '1',
                                    "sum": sum,
                                    "classification": classification,
                                    "sqmprice": sqmprice,
                                    "part": '입고완료',
                                    "house": house
                                }),
                                success: function (result) {

                                }
                            })
                        }
                        setTimeout(function () {
                            load()
                        }, 50); // 3초 후에 알림을 사라지게 설정
                        var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span class="notification-message">' + $('#materialname').val() + '(' + $('#quantity').val() + ') 입고추가 완료.</span></div>');
                        $('body').append(notification);
                        setTimeout(function () {
                            notification.fadeOut(function () {
                                $(this).remove();
                            });
                        }, 3000);

                    }

                }
            }




            $('#popupOverlay1').fadeOut();
        }



        // 천 단위마다 콤마를 추가하는 함수
        function addCommas(value) {
            return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function Datadelte() {
            $('#popupOverlay2').fadeIn();
        }


        $(document).on('click', '.data-delete', function () {
            $(this).closest('tr').remove();
            var total8 = 0;
            var total9 = 0;
            $('#Podatatable td:nth-child(8)').each(function () {
                var count8 = parseFloat($(this).text().replace(/,/g, ''));
                if (!isNaN(count8)) {
                    total8 += count8;
                }
            });

            $('#Podatatable td:nth-child(9)').each(function () {
                var count9 = parseFloat($(this).text().replace(/,/g, ''));
                if (!isNaN(count9)) {
                    total9 += count9;
                }
            });
            // 합계 표시
            $('#Podatatable tfoot').remove(); // 기존의 tfoot 제거
            $('#Podatatable').append(
                '<tfoot>' +
                '<tr>' +
                '<td style="border:1px solid silver; background-color:whitesmoke;"colspan="7">합계</td>' +
                '<td style="border:1px solid silver; text-align:right;"><strong>' + addCommas(total8.toFixed(0)) + '</strong></td>' +
                '<td style="border:1px solid silver; text-align:right;"><strong>' + addCommas(total9.toFixed(0)) + '</strong></td>' +
                '<td style="border:1px solid silver; background-color:whitesmoke; "colspan="2"></td>' +
                '</tr>' +
                '</tfoot>'
            );

            var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span class="notification-message"> 제품이 삭제되었습니다.</span></div>');
            $('body').append(notification);
            setTimeout(function () {
                notification.fadeOut(function () {
                    $(this).remove();
                });
            }, 3000); // 3초 후에 알림을 사라지게 설정
        });
        $(document).on('click', '.POdata-edit', function () {
        })




    </script>
    <script>
        function settingDate() {
            const date = new Date();

            var day = date.getDate();
            var month = date.getMonth() + 1;
            var year = date.getFullYear();


            if (month === 1 || month === 2 || month === 3 || month === 4 || month === 5 || month === 6 || month === 7 || month === 8 || month === 9) {
                month = '0' + month
            }

            if (day === 1 || day === 2 || day === 3 || day === 4 || day === 5 || day === 6 || day === 7 || day === 8 || day === 9) {
                day = '0' + day
            }


            // This arrangement can be altered based on how we want the date's format to appear.
            let currentDate = `${year}-${month}-${day}`;


            $('#datepicker1').val(currentDate);
            $('#datepicker2').val(currentDate);
            $('#datepicker3').val(currentDate);

        }
    </script>
    <script>
        function POsearching() {
            showLoading()
            var startDate = new Date($('#datepicker2').val());
            var endDate = new Date($('#datepicker3').val());

            if (startDate > endDate) {
                var notification = $('<div class="notification"><img src="/img/테크온로고.PNG" alt="Notification Icon"><span style="color:red;" class="notification-message">조회 기간 확인바랍니다.</span></div>');
                $('body').append(notification);
                setTimeout(function () {
                    notification.fadeOut(function () {
                        $(this).remove();
                    });
                }, 3000); // 3초 후에 알림을 사라지게 설정
            } else {
                load()
            };




        }


        function handleKeyPress(event) {
            if (event.keyCode === 13) { // Enter 키를 눌렀을 때

                $.ajax({
                    type: 'POST',
                    url: server + '/api/materialbaseinput',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        searchText: $('#myInput1').val()
                    }),
                    success: function (result) {
                        var uniqueMaterialNames = [];
                        var uniqueCodeNumbers = [];

                        // Get unique material names and code numbers
                        for (var i = 0; i < result.length; i++) {
                            var materialname = result[i].materialname;
                            var codenumber = result[i].codenumber;

                            if (!uniqueMaterialNames.includes(materialname)) {
                                uniqueMaterialNames.push(materialname);
                            }

                            if (!uniqueCodeNumbers.includes(codenumber)) {
                                uniqueCodeNumbers.push(codenumber);
                            }
                        }

                        // Clear the existing table body before adding grouped data
                        $('#Datatbody').empty();

                        // Create grouped rows
                        for (var i = 0; i < uniqueMaterialNames.length; i++) {
                            for (var j = 0; j < uniqueCodeNumbers.length; j++) {
                                var materialname = uniqueMaterialNames[i];
                                var codenumber = uniqueCodeNumbers[j];

                                // Filter data for the current materialname and codenumber
                                var groupData = result.filter(function (item) {
                                    return item.materialname === materialname && item.codenumber === codenumber;
                                });

                                if (groupData.length > 0) {
                                    // Create a new <tr> element for each row of data
                                    var newRow = '';

                                    for (var k = 0; k < groupData.length; k++) {
                                        var rowData = groupData[k];

                                        var textColor = '';
                                        if (rowData.inspection === 'Y') {
                                            textColor = 'blue';
                                        } else if (rowData.inspection === 'N') {
                                            textColor = 'red';
                                        }

                                        if (k === 0) {
                                            newRow +=
                                                '<tr>' +
                                                '<td rowspan="' + groupData.length + '">' + materialname + '</td>' +
                                                '<td rowspan="' + groupData.length + '">' + codenumber + '</td>';
                                        } else {
                                            newRow += '<tr>';
                                        }

                                        newRow +=
                                            '<td>' + rowData.classification + '</td>' +
                                            '<td style="text-align:right;">' + rowData.fullwidth + '</td>' +
                                            '<td>' + rowData.customer + '</td>' +
                                            '<td style="text-align:right;">' + rowData.day + '</td>' +
                                            '<td style="text-align:right;">' + rowData.sqmprice + '</td>' +
                                            '<td style="color:' + textColor + ';">' + rowData.inspection + '</td>';

                                        if (k === 0) {
                                            newRow += '<td rowspan="' + groupData.length + '"><a class="data-edit"  style="cursor:pointer; color:navy;">추가</a></td>';
                                        }

                                        newRow += '</tr>';
                                    }

                                    $('#Datatbody').append(newRow);
                                }
                            }
                        }

                        // Handle the Edit button click event
                        $('.data-edit').on('click', function () {
                            var row = $(this).closest('tr');
                            var materialName = row.find('td:first').text();
                            var codeNumber = row.find('td:eq(1)').text();
                            // Add your code to handle the edit action based on the materialName and codeNumber
                            // You can use this information to find the corresponding data and show an edit form, for example.
                            console.log('Add clicked for:', materialName, codeNumber);
                        });
                    }
                });





            }
        }
    </script>
    <script>
        function load() {
            $('#materialinputtbody').empty()
            $.ajax({
                type: 'POST',
                url: server + '/api/materialinputsearch',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    start: $('#datepicker2').val(),
                    finish: $('#datepicker3').val()
                }),
                success: function (data) {
                    // Group data by date
                    var groupedData = {};
                    var dateTotals = {}; // Object to store date-wise totals

                    for (var i = 0; i < data.length; i++) {
                        var date = data[i].date;

                        if (!groupedData[date]) {
                            groupedData[date] = [];
                            dateTotals[date] = {
                                sumquantity: 0,
                                sumroll: 0,
                                totalQuantity: 0
                            };
                        }

                        groupedData[date].push(data[i]);

                        var quantity = parseFloat(data[i].quantity.replace(/,/g, ''));
                        var materialWidth = parseFloat(data[i].materialwidth.replace(/,/g, ''));
                        var sqmprice = parseFloat(data[i].sqmprice.replace(/,/g, ''));
                        var multipliedValue = quantity * materialWidth / 1000 * sqmprice;

                        dateTotals[date].sumquantity += quantity;
                        dateTotals[date].sumroll += roll;
                        dateTotals[date].totalQuantity += multipliedValue;
                    }

                    var overallTotalQuantity = 0; // Variable to store the overall total quantity
                    var overallSumroll = 0; // Variable to store the overall total roll
                    var overallSumquantity = 0; // Variable to store the overall sum quantity

                    // Iterate over each date group
                    for (var date in groupedData) {
                        if (groupedData.hasOwnProperty(date)) {
                            // Create a group header row for the date
                            $('#materialdatatable').append(
                                '<tr>' +
                                '<td colspan="18" style="background-color: #f2f2f2;"><strong>' + date + '</strong></td>' +
                                '</tr>'
                            );

                            var groupData = groupedData[date]; // Get the data for the current date group
                            var sumquantity = 0; // Variable to store the sum quantity for the current date group
                            var sumroll = 0; // Variable to store the sum quantity for the current date group
                            var totalQuantity = 0; // Variable to store the total quantity for the current date group

                            for (var i = 0; i < groupData.length; i++) {
                                var part = groupData[i].part;
                                var backgroundColor = '';

                                if (part === '입고완료') {
                                    backgroundColor = 'blue';
                                } else if (part === '출고대기') {
                                    backgroundColor = 'red';
                                } else if (part === '수입검사대기') {
                                    backgroundColor = 'green';
                                }
                                var roll = parseFloat(groupData[i].roll.replace(/,/g, ''));
                                var quantity = parseFloat(groupData[i].quantity.replace(/,/g, ''));
                                var materialWidth = parseFloat(groupData[i].materialwidth.replace(/,/g, ''));
                                var sqmprice = parseFloat(groupData[i].sqmprice.replace(/,/g, ''));

                                sumquantity += quantity;
                                sumroll += roll;
                                var multipliedValue = quantity * materialWidth / 1000 * sqmprice;
                                totalQuantity += multipliedValue;

                                var classification = groupData[i].classification !== null ? groupData[i].classification : '';
                                var lotno = groupData[i].lotno !== null ? groupData[i].lotno : '';
                                var manufacturedate = groupData[i].manufacturedate !== null ? groupData[i].manufacturedate : '';
                                var expirationdate = groupData[i].expirationdate !== null ? groupData[i].expirationdate : '';

                                $('#materialdatatable').append(
                                    '<tr>' +
                                    '<td>' + groupData[i].input + '</td>' +
                                    '<td>' + groupData[i].date + '</td>' +
                                    '<td>' + groupData[i].materialname + '</td>' +
                                    '<td>' + classification + '</td>' +
                                    '<td>' + groupData[i].customer + '</td>' +
                                    '<td>' + groupData[i].codenumber + '</td>' +
                                    '<td>' + lotno + '</td>' +
                                    '<td>' + manufacturedate + '</td>' +
                                    '<td>' + expirationdate + '</td>' +
                                    '<td style="text-align:right;">' + groupData[i].materialwidth.toLocaleString() + '</td>' +
                                    '<td style="text-align:right;">' + groupData[i].sqmprice.toLocaleString() + '</td>' +
                                    '<td style="text-align:right;">' + groupData[i].roll.toLocaleString() + '</td>' +
                                    '<td style="text-align:right;">' + quantity.toLocaleString() + '</td>' +
                                    '<td style="text-align:right;">' + multipliedValue.toLocaleString() + '</td>' +
                                    '<td>' + groupData[i].house + '</td>' +
                                    '<td style="color:white; background-color: ' + backgroundColor + ';">' + part + '</td>' +
                                    '<td><a class="data-edit" style="cursor:pointer; color:navy;">수정</a></td>' +
                                    '<td><a class="data-delete" style="cursor:pointer; color:red;">삭제</a></td>' +
                                    '<td class="data-id">' + groupData[i].id + '</td>' +
                                    '</tr>'
                                );
                            }

                            // Add the sum quantity row for the current date group
                            $('#materialdatatable').append(
                                '<tr>' +
                                '<td style="font-weight:bold;" colspan="11">' + date + ' 합계</td>' +
                                '<td style="text-align:right;"><strong>' + sumroll.toLocaleString() + '</strong></td>' +
                                '<td style="text-align:right;"><strong>' + sumquantity.toLocaleString() + '</strong></td>' +
                                '<td style="text-align:right;"><strong>' + totalQuantity.toLocaleString() + '</strong></td>' +
                                '<td colspan="4"></td>' +
                                '</tr>'
                            );

                            overallSumquantity += sumquantity;
                            overallSumroll += sumroll;
                            overallTotalQuantity += totalQuantity;
                        }
                    }

                    // Add the overall sum quantity row at the end
                    $('#materialdatatable').append(
                        '<tr>' +
                        '<td style="font-weight:bold;" colspan="11">전체 합계</td>' +
                        '<td style="text-align:right;"><strong>' + overallSumroll.toLocaleString() + '</strong></td>' +
                        '<td style="text-align:right;"><strong>' + overallSumquantity.toLocaleString() + '</strong></td>' +
                        '<td style="text-align:right;"><strong>' + overallTotalQuantity.toLocaleString() + '</strong></td>' +
                        '<td colspan="4"></td>' +
                        '</tr>'
                    );

                    $('.data-id').hide();
                }
            });
        }
        function load1() {
            $('#materialinputtbody').empty()
            $.ajax({
                type: 'POST',
                url: server + '/api/materialinputsearchgroup',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    start: $('#datepicker2').val(),
                    finish: $('#datepicker3').val()
                }),
                success: function (data) {
                    // Group data by date
                    var groupedData = {};
                    var dateTotals = {}; // Object to store date-wise totals

                    for (var i = 0; i < data.length; i++) {
                        var date = data[i].date;

                        if (!groupedData[date]) {
                            groupedData[date] = [];
                            dateTotals[date] = {
                                sumquantity: 0,
                                sumroll: 0,
                                totalQuantity: 0
                            };
                        }

                        groupedData[date].push(data[i]);

                        var quantity = parseFloat(data[i].quantity.replace(/,/g, ''));
                        var materialWidth = parseFloat(data[i].materialwidth.replace(/,/g, ''));
                        var sqmprice = parseFloat(data[i].sqmprice.replace(/,/g, ''));
                        var multipliedValue = quantity * materialWidth / 1000 * sqmprice;

                        dateTotals[date].sumquantity += quantity;
                        dateTotals[date].sumroll += roll;
                        dateTotals[date].totalQuantity += multipliedValue;
                    }

                    var overallTotalQuantity = 0; // Variable to store the overall total quantity
                    var overallSumroll = 0; // Variable to store the overall total roll
                    var overallSumquantity = 0; // Variable to store the overall sum quantity

                    // Iterate over each date group
                    for (var date in groupedData) {
                        if (groupedData.hasOwnProperty(date)) {
                            // Create a group header row for the date
                            $('#materialdatatable').append(
                                '<tr>' +
                                '<td colspan="18" style="background-color: #f2f2f2;"><strong>' + date + '</strong></td>' +
                                '</tr>'
                            );

                            var groupData = groupedData[date]; // Get the data for the current date group
                            var sumquantity = 0; // Variable to store the sum quantity for the current date group
                            var sumroll = 0; // Variable to store the sum quantity for the current date group
                            var totalQuantity = 0; // Variable to store the total quantity for the current date group

                            for (var i = 0; i < groupData.length; i++) {
                                var part = groupData[i].part;
                                var backgroundColor = '';

                                if (part === '입고완료') {
                                    backgroundColor = 'blue';
                                } else if (part === '출고대기') {
                                    backgroundColor = 'red';
                                } else if (part === '수입검사대기') {
                                    backgroundColor = 'green';
                                }
                                var roll = parseFloat(groupData[i].roll.replace(/,/g, ''));
                                var quantity = parseFloat(groupData[i].quantity.replace(/,/g, ''));
                                var materialWidth = parseFloat(groupData[i].materialwidth.replace(/,/g, ''));
                                var sqmprice = parseFloat(groupData[i].sqmprice.replace(/,/g, ''));

                                sumquantity += quantity;
                                sumroll += roll;
                                var multipliedValue = quantity * materialWidth / 1000 * sqmprice;
                                totalQuantity += multipliedValue;

                                var classification = groupData[i].classification !== null ? groupData[i].classification : '';
                                var lotno = groupData[i].lotno !== null ? groupData[i].lotno : '';
                                var manufacturedate = groupData[i].manufacturedate !== null ? groupData[i].manufacturedate : '';
                                var expirationdate = groupData[i].expirationdate !== null ? groupData[i].expirationdate : '';

                                $('#materialdatatable').append(
                                    '<tr>' +
                                    '<td>' + groupData[i].input + '</td>' +
                                    '<td>' + groupData[i].date + '</td>' +
                                    '<td>' + groupData[i].materialname + '</td>' +
                                    '<td>' + classification + '</td>' +
                                    '<td>' + groupData[i].customer + '</td>' +
                                    '<td>' + groupData[i].codenumber + '</td>' +
                                    '<td>' + lotno + '</td>' +
                                    '<td>' + manufacturedate + '</td>' +
                                    '<td>' + expirationdate + '</td>' +
                                    '<td style="text-align:right;">' + groupData[i].materialwidth.toLocaleString() + '</td>' +
                                    '<td style="text-align:right;">' + groupData[i].sqmprice.toLocaleString() + '</td>' +
                                    '<td style="text-align:right;">' + groupData[i].roll.toLocaleString() + '</td>' +
                                    '<td style="text-align:right;">' + quantity.toLocaleString() + '</td>' +
                                    '<td style="text-align:right;">' + multipliedValue.toLocaleString() + '</td>' +
                                    '<td>' + groupData[i].house + '</td>' +
                                    '<td style="color:white; background-color: ' + backgroundColor + ';">' + part + '</td>' +
                                    '<td></td>' +
                                    '<td></td>' +
                                    '<td class="data-id">' + groupData[i].id + '</td>' +
                                    '</tr>'
                                );
                            }

                            // Add the sum quantity row for the current date group
                            $('#materialdatatable').append(
                                '<tr>' +
                                '<td style="font-weight:bold;" colspan="11">' + date + ' 합계</td>' +
                                '<td style="text-align:right;"><strong>' + sumroll.toLocaleString() + '</strong></td>' +
                                '<td style="text-align:right;"><strong>' + sumquantity.toLocaleString() + '</strong></td>' +
                                '<td style="text-align:right;"><strong>' + totalQuantity.toLocaleString() + '</strong></td>' +
                                '<td colspan="4"></td>' +
                                '</tr>'
                            );

                            overallSumquantity += sumquantity;
                            overallSumroll += sumroll;
                            overallTotalQuantity += totalQuantity;
                        }
                    }

                    // Add the overall sum quantity row at the end
                    $('#materialdatatable').append(
                        '<tr>' +
                        '<td style="font-weight:bold;" colspan="11">전체 합계</td>' +
                        '<td style="text-align:right;"><strong>' + overallSumroll.toLocaleString() + '</strong></td>' +
                        '<td style="text-align:right;"><strong>' + overallSumquantity.toLocaleString() + '</strong></td>' +
                        '<td style="text-align:right;"><strong>' + overallTotalQuantity.toLocaleString() + '</strong></td>' +
                        '<td colspan="4"></td>' +
                        '</tr>'
                    );

                    $('.data-id').hide();
                }
            });
        }

        $('#rollchange').on('click', function () {
            if ($(this).is(':checked')) {
                load1()
            } else {
                load()
            }
        })
        function handleKeyPress1(event) {
            if (event.keyCode === 13) { // Enter 키를 눌렀을 때


                const input = $('#qrcode').val()

                // 정규식 패턴을 사용하여 각 항목을 추출
                const pattern = /(\w+)\s*\/(\w+)\&(\w+)\s*\/(\d+)\&(\d{4}\/\d{2}\/\d{2})\&(\d+)\&(\d{4}\/\d{2}\/\d{2})/;

                const match = input.match(pattern);

                if (match) {
                    const materialName = match[1] + '-' + match[2];
                    const lot = match[3] + '-' + match[4];
                    const manufactureDate = match[5];
                    const expirationDate = match[7];
                    const materialWidth = match[6];

                    $.ajax({
                        type: 'POST',
                        url: server + '/api/duplication',
                        dataType: 'json',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            "lotno": lot
                        }),
                        success: function (result) {
                            if (result && Object.keys(result).length > 0) {
                                // result 데이터가 존재할 경우 경고 메시지 생성
                                alert("경고 메시지: 중복된 데이터가 있습니다.");
                            } else {
                                $.ajax({
                                    type: 'POST',
                                    url: server + '/api/materialinputsave',
                                    dataType: 'json',
                                    contentType: 'application/json',
                                    data: JSON.stringify({

                                        "materialname": materialName,
                                        "input": '원자재입고',
                                        "codenumber": materialName,
                                        "manufacturedate": manufactureDate,
                                        "expirationdate": expirationDate,
                                        "materialwidth": materialWidth,
                                        "classification": '사급자재',
                                        "customer": '한화',
                                        "date": '2023-08-24',
                                        "lotno": lot,
                                        "roll": '1',
                                        "quantity": materialWidth,
                                        "part": '수입검사대기',
                                        "sqmprice": '1000',
                                        "house": '원자재창고'
                                    }),
                                    success: function (result) {

                                    }
                                })
                            }
                        }
                    });



                    load()

                } else {
                    console.log("패턴이 일치하지 않습니다.");
                }
                $('#qrcode').val('')

            }


        }
        function openModal() {
            var modal = document.getElementById('myModal');
            modal.style.display = 'flex'; // 모달을 flex로 표시하여 가운데 정렬
        }

        // 모달 닫기
        function closeModal() {

            var modal = document.getElementById('myModal');
            modal.style.display = 'none';
        }


        function SaveModal() {

            var excelDataDiv = document.getElementById('excelData');
            var tableRows = excelDataDiv.querySelectorAll('tr');
            var sixthColumnData = []; // 6번째 열의 데이터를 저장할 배열

            // 각 행을 반복하면서 6번째 열의 데이터를 배열에 추가
            tableRows.forEach(function (row) {
                var cells = row.querySelectorAll('td');
                if (cells.length >= 6) { // 적어도 6개의 열이 있는 경우만 처리
                    var sixthColumnText = cells[5].textContent.trim(); // 6번째 열의 데이터
                    sixthColumnData.push(sixthColumnText);
                }
            });

            // 중복된 데이터 찾기
            var duplicates = findDuplicates(sixthColumnData);
            // 중복된 데이터가 있을 때만 alert 메시지 표시
            if (duplicates.length > 0) {
                alert('중복된 데이터: ' + duplicates.join(', ') + ' 가 존재합니다.');

                // 중복된 데이터가 존재하는 경우 해당 행에 클래스 추가
                tableRows.forEach(function (row) {
                    var cells = row.querySelectorAll('td');
                    if (cells.length >= 6) { // 적어도 6개의 열이 있는 경우만 처리
                        var sixthColumnText = cells[5].textContent.trim(); // 6번째 열의 데이터
                        if (duplicates.includes(sixthColumnText)) {
                            row.classList.add('duplicate-row');
                            row.addEventListener('dblclick', function () {
                                // 더블 클릭 시 수정 가능한 입력 필드로 변경
                                var cell = row.querySelector('td:nth-child(6)');
                                var originalText = cell.textContent.trim();
                                cell.innerHTML = '<input type="text" value="' + originalText + '">';

                                // 수정된 데이터를 중복 데이터 배열에서 업데이트
                                cell.querySelector('input').addEventListener('blur', function () {
                                    var newText = cell.querySelector('input').value.trim();
                                    if (!duplicates.includes(newText)) {
                                        var index = duplicates.indexOf(originalText);
                                        if (index !== -1) {
                                            duplicates[index] = newText;
                                        }
                                        cell.textContent = newText;
                                        row.classList.remove('duplicate-row');
                                    }
                                });
                            });
                        }
                    }
                });



            } else {


                for (var i = 2; i < tableRows.length + 1; i++) {


                    var input = '원자재입고';
                    var customer = $('#sjs-A' + i).text();
                    var date = $('#sjs-B' + i).text();
                    var materialname = $('#sjs-C' + i).text();
                    var materialwidth = $('#sjs-D' + i).text();
                    var quantity = $('#sjs-E' + i).text();
                    var lotno = $('#sjs-F' + i).text();
                    var manufacturedate = $('#sjs-H' + i).text();
                    var expirationdate = $('#sjs-I' + i).text();
                    var roll = $('#sjs-K' + i).text();

                    function formatDate(dateString) {
                        // 날짜 문자열을 '/'를 기준으로 분리
                        var parts = dateString.split('/');
                        var month = parts[0];
                        var day = parts[1];
                        var year = parts[2];

                        // 'yy' 형식으로 된 연도를 'yyyy' 형식으로 변환
                        if (year.length === 2) {
                            year = '20' + year;
                        }
                        // 월과 일을 두 자리로 만들기
                        month = month.length === 1 ? '0' + month : month;
                        day = day.length === 1 ? '0' + day : day;

                        // 날짜를 'yyyy-mm-dd' 형식으로 조합
                        var formattedDate = year + '-' + month + '-' + day;
                        return formattedDate;

                        var formattedDate1 = year + '-' + month + '-' + day;
                        return formattedDate1;

                        var formattedDate2 = year + '-' + month + '-' + day;
                        return formattedDate2;
                    }

                    // 예시 날짜를 '2/1/24'에서 '2024-02-01'로 변환
                    var originalDate = date;
                    var formattedDate = formatDate(originalDate);

                    var originalDate1 = manufacturedate;
                    var formattedDate1 = formatDate(originalDate1);

                    var originalDate2 = expirationdate;
                    var formattedDate2 = formatDate(originalDate2);



                    // 날짜 형식 변환 함수를 사용하여 날짜를 변경
                    date = formatDate(date);

                    $.ajax({
                        type: 'POST',
                        url: server + '/api/inputexcelmaterial',
                        dataType: 'json',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            "input": input,
                            "customer": customer,
                            "date": formattedDate,
                            "materialname": materialname,
                            "codenumber": materialname,
                            "materialwidth": materialwidth,
                            "quantity": quantity,
                            "lotno": lotno,
                            "manufacturedate": formattedDate1,
                            "expirationdate": formattedDate2,
                            "roll": roll,
                            "part": '수입검사대기',
                            "classification": '사급자재',
                            "house": '원자재창고',

                        }),
                        success: function (result) {
                            // Ajax 요청 성공 시 수행할 동작
                        }
                    });
                }

                var modal = document.getElementById('myModal');
                modal.style.display = 'none';

                load()
            }
        }

        // 중복된 데이터를 찾는 함수
        function findDuplicates(array) {
            var duplicates = [];
            var counts = {};

            for (var i = 0; i < array.length; i++) {
                var item = array[i];
                counts[item] = counts[item] ? counts[item] + 1 : 1;
                if (counts[item] > 1 && duplicates.indexOf(item) === -1) {
                    duplicates.push(item);
                }
            }

            return duplicates;
        }









        function uploadExcelFile() {
            var fileInput = document.getElementById('excelFileInput');
            var file = fileInput.files[0]; // 선택된 파일 가져오기

            if (file) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    var data = e.target.result;
                    var workbook = XLSX.read(data, { type: 'binary' });

                    var firstSheetName = workbook.SheetNames[0];
                    var sheet = workbook.Sheets[firstSheetName];
                    var html = XLSX.utils.sheet_to_html(sheet);

                    // 표시할 HTML을 생성
                    var tableHtml = '<table>' + html + '</table>';

                    // HTML에 추가하기 전에 날짜 형식 변환 수행
                    tableHtml = convertDatesInHTML(tableHtml);

                    // 결과를 원하는 위치에 표시
                    document.getElementById('excelData').innerHTML = tableHtml;

                    // 모달 열기
                    openModal();
                };

                reader.readAsBinaryString(file);
            } else {
                alert('파일을 선택해주세요.');
            }
        }

        // HTML에서 날짜 형식 변환 함수
        function convertDatesInHTML(html) {
            var dateRegex = /\d{4}-\d{2}-\d{2}/g; // 날짜 형식을 찾는 정규식
            var matches = html.match(dateRegex);

            if (matches) {
                for (var i = 0; i < matches.length; i++) {
                    var excelDate = matches[i];
                    var dateObj = new Date(excelDate);
                    var formattedDate = dateObj.toLocaleDateString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' });

                    // 날짜 형식을 변환하여 HTML에 적용
                    html = html.replace(excelDate, formattedDate);
                }
            }

            return html;
        }
        function displayFileName() {
            var fileInput = document.getElementById('excelFileInput');
            var customLabel = document.querySelector('.custom-file-label');

            if (fileInput.files.length > 0) {
                customLabel.innerHTML = fileInput.files[0].name;
            } else {
                customLabel.innerHTML = '엑셀 파일 선택';
            }
        }

        function resetFileInput() {
            var fileInput = document.getElementById('excelFileInput');
            var customLabel = document.querySelector('.custom-file-label');

            // 파일 입력 필드 초기화
            fileInput.value = '';
            // 라벨 텍스트 초기화
            customLabel.innerHTML = '엑셀 파일 선택';
        }
    </script>

</body>

</html>
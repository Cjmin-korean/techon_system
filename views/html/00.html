<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
</head>

<body>

    <div>
        <label for="file1">파일</label>
        <input type="file" id="file1" name="file1">
        <button id="btn_submit">전송</button>
    </div>

    <div>
        <div class="img_wrap">
            <img id="img" />
        </div>
    </div>

    <script type="text/javascript">
        // 이미지 미리보기
        $(document).ready(function () {
            $("#file1").on("change", handleImgFileSelect);
            $("#btn_submit").on("click", fn_submit);
        });

        var sel_file;

        function handleImgFileSelect(e) {
            var files = e.target.files;
            var filesArr = Array.prototype.slice.call(files);

            var reg = /(.*?)\/(jpg|jpeg|png|bmp)$/;

            filesArr.forEach(function (f) {
                if (!f.type.match(reg)) {
                    alert("확장자는 이미지 확장자만 가능합니다.");
                    return;
                }

                sel_file = f;

                var reader = new FileReader();
                reader.onload = function (e) {
                    $("#img").attr("src", e.target.result);
                }
                reader.readAsDataURL(f);
            });
        }

        // 파일 업로드
        function fn_submit() {
            var server = '';

            if (window.location.hostname == 'localhost') {
                server = 'http://localhost:8080';
            } else {
                server = 'http://techonmes.co.kr';
            }

            var formData = new FormData();
            formData.append("file1", $("#file1")[0].files[0]);

            $.ajax({
                url: server + "/api/insertimg",
                type: "POST",
                data: formData,
                contentType: false,
                processData: false,
                success: function (response) {
                    alert("성공하였습니다.");
                    console.log(response);
                },
                error: function (jqXHR) {
                    alert(jqXHR.responseText);
                }
            });
        }
    </script>
</body>

</html>

<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>거래처정보</title>
<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="../css/main.css">
<link rel="stylesheet" href="../css/calendar.css">

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<head>
    <title>Table Data Move</title>
    <style>
        #datatable thead {
            position: sticky;
            top: 0;
            background-color: #fff;
            z-index: 1;
        }

        #deletebtn:hover {
            font-weight: bold;
        }
    </style>
</head>

<body>

    <div id="popupOverlay" style="display: none;">

        <div id="popupContent">
            <div class="form-group">
                <table style="width:100%;">
                    <tr>
                        <td colspan="2" class="popup_title">생산계획 확정</td>
                    <tr>
                        <td style="width: 200px">생산확정날짜</td>
                        <td>
                            <input type="text" id="plandate-save" class="data" autocomplete="off"
                                style="width: 200px; border: 1px solid silver;" readonly>
                            <label id="days-left-label"></label>
                        </td>
                    </tr>

                    <tr>
                        <td style="width: 200px">BOM NO.</td>
                        <td><input type="text" id="bomno-save" class="data" autocomplete="off"
                                style="width:auto; border:1px solid silver;" readonly></td>
                    </tr>
                    <tr>
                        <td style="width: 200px">모델명</td>
                        <td><input type="text" id="modelname-save" class="data" autocomplete="off"
                                style="width:auto; border:1px solid silver;" readonly></td>
                    </tr>
                    <tr>
                        <td style="width: 200px">품명</td>
                        <td><input type="text" id="itemname-save" class="data" autocomplete="off"
                                style="width:auto; border:1px solid silver;" readonly></td>
                    </tr>
                    <tr>
                        <td style="width: 200px">생산LOT</td>
                        <td><input type="text" id="lotno-save" class="data" autocomplete="off"
                                style="width:auto; border:1px solid silver;" readonly></td>
                    </tr>
                    <tr>
                        <td style="width: 200px">수량</td>
                        <td><input type="text" id="quantity-save" class="data" autocomplete="off"
                                style="width:auto; border:1px solid silver;"></td>
                    </tr>
                    <tr>
                        <td style="width: 200px">설비호기</td>
                        <td>
                            <select id="equipment-select" class="form-select">
                                <option value=""></option>
                            </select>
                        </td>

                    </tr>

                </table>

                <!-- <div id="datatable-container" style="width:99%;">

                    <table class="styled-table" id="datatable">
                        <thead>
                            <tr>
                                <th >설비명</th>
                                <th >고객사</th>
                                <th >모델</th>
                                <th >품명</th>
                                <th >작업지시수량</th>

                            </tr>
                        </thead>
                        <tbody id="Datatbody1">
                            <tr>
                                <td>1</td>
                                <td>2</td>
                                <td>3</td>
                                <td>4</td>
                            </tr>
                        </tbody>

                    </table>

                </div> -->
            </div>
            <button id="popupCloseBtn-save-close">취소</button>
            <button id="popupCloseBtn-save" onclick="planinsert()">저장</button>
        </div>
    </div>
    <div class="calendar">
        <div class="month">
            <button class="prev-month">
                <img style="cursor:pointer;" src="../img/left-arrow.png" />
            </button>
            <h1 id="month-year">2023년 9월</h1>
            <button class="next-month">
                <img style="cursor:pointer;" src="../img/right-arrow.png" />
            </button>
        </div>
        <div class="dates">
            <!-- 여기에 날짜 버튼이 생성됩니다. -->
        </div>
    </div>


    <div id="datatable-container" style="width: 68%; float: left;">
        <table class="droppable" id="datatable">
            <thead>
                <tr>
                    <th colspan="16" style="width: auto;  border: 1px solid rgb(231, 228, 228);;" id="plandate"></th>
                </tr>
                <tr>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);  ">
                        호기(설비명)
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);  ">BOM
                        NO.
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);  ">
                        고객사
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); ">
                        모델명
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); ">
                        품명
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        총작업<br>차수
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); ">
                        라인계획<br>작업차수
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        생산LOT
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        작업지시<br>수량(PO)
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        누적
                        생산<br>실적
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        작업지시<br>생산 잔량<br>(PO)
                    </th>
                    <th colspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        반제품 계획실적
                    </th>
                    <th colspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        완제품 계획실적
                    </th>
                    <!-- <th rowspan="2" style="width: 50px; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                    </th> -->
                </tr>
                <tr>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        금일계획
                    </th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        금일실적
                    </th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        금일계획
                    </th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        금일실적
                    </th>

                </tr>

            </thead>
            <tbody id="Datatbody">
                <!-- 여기에 데이터 행 추가 -->
            </tbody>
        </table>
    </div>
    <div id="datatable-container" style="width: 31%; height: 100%; float: right; border: 1px solid silver;">
        <table class="droppable" id="planstauts">
            <thead>
                <tr>
                    <th colspan="8" rowspan="1"
                        style="width: auto; font-size: 20px; font-weight: bold; border: 1px solid rgb(231, 228, 228);">
                        생산확정리스트
                    </th>

                </tr>
                <tr>


                </tr>

                <tr>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">BOM NO.</th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">생산계획날짜</th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">모델명</th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">품명</th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">생산LOT</th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">수량</th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);"></th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);"></th>

                </tr>

            </thead>
            <tbody id="planstatustbody">
            </tbody>
        </table>
    </div>

    <div id="popupOverlay2" style="display: none;">
        <div id="popupContent">
            <div class="form-group">
                <table style="width:100%;">

                    <tr>
                        <td style="width: 100%;" class="popup_title">생산계획 정보를 삭제하시겠습니까?</td>
                    </tr>

                </table>
            </div>
            <button id="popupCloseBtn-delete-close">취소</button>
            <button id="popupCloseBtn-delete" onclick="Datadelte()">삭제</button>
            <input type="text" id="id-edit" style="visibility: hidden; width: 10px; float: right;" autocomplete="off">
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <script>
        $('#popupCloseBtn-delete-close').click(function () {
            $('#popupOverlay2').fadeOut();
        });
        function abc() {
            $('#popupOverlay2').fadeIn();
        }
    </script>

    <script>
        function load() {
            $('#planstatustbody').empty()
            $.ajax({
                type: 'POST',
                url: server + '/api/productorderlist',
                dataType: 'json',
                success: function (data) {
                    var tableBody = $('#planstatustbody');
                    if (data.length === 0) {
                    } else {
                        loadData = data;

                        for (var i = 0; i < data.length; i++) {
                            tableBody.append(
                                '<tr draggable="true">' +
                                '<td>' + data[i].bomno + '</td>' +
                                '<td style="font-weight:bold;">' + data[i].productdate + '</td>' +
                                '<td>' + data[i].modelname + '</td>' +
                                '<td>' + data[i].itemname + '</td>' +
                                '<td>' + data[i].lotno + '</td>' +
                                '<td style="text-align:right;">' + data[i].quantity.toLocaleString() + '</td>' +
                                '<td><a class="savebutton" style="cursor: pointer; color: navy;">등록</a></td>' +
                                '<td><a class="datadelete" style=" cursor:pointer; color:red;">취소</a></td>' +
                                '<td class="data-id">' + data[i].id + '</td>' +
                                '</tr>'
                            );
                        }
                    }
                    $('.data-id').hide();
                }
            });
        }
        function plansearching() {

            $.ajax({
                type: 'POST',
                url: server + '/api/plansearchAll',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    "plandate": $('#plandate').text()
                }),
                success: function (data) {
                    //console.log('loadTdData2', loadTdData);
                    planSearchData = data;
                    //console.log('planSearchData', planSearchData);

                    for (var i = 0; i < data.length; i++) {
                        loadTdData[planSearchData[i].equipmentname][planSearchData[i].num - 1] = {
                            id: data[i].id,
                            equipmentname: planSearchData[i].equipmentname,
                            num: data[i].num,
                            bomno: data[i].bomno,
                            customer: data[i].customer,
                            modelname: data[i].modelname,
                            itemname: data[i].itemname,
                            part: data[i].part,
                            linepart: data[i].linepart,
                            lotno: data[i].lotno,
                            pono: data[i].pono,
                            accumulate: data[i].accumulate,
                            remaining: data[i].remaining,
                            planone: data[i].planone,
                            siljokone: data[i].siljokone,
                            plantwo: data[i].plantwo,
                            siljoktwo: data[i].siljoktwo,
                            plandate: data[i].plandate
                        };
                        // //console.log('data[i].plandate', data[i].plandate);
                    }
                    var loadTdDataKeys = Object.keys(loadTdData);
                    // //console.log('keys', loadTdDataKeys);
                    var numKeys = loadTdDataKeys.length;
                    // //console.log(numKeys);
                    for (var i = 0; i < numKeys; i++) {

                        for (var j = 0; j < 8; j++) {

                            var bomno = 'bomno' + loadTdData[loadTdDataKeys[i]][j].equipmentname;
                            var customer = 'customer' + loadTdData[loadTdDataKeys[i]][j].equipmentname;
                            var modelname = 'modelname' + loadTdData[loadTdDataKeys[i]][j].equipmentname;
                            var itemname = 'itemname' + loadTdData[loadTdDataKeys[i]][j].equipmentname;
                            var part = 'part' + loadTdData[loadTdDataKeys[i]][j].equipmentname;
                            var linepart = 'linepart' + loadTdData[loadTdDataKeys[i]][j].equipmentname;
                            var lotno = 'lotno' + loadTdData[loadTdDataKeys[i]][j].equipmentname;
                            var pono = 'pono' + loadTdData[loadTdDataKeys[i]][j].equipmentname;
                            var accumulate = 'accumulate' + loadTdData[loadTdDataKeys[i]][j].equipmentname;
                            var remaining = 'remaining' + loadTdData[loadTdDataKeys[i]][j].equipmentname;
                            var planone = 'planone' + loadTdData[loadTdDataKeys[i]][j].equipmentname;
                            var siljokone = 'siljokone' + loadTdData[loadTdDataKeys[i]][j].equipmentname;
                            var plantwo = 'plantwo' + loadTdData[loadTdDataKeys[i]][j].equipmentname;
                            var siljoktwo = 'siljoktwo' + loadTdData[loadTdDataKeys[i]][j].equipmentname;



                            $('#' + j + bomno + '').text(loadTdData[loadTdDataKeys[i]][j].bomno);
                            $('#' + j + customer + '').text(loadTdData[loadTdDataKeys[i]][j].customer);
                            $('#' + j + modelname + '').text(loadTdData[loadTdDataKeys[i]][j].modelname);
                            $('#' + j + itemname + '').text(loadTdData[loadTdDataKeys[i]][j].itemname);
                            $('#' + j + part + '').text(loadTdData[loadTdDataKeys[i]][j].part);
                            $('#' + j + linepart + '').text(loadTdData[loadTdDataKeys[i]][j].linepart);
                            $('#' + j + lotno + '').text(loadTdData[loadTdDataKeys[i]][j].lotno);
                            $('#' + j + pono + '').text(loadTdData[loadTdDataKeys[i]][j].pono);
                            $('#' + j + accumulate + '').text(loadTdData[loadTdDataKeys[i]][j].accumulate);
                            $('#' + j + remaining + '').text(loadTdData[loadTdDataKeys[i]][j].remaining);
                            $('#' + j + planone + '').text(loadTdData[loadTdDataKeys[i]][j].planone);
                            $('#' + j + siljokone + '').text(loadTdData[loadTdDataKeys[i]][j].siljokone);
                            $('#' + j + plantwo + '').text(loadTdData[loadTdDataKeys[i]][j].plantwo);
                            $('#' + j + siljoktwo + '').text(loadTdData[loadTdDataKeys[i]][j].siljoktwo);


                        }

                    }
                    for (var key in loadTdData) {
                        for (var subKey in loadTdData[key]) {
                            flattenedData.push(loadTdData[key][subKey]);
                        }
                    }
                }
            });
        }

        function planload() {
            $('#Datatbody').empty();
            $.ajax({
                type: 'POST',
                url: server + '/api/equipmentname',
                dataType: 'json',
                success: function (data) {
                    var tableBody = $('#Datatbody');
                    if (data.length === 0) {
                    } else {
                        loadTdData = {};

                        for (var i = 0; i < data.length; i++) {
                            loadTdData[data[i].codenumber] = {};
                            var numRows = 8;
                            for (var j = 0; j < numRows; j++) {
                                loadTdData[data[i].codenumber][j] = {
                                    num: '',
                                    bomno: '',
                                    customer: '',
                                    modelname: '',
                                    itemname: '',
                                    part: '',
                                    linepart: '',
                                    lotno: '',
                                    pono: '',
                                    accumulate: '',
                                    remaining: '',
                                    planone: '',
                                    siljokone: '',
                                    plantwo: '',
                                    siljoktwo: '',
                                }

                                tableBody.append(
                                    '<tr draggable="true">' +
                                    (j === 0 ? '<td style="width:8%; font-size: 20px; border: 1px solid rgb(231, 228, 228); background-color:white; font-weight:bold;" rowspan="' + numRows + '" id="' + data[i].codenumber + '">' + data[i].equipmentname + '</td>' : '') +
                                    '<td ondblclick="abc()" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); border-bottom-color: ' + (j >= 7 ? '#3d3838' : 'rgb(231, 228, 228)') + ';" id="' + j + 'bomno' + data[i].codenumber + '"></td>' +
                                    '<td ondblclick="abc()" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); border-bottom-color: ' + (j >= 7 ? '#3d3838' : 'rgb(231, 228, 228)') + ';" id="' + j + 'customer' + data[i].codenumber + '"></td>' +
                                    '<td ondblclick="abc()" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); border-bottom-color: ' + (j >= 7 ? '#3d3838' : 'rgb(231, 228, 228)') + ';" id="' + j + 'modelname' + data[i].codenumber + '" ></td > ' +
                                    '<td ondblclick="abc()" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); border-bottom-color: ' + (j >= 7 ? '#3d3838' : 'rgb(231, 228, 228)') + ';" id="' + j + 'itemname' + data[i].codenumber + '" ></td > ' +
                                    '<td ondblclick="abc()" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); border-bottom-color: ' + (j >= 7 ? '#3d3838' : 'rgb(231, 228, 228)') + ';" id="' + j + 'part' + data[i].codenumber + '" ></td > ' +
                                    '<td ondblclick="abc()" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); border-bottom-color: ' + (j >= 7 ? '#3d3838' : 'rgb(231, 228, 228)') + ';" id="' + j + 'linepart' + data[i].codenumber + '" ></td > ' +
                                    '<td ondblclick="abc()" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); border-bottom-color: ' + (j >= 7 ? '#3d3838' : 'rgb(231, 228, 228)') + ';" id="' + j + 'lotno' + data[i].codenumber + '" ></td > ' +
                                    '<td ondblclick="abc()" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); border-bottom-color: ' + (j >= 7 ? '#3d3838' : 'rgb(231, 228, 228)') + ';" id="' + j + 'pono' + data[i].codenumber + '" ></td > ' +
                                    '<td ondblclick="abc()" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); border-bottom-color: ' + (j >= 7 ? '#3d3838' : 'rgb(231, 228, 228)') + ';" id="' + j + 'accumulate' + data[i].codenumber + '" ></td > ' +
                                    '<td ondblclick="abc()" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); border-bottom-color: ' + (j >= 7 ? '#3d3838' : 'rgb(231, 228, 228)') + ';" id="' + j + 'remaining' + data[i].codenumber + '" ></td > ' +
                                    '<td ondblclick="abc()" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); border-bottom-color: ' + (j >= 7 ? '#3d3838' : 'rgb(231, 228, 228)') + ';" id="' + j + 'planone' + data[i].codenumber + '" ></td > ' +
                                    '<td ondblclick="abc()" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); border-bottom-color: ' + (j >= 7 ? '#3d3838' : 'rgb(231, 228, 228)') + ';" id="' + j + 'siljokone' + data[i].codenumber + '" ></td > ' +
                                    '<td ondblclick="abc()" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); border-bottom-color: ' + (j >= 7 ? '#3d3838' : 'rgb(231, 228, 228)') + ';" id="' + j + 'plantwo' + data[i].codenumber + '" ></td > ' +
                                    '<td ondblclick="abc()" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); border-bottom-color: ' + (j >= 7 ? '#3d3838' : 'rgb(231, 228, 228)') + ';" id="' + j + 'siljoktwo' + data[i].codenumber + '" ></td > ' +
                                    '</tr>'
                                );

                            }
                        }




                        plansearching()
                    }
                }
            });
        }

        function planinsert() {
            var plandate = $('#plandate-save').val();
            var bomno = $('#bomno-save').val();
            var modelname = $('#modelname-save').val();
            var itemname = $('#itemname-save').val();
            var lotno = $('#lotno-save').val();
            var pono = $('#quantity-save').val();
            var equipmentname = $('#equipment-select').val();

            $.ajax({
                type: 'POST',
                url: server + '/api/searchequipmentcodenumber',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    "equipmentname": equipmentname
                }),
                success: function (data) {
                    $.ajax({
                        type: 'POST',
                        url: server + '/api/planinsert',
                        dataType: 'json',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            "plandate": plandate,
                            "bomno": bomno,
                            "modelname": modelname,
                            "itemname": itemname,
                            "lotno": lotno,
                            "pono": pono,
                            "equipmentname": data[0].codenumber,
                            "num": '1'

                        }),
                        success: function (result) {
                        },
                        error: function (error) {
                        }
                    });
                },
                error: function (error) {
                }
            });

            $.ajax({
                type: 'POST',
                url: server + '/api/statusfalse',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    "orderstatus": '생산확정완료',
                    "lotno": lotno

                }),
                success: function (data) {

                },
                error: function (error) {
                }
            });

            $('#popupOverlay').fadeOut();

            load()
            planload()
            plansearching()

        }


    </script>


    <script src="../js/calendar.js"></script>
    <script src="../js/drag.js"></script>


</body>

</html>
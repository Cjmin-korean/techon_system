<!DOCTYPE html>
<html>

<head>
    <title>TECHON 생산준비</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        /* 공통 스타일 */
        body {
            font-family: Arial, sans-serif;
        }

        /* QR 코드 섹션 스타일 */
        .qr-code-section {
            margin-top: 50px;
            padding: 20px;
            background-color: #f2f2f2;
            border-radius: 10px;
        }

        .qr-code-section b {
            font-size: 16px;
            margin-bottom: 10px;
            display: block;
        }

        #peopleInput {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 14px;
            margin-bottom: 20px;
        }

        /* QR 코드 테이블 스타일 */
        #qrCodeTable {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        #qrCodeTable th,
        #qrCodeTable td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        #qrCodeTable th {
            background-color: #f2f2f2;
        }

        #qrCodeTable input[type="text"] {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 14px;
        }

        #qrCodeTable button {
            padding: 8px 20px;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #qrCodeTable button:hover {
            background-color: #0056b3;
        }

        #editableTable {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        #editableTable th,
        #editableTable td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        #editableTable th {
            background-color: #f2f2f2;
        }

        #editableTable .table-light {
            background-color: #f8f9fa;
        }
    </style>

</head>

<body>
    <div class="qr-code-section">
        <b>작업자</b>
        <div>
            <select id="peopleInput">
                <option>홍길동1</option>
                <option>홍길동2</option>
                <option>홍길동3</option>
                <option>홍길동4</option>
                <option>홍길동5</option>
                <option>홍길동6</option>
                <option>홍길동7</option>
                <option>홍길동8</option>
                <option>홍길동9</option>
                <option>홍길동10</option>
                <option>홍길동11</option>
                <option>홍길동12</option>
                <option>홍길동13</option>
            </select>


        </div>
    </div>
    <table id="qrCodeTable">
        <tr>
            <th>구분</th>
            <th>QR CODE</th>
            <th>확인</th>
            <th>RESET</th>
        </tr>
        <tr>
            <td><b>작업지시서</b></td>
            <td><input type="text" id="textInputA" autocomplete="off" placeholder="작업지시서 QR CODE를 리딩하세요"
                    value="20240325" style="width: 500px;"></td>
            <td></td>
            <td><button onclick="reseta()">RESET</button></td>

        </tr>
        <tr>
            <td><b>작업 설비1</b></td>
            <td><input type="text" id="textInputB" autocomplete="off" placeholder="설비 QR CODE를 리딩하세요" value=""
                    style="width: 500px;"></td>
            <td></td>

            <td><button onclick="resetb()">RESET</button></td>
        </tr>
        <tr>
            <td><b>작업 설비2</b></td>
            <td><input type="text" id="textInputC" autocomplete="off" placeholder="설비 QR CODE를 리딩하세요" value=""
                    style="width: 500px;"></td>
            <td></td>

            <td><button onclick="resetc()">RESET</button></td>
        </tr>
        <tr>
            <td><b>금형 코드1</b></td>
            <td><input type="text" id="textInputD" autocomplete="off" placeholder="금형 QR CODE를 리딩하세요" value=""
                    style="width: 500px;"></td>
            <td></td>

            <td><button onclick="resetd()">RESET</button></td>
        </tr>
        <tr>
            <td><b>금형 코드2</b></td>
            <td><input type="text" id="textInputE" autocomplete="off" placeholder="금형 QR CODE를 리딩하세요" value=""
                    style="width: 500px;"></td>
            <td></td>

            <td><button onclick="resete()">RESET</button></td>
        </tr>
        <tr>
            <td colspan="4"><button id="confirmBtn" onclick="checkInputs()">확인</button></td>
        </tr>
    </table>
    <table id="editableTable">
        <thead>
            <tr class="table-light">
                <th colspan="7">생산 정보</th>

            </tr>
            <tr class="table-light">
                <th>BOMNO</th>
                <th>모델명</th>
                <th>제품명</th>
                <th>고객사명</th>
                <th>생산수량</th>
                <th>작업차수</th>

            </tr>
            <tr class="table-light">
                <td id="bomno"></td>
                <td id="modelnmae"></td>
                <td id="itemname"></td>
                <td id="customer"></td>
                <td id="productcount"></td>
                <td id="working"></td>
            </tr>
            <tr class="table-light">
                <th>Cavity</th>
                <th>PCS수량</th>
                <th>공정구분</th>
                <th>타발방향</th>
                <th>생산LOT</th>
                <th>고객사코드</th>

            </tr>
            <tr class="table-light">
                <td id="cavity"></td>
                <td id="pcs"></td>
                <td id="part"></td>
                <td id="direction"></td>
                <td id="lotno"></td>
                <td id="itemcode"></td>
            </tr>
        </thead>
        <tbody id="info">


        </tbody>
    </table>
    <table id="editableTable">
        <thead>
            <tr class="table-light">
                <th colspan="7">BOM INFO</th>

            </tr>
            <tr class="table-light">
                <th>자재명</th>
                <th>규격폭(mm)</th>
                <th>수량(M)</th>
                <th>LOTNO</th>
                <th>롤 수량</th>
                <th>총 입고수량(M)</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="info">


        </tbody>
    </table>



    <script>
        var server = '';

        if (window.location.hostname == 'localhost') {
            server = 'http://localhost:8080';
        } else {
            server = 'http://techonmes.co.kr';
        }

        document.getElementById('textInputA').focus();
        function reseta() {
            document.getElementById('textInputA').focus();
            $('#textInputA').val(''); // 입력란의 값을 공백으로 설정
        }
        function resetb() {
            document.getElementById('textInputB').focus();
            $('#textInputB').val(''); // 입력란의 값을 공백으로 설정
        }
        function resetc() {
            document.getElementById('textInputC').focus();
            $('#textInputC').val(''); // 입력란의 값을 공백으로 설정
        }
        function resetd() {
            document.getElementById('textInputD').focus();
            $('#textInputD').val(''); // 입력란의 값을 공백으로 설정
        }
        function resete() {
            document.getElementById('textInputE').focus();
            $('#textInputE').val(''); // 입력란의 값을 공백으로 설정
        }
        $('#textInputA').keypress(function (event) {
            if (event.which === 13) { // Enter 키 코드인 13인지 확인
                $('#textInputB').focus(); // 입력란의 값을 공백으로 설정
            }
        });

        function checkInputs() {
            var inputA = document.getElementById("textInputA").value.trim();
            var inputB = document.getElementById("textInputB").value.trim();

            if (inputA === "") {
                alert("첫번째 자재 항목이 누락되었습니다");
                return;
            }
            if (inputB === "") {
                alert("두번째 자재 항목이 누락되었습니다");
                return;
            }

            var text = document.getElementById("textInputA").value.replace(/\s/g, ''); // 모든 공백 제거
            var contents = text.split('/');

            var materialName = contents[0];
            var lotNo = contents[1];
            var manufacturingDate = contents[2];
            var quantity = contents[3];
            var expirationDate = contents[4];
            var newRow1 = document.createElement("tr");
            var materialwidth = contents[5] || ""; // 6번째 내용이 없으면 공란 처리
            var orderno = contents[6] || ""; // 7번째 내용이 없으면 공란 처리


            $.ajax({
                type: 'POST',
                url: server + '/api/selectcodenumber',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    "materialname": contents[0],
                    "length": contents[3]
                }),
                success: function (result) {
                    // 첫 번째 행 생성
                    var newRow1 = document.createElement("tr");
                    newRow1.innerHTML = `
            <td>${materialName}</td>
            <td>${result[0].width}</td>
            <td>${quantity}</td>
            <td>${lotNo}</td>
            <td>1</td>
            <td>${quantity}</td>
            <td></td>
        `;

                    // 두 번째 행 생성
                    var newRow2 = document.createElement("tr");
                    newRow2.innerHTML = `
            <td>${materialName}</td>
            <td>${result[0].width}</td>
            <td>${quantity}</td>
            <td>${lotNo}</td>
            <td>1</td>
            <td>${quantity}</td>
            <td><button class="add-row-btn" onclick="addRow(this)">슬리팅 추가</button></td>
        `;

                    // 테이블에 행 추가
                    document.getElementById("info").appendChild(newRow1);
                    document.getElementById("info").appendChild(newRow2);
                },
            });


            // 테이블에 행 추가
            document.getElementById("info").appendChild(newRow1);
        }
        var newRow; // newRow 변수를 전역 범위에서 정의합니다.

        function addRow(btn) {
            var tableRow = btn.parentNode.parentNode;
            var rowData = [];
            // 해당 행의 첫 번째 셀(자재명) 데이터를 가져옴


            var firstMaterialName = tableRow.previousElementSibling.cells[0].innerText;

            // 두 번째 행의 첫 번째 셀(자재명) 데이터를 가져옴
            var secondMaterialName = tableRow.cells[0].innerText;

            // 두 행의 자재명을 결합하여 출력
            console.log("첫번째 행 자재명:", firstMaterialName);
            console.log("두번째 행 자재명:", secondMaterialName);
            rowData.push(firstMaterialName + ' + ' + secondMaterialName);
            // 나머지 열은 공란으로 추가
            for (var i = 1; i < 3; i++) {
                rowData.push('');
            }

            // 해당 행의 네 번째 셀(LOTNO) 데이터를 가져옴
            rowData.push(tableRow.cells[3].innerText);

            // 나머지 열은 공란으로 추가
            for (var i = 5; i < 7; i++) {
                rowData.push('');
            }

            // 가져온 데이터를 새로운 행으로 추가
            newRow = document.createElement('tr'); // newRow 변수를 설정합니다.
            for (var i = 0; i < rowData.length; i++) {
                var newCell = document.createElement('td');
                newCell.innerText = rowData[i];
                newRow.appendChild(newCell);
                newCell.setAttribute('contenteditable', 'true');

                if (i === 2 || i === 4) {
                    newCell.setAttribute('oninput', 'onchanged(this)');
                }

                // 키다운 이벤트 리스너 추가
                newCell.addEventListener('keydown', function (event) {
                    if (event.key === 'Enter') {
                        this.blur(); // 수정 종료
                        event.preventDefault(); // 기본 동작 방지 (새 줄 생성 방지)
                    }
                });
            }

            // 삭제 버튼 추가
            var deleteBtnCell = document.createElement('td');
            var deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-row-btn';
            deleteBtn.textContent = '삭제';
            deleteBtn.onclick = function () {
                deleteRow(this);
            };
            deleteBtnCell.appendChild(deleteBtn);
            newRow.appendChild(deleteBtnCell);

            // 새로운 행을 마지막에 추가
            tableRow.parentNode.insertBefore(newRow, tableRow.nextSibling);
            newRow.classList.add('highlight');
        }

        function deleteRow(btn) {
            var tableRow = btn.parentNode.parentNode;
            tableRow.parentNode.removeChild(tableRow);
        }

        function onchanged(cell) {
            // 두 번째 셀과 네 번째 셀의 값 가져오기
            var cell2Value = parseInt(cell.parentNode.cells[2].innerText);
            var cell4Value = parseInt(cell.parentNode.cells[4].innerText);

            // 값이 유효한지 확인
            if (!isNaN(cell2Value) && !isNaN(cell4Value)) {
                // 총 입고수량 계산
                var totalValue = cell2Value * cell4Value;
                // 결과를 다섯 번째 셀에 표시
                cell.parentNode.cells[5].innerText = totalValue.toLocaleString();
            }
        }

        document.querySelectorAll('[contenteditable="true"]').forEach(function (element) {
            element.addEventListener('keydown', function (event) {
                if (event.key === 'Enter') {
                    element.blur(); // 수정 종료
                    event.preventDefault(); // 기본 동작 방지 (새 줄 생성 방지)
                }
            });
        });


    </script>

</body>

</html>
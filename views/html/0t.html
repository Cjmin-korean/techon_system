<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Data Table</title>
    <script data-require="jquery@2.0.3" data-semver="2.0.3" src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: white;
            padding: 20px;
            overflow-y: hidden;
            margin: 0;
        }


        table.grid {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        table.grid thead {
            position: sticky;
            top: 0;
            z-index: 1;
        }

        table.grid tbody {
            display: block;
            max-height: 80vh;
            overflow-y: auto;
        }

        table.grid thead tr td {
            background-color: #d9dce2;
            color: rgb(0, 0, 0);
            font-weight: bold;
            padding: 10px;
            position: relative;
            /* cursor: pointer; */
            text-align: left;
            border: 1px solid #ddd;
        }

        table.grid tbody tr:nth-child(odd) {
            background-color: #eef0f5;
        }

        table.grid tbody tr td {
            padding: 5px;
            /* Adjusted padding to make the rows wider */
            border: 1px solid #ddd;
        }

        table.grid thead,
        table.grid tbody tr {
            display: table;
            width: 100%;
            table-layout: fixed;
            padding: 10px;
            /* Ensures columns are of equal width */
        }

        .filter {
            position: absolute;
            border: solid 1px #ddd;
            top: 35px;
            background-color: white;
            width: 200px;
            min-height: 400px;
            max-height: 400px;
            overflow-y: auto;
            right: 0;
            display: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }


        .grid-item {
            text-align: left;
            /* Align checkboxes and text to the left */
            padding: 5px;
        }


        .button-container {
            position: relative;
            padding: 10px 0;
            text-align: center;
            border-top: 1px solid #ccc;
            bottom: 0;
            /* height: 100px; */
            /* Optional: add a border at the top of the button container */
        }

        .filter .filter-content {
            overflow-y: auto;
            /* Allows scrolling for the checkbox list */
            flex-grow: 1;
            max-height: 32vh;
            min-height: 32vh;
        }

        .filter .filter-actions {
            padding: 5px;
            border-top: 1px solid #ddd;
            background-color: white;
            display: flex;
            justify-content: flex-end;
            /* Aligns buttons to the right */
        }

        .filter div {
            padding: 5px;
        }

        .filter div input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.5);
            /* Ï≤¥ÌÅ¨Î∞ïÏä§ ÌÅ¨Í∏∞ ÌôïÎåÄ */
        }

        .filter .filter-actions input[type="button"] {
            margin-left: 5px;
            padding: 5px 10px;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 3px;
        }

        .filter div input[type="button"] {
            margin: 5px;
            padding: 5px 10px;
            border: none;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            border-radius: 3px;
        }


        .filter .filter-actions input#ok {
            background-color: #4531b6;
            /* Green for OK */
        }

        .filter .filter-actions input#ok:hover {
            background-color: #2c0e70;
        }

        .filter .filter-actions input#close {
            background-color: #f44336;
            /* Red for Cancel */
        }

        .filter .filter-actions input#close:hover {
            background-color: #e53935;
        }

        .filter-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            /* color: white; */
            border: none;
            border-radius: 20%;
            padding: 5px;
            cursor: pointer;
            font-size: 14px;
            width: 20px;
            height: 20px;
            float: right;
        }

        .filter-button:hover {
            /* background-color: #45a049; */
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }

        .filter-icon {
            font-size: 20px;
            margin: 0;
        }
    </style>
</head>

<body>
    <h3 style="margin-top: 10px; font-weight: bold;"> Th√¥ng tin kh√°ch h√†ng / Í±∞ÎûòÏ≤ò Ï†ïÎ≥¥</h3>
    <table class="grid">
        <thead>
            <tr>
                <th id="datacount"></th>
            </tr>
            <tr>
                <td index="0" style="text-align: center;">T√™n nh√† cung c·∫•p<br>Í±∞ÎûòÏ≤òÎ™Ö
                    <div class="filter"></div>
                </td>
                <td index="1" style="text-align: center;">S·ªë ƒëƒÉng k√Ω kinh doanh<br>ÏÇ¨ÏóÖÏûêÎì±Î°ùÎ≤àÌò∏
                    <div class="filter"></div>
                </td>
                <td index="2" style="text-align: center;">T√™n ng∆∞·ªùi ƒë·∫°i di·ªán<br>ÎåÄÌëúÏûêÎ™Ö
                    <div class="filter"></div>
                </td>
                <td index="3" style="text-align: center;">IN<br>
                    <div class="filter"></div>
                </td>

            </tr>
        </thead>
        <tbody id="Datatbody">

        </tbody>
    </table>
</body>

<script>
    var server = '';
    if (window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost') {
        server = 'http://localhost:8080';
    } else {
        server = 'https://mestechon.com';
    }


    $(document).ready(function () {
        $(".grid thead td").append('<button style="float:right; " class="filter-button"><span class="filter-icon">üîç</span></button>'); // Add filter button to each header
        $(".filter-button").click(function (e) {
            e.stopPropagation();
            showFilterOption(this);
        });

        $(".grid thead td").not('.filtered-column').click(function () {
            groupData(this);
        });
        load();
        updateRowCount();
    });
    function load() {
        $('#Datatbody').empty();
        $.ajax({
            type: 'POST',
            url: server + '/api/selectcustomerinfovina',
            dataType: 'json',
            success: function (data) {
                if (data.length === 0) {
                    $('#Datatbody').append(
                        '<tr><td colspan="13" style="text-align:center;">Kh√¥ng c√≥ d·ªØ li·ªáu(Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§)</td></tr>'
                    );
                } else {
                    for (var i = 0; i < data.length; i++) {

                        var rowData = JSON.stringify(data[i]);

                        $('#Datatbody').append(
                            '<tr>' +
                            '<td>' + data[i].customername + '</td>' +
                            '<td>' + data[i].businessregistrationnumber + '</td>' +
                            '<td>' + data[i].representativename + '</td>' +
                            '<td>' + data[i].initial + '</td>' +
                            '<td id="data-id" style="display:none;">' + data[i].id + '</td>' +
                            // '<td><button class="btn btn-primary" onclick=\'showinfo(' + rowData + ')\'>Info</button></td>' +
                            '</tr>'
                        );
                    }
                    $("#datacount").text("Data: " + data.length);
                }
            }
        });
    }


    var arrayMap = {};
    function showFilterOption(button) {
        var tdObject = $(button).parent();
        var filterGrid = $(tdObject).find(".filter");

        if (filterGrid.is(":visible")) {
            filterGrid.hide();
            return;
        }

        $(".filter").hide();

        var index = 0;
        filterGrid.empty();
        var allSelected = true;
        var contentDiv = $('<div class="filter-content"></div>');
        filterGrid.append(contentDiv);

        contentDiv.append('<div><input id="all" type="checkbox" checked>Select All</div>');

        var $rows = $(tdObject).parents("table").find("tbody tr");
        var uniqueValues = {}; // Object to store unique values

        $rows.each(function (ind, ele) {
            var currentTd = $(ele).children()[$(tdObject).attr("index")];
            var text = currentTd.innerHTML;

            // Store unique values
            if (!uniqueValues[text]) {
                uniqueValues[text] = true;
                var div = document.createElement("div");
                div.classList.add("grid-item");
                var str = $(ele).is(":visible") ? 'checked' : '';
                if ($(ele).is(":hidden")) {
                    allSelected = false;
                }
                div.innerHTML = '<input type="checkbox" ' + str + ' >' + text;
                contentDiv.append(div);
                arrayMap[index] = ele;
                index++;
            }
        });

        if (!allSelected) {
            contentDiv.find("#all").removeAttr("checked");
        }

        // Separate button container
        filterGrid.append('<div class="button-container"><input id="close" type="button" value="Close"/><input id="ok" type="button" value="Ok"/></div>');
        filterGrid.show();

        var $closeBtn = filterGrid.find("#close");
        var $okBtn = filterGrid.find("#ok");
        var $checkElems = contentDiv.find("input[type='checkbox']");
        var $gridItems = contentDiv.find(".grid-item");
        var $all = contentDiv.find("#all");

        $closeBtn.click(function () {
            filterGrid.hide();
            return false;
        });

        $okBtn.click(function () {
            var filterApplied = false;
            contentDiv.find(".grid-item").each(function (ind, ele) {
                if ($(ele).find("input").is(":checked")) {
                    $(arrayMap[ind]).show();
                } else {
                    $(arrayMap[ind]).hide();
                    filterApplied = true; // ÌïÑÌÑ∞Í∞Ä Ï†ÅÏö©Îêú Í≤ÉÏúºÎ°ú ÌëúÏãú
                }
            });

            if (filterApplied) {
                tdObject.addClass("filtered-column"); // ÌïÑÌÑ∞Í∞Ä Ï†ÅÏö©Îêú Ïª¨ÎüºÏóê ÌëúÏãú Ï∂îÍ∞Ä
                tdObject.append('<span class="filter-icon">&#x1F50D;</span>'); // ÌïÑÌÑ∞ ÏïÑÏù¥ÏΩò Ï∂îÍ∞Ä
            } else {
                tdObject.removeClass("filtered-column"); // ÌïÑÌÑ∞ Ìï¥Ï†ú Ïãú ÌëúÏãú Ï†úÍ±∞
                tdObject.find(".filter-icon").remove(); // ÌïÑÌÑ∞ ÏïÑÏù¥ÏΩò Ï†úÍ±∞
            }

            filterGrid.hide();
            return false;
        });

        $checkElems.click(function (event) {
            event.stopPropagation();
        });

        $gridItems.click(function (event) {
            var chk = $(this).find("input[type='checkbox']");
            $(chk).prop("checked", !$(chk).is(":checked"));
        });

        $all.change(function () {
            var chked = $(this).is(":checked");
            contentDiv.find(".grid-item [type='checkbox']").prop("checked", chked);
        });

        filterGrid.click(function (event) {
            event.stopPropagation();
        });

        return filterGrid;
    }


    function groupData(tdObject) {
        var index = $(tdObject).attr("index");
        var $rows = $(tdObject).parents("table").find("tbody tr:visible");
        var uniqueValues = {};

        $rows.each(function () {
            var cellValue = $(this).children().eq(index).text();
            if (uniqueValues[cellValue]) {
                $(this).hide(); // ÎèôÏùºÌïú Í∞íÏù¥ Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎ©¥ Ïà®Í∏∞Í∏∞
            } else {
                uniqueValues[cellValue] = true;
            }
        });
    }


    $(document).mouseup(function (e) {
        var $filter = $('.filter');

        // If the target of the click isn't the filter div nor a descendant of the filter div
        if (!$filter.is(e.target) && $filter.has(e.target).length === 0) {
            $filter.hide(); // Hide the filter div
        }
    });

  



</script>

</html>
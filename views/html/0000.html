<!DOCTYPE html>
<html>

<head>
    <script data-require="jquery@2.0.3" data-semver="2.0.3" src="http://code.jquery.com/jquery-2.0.3.min.js"></script>

    <style>
        table thead td {
            background-color: red;
            min-width: 100px;
            position: relative;
            cursor: pointer;
        }

        .filter {
            position: absolute;
            border: solid 1px #ddd;
            top: 30px;
            background-color: white;
            width: 150px;
            right: 0;
            display: none;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 10px;
        }

        .filter div.group {
            margin: 5px 0;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }

        .filter input[type="checkbox"] {
            margin-right: 5px;
        }
    </style>
</head>

<body>
    <table class="grid">
        <thead>
            <tr>
                <td data-index="0">Name
                    <div class="filter"></div>
                </td>
                <td data-index="1">Address
                    <div class="filter"></div>
                </td>
                <td data-index="2">City
                    <div class="filter"></div>
                </td>
            </tr>
        </thead>
        <tbody id="Datatbody">

        </tbody>
    </table>

    <div id="dataCount"></div>

    <script>
        var server = '';
        if (window.location.hostname == 'localhost') {
            server = 'http://localhost:8080';
        } else {
            server = 'http://techonmes.co.kr';
        }

        // Code goes here
        function load() {
            $('#Datatbody').empty()
            $.ajax({
                type: 'POST',
                url: server + '/api/sampleorder',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({}),
                success: function (result) {
                    var tableFoot = $('#dataCount');
                    if (result.length === 0) {
                        // 데이터가 없을 때 "데이터가 없습니다" 문구 추가
                        tableFoot.text('총 데이터 개수: 0');
                    } else {
                        for (var i = 0; i < result.length; i++) {
                            $('#Datatbody').append(
                                '<tr ondblclick="openEditModal2(this)">' +
                                '<td><input type="checkbox" class="select-checkbox" style="width:20px; height:20px; cursor:pointer;"></td>' +
                                '<td>' + result[i].bomno + '</td>' +
                                '<td>' + result[i].classification + '</td>' +
                                '</tr>'
                            );
                            // $("td#data-id").hide(); // This line is removed
                        }
                    }
                }
            })
        }

        $(document).ready(function () {
            var currentFilterColumn = null;

            $(".grid thead td").click(function () {
                var clickedColumn = $(this).data("index");

                if (currentFilterColumn !== clickedColumn) {
                    // Clear previous filter options and show the new ones
                    $(".filter").hide();
                    showFilterOption(this);
                    currentFilterColumn = clickedColumn;
                } else {
                    // Toggle visibility if the same column is clicked again
                    $(".filter").toggle();
                }
            });

            load();
        });

        var arrayMap = {};

        function showFilterOption(tdObject) {
            var filterGrid = $(tdObject).find(".filter");

            if (filterGrid.is(":visible")) {
                filterGrid.hide();
                return;
            }

            $(".filter").hide();

            var index = 0;
            filterGrid.empty();
            var allSelected = true;
            filterGrid.append('<div class="group"><input id="all" type="checkbox" checked>전체</div>');

            var $rows = $(tdObject).parents("table").find("tbody tr");

            $rows.each(function (ind, ele) {
                var currentTd = $(ele).children()[$(tdObject).data("index")];
                var div = document.createElement("div");
                div.classList.add("grid-item");
                var str = $(ele).is(":visible") ? 'checked' : '';
                if ($(ele).is(":hidden")) {
                    allSelected = false;
                }
                div.innerHTML = '<input type="checkbox" ' + str + ' >' + currentTd.innerHTML;
                filterGrid.append(div);
                arrayMap[index] = ele;
                index++;
            });

            if (!allSelected) {
                filterGrid.find("#all").removeAttr("checked");
            }

            filterGrid.append('<div><input id="close" type="button" value="Close"/><input id="ok" type="button" value="Ok"/></div>');
            filterGrid.show();

            var $closeBtn = filterGrid.find("#close");
            var $okBtn = filterGrid.find("#ok");
            var $checkElems = filterGrid.find("input[type='checkbox']");
            var $gridItems = filterGrid.find(".grid-item");
            var $all = filterGrid.find("#all");

            $closeBtn.click(function () {
                filterGrid.hide();
                return false;
            });

            $okBtn.click(function () {
                filterGrid.find(".grid-item").each(function (ind, ele) {
                    if ($(ele).find("input").is(":checked")) {
                        $(arrayMap[ind]).show();
                    } else {
                        $(arrayMap[ind]).hide();
                    }
                });
                filterGrid.hide();
                return false;
            });

            $checkElems.click(function (event) {
                event.stopPropagation();
            });

            $gridItems.click(function (event) {
                var chk = $(this).find("input[type='checkbox']");
                $(chk).prop("checked", !$(chk).is(":checked"));
            });

            $all.change(function () {
                var chked = $(this).is(":checked");
                filterGrid.find(".grid-item [type='checkbox']").prop("checked", chked);
            })

            filterGrid.click(function (event) {
                event.stopPropagation();
            });
            return filterGrid;
        }
    </script>

</html>

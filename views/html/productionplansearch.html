<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>거래처정보</title>
<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="../css/mesmain.css">
<link rel="stylesheet" href="../css/mesmaterialinput.css">
<link rel="stylesheet" href="../css/calendar.css">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

<head>
    <style>
        input {
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 15px;
            font-weight: bold;
        }

        #datatable th {
            text-align: center;
        }

        #datatable td {
            height: 20px;
        }
    </style>
</head>

<body>
    <div class="main_header">
        <img src="/img/테크온로고.PNG" style="width: 100px;" class="loadingImage">
        <a style="margin-left: 20px;">생산계획등록</a>
    </div>

    <div id="overlay"></div>
    <div id="editModal3" style="max-height: 600px;  overflow-y: auto;">
        <div class="mainheader">
            <h1>생산 계획 등록</h1>
            <span class="close" onclick="closeModal()">&times;</span>
        </div>
        <div id="editForm">
            <input type="text" style="width:200px;" id="equipmentname">
            <input type="text" style="width:200px;" id="num">
            <input type="text" style="width:200px;" id="dataid">
            <input type="text" style="width:200px;" id="plandatein">
            <table class="styled-table" id="planstauts">

                <thead id="tableHead">
                    <tr>
                        <th colspan="8" rowspan="1"
                            style="width: auto; font-size: 20px; font-weight: bold; border: 1px solid rgb(231, 228, 228);">
                            생산확정 리스트
                        </th>
                    </tr>


                    <tr>
                        <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">BOM NO.</th>
                        <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">차수</th>
                        <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">생산계획날짜</th>
                        <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">모델명</th>
                        <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">품명</th>
                        <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">생산LOT</th>
                        <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">수량</th>
                        <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);"></th>


                    </tr>

                </thead>
                <tbody id="planstatustbody">
                </tbody>
            </table>
        </div>
    </div>

    <div class="calendar">
        <div class="month">
            <button class="prev-month">
                <img style="cursor:pointer;" src="../img/left-arrow.png" />
            </button>
            <h1 id="month-year">2023년 9월</h1>
            <button class="next-month">
                <img style="cursor:pointer;" src="../img/right-arrow.png" />
            </button>
        </div>
        <div class="dates">
        </div>
    </div>


    <div id="datatable-container" style="width: 100%; float: left;">
        <table class="styled-table" id="datatable">
            <thead id="tableHead">
                <tr>
                    <th colspan="16" style="width: auto;  border: 1px solid rgb(231, 228, 228);;" id="plandate"></th>
                </tr>
                <tr>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);  ">
                        호기(설비명)
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);  ">BOM
                        NO.
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);  ">
                        고객사
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); ">
                        모델명
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); ">
                        품명
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        총작업<br>차수
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228); ">
                        라인계획<br>작업차수
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        생산LOT
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        작업지시<br>수량(PO)
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        누적
                        생산<br>실적
                    </th>
                    <th rowspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        작업지시<br>생산 잔량<br>(PO)
                    </th>
                    <th colspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        반제품 계획실적
                    </th>
                    <th colspan="2" style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        완제품 계획실적
                    </th>

                </tr>
                <tr>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        금일계획
                    </th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        금일실적
                    </th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        금일계획
                    </th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">
                        금일실적
                    </th>

                </tr>

            </thead>
            <tbody id="Datatbody">
            </tbody>
        </table>
    </div>
    <!-- <div id="datatable-container" style="width: 31%; height: 100%; float: right; border: 1px solid silver;">
        <table class="styled-table" id="planstauts">

            <thead id="tableHead1">
                <tr>
                    <th colspan="7" rowspan="1"
                        style="width: auto; font-size: 20px; font-weight: bold; border: 1px solid rgb(231, 228, 228);">
                        생산확정리스트
                    </th>

                </tr>
                <tr>


                </tr>

                <tr>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">BOM NO.</th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">차수</th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">생산계획날짜</th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">모델명</th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">품명</th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">생산LOT</th>
                    <th style="width: auto; font-size: 15px; border: 1px solid rgb(231, 228, 228);">수량</th>


                </tr>

            </thead>
            <tbody id="planstatustbody">
            </tbody>
        </table>
    </div> -->

    <div id="popupOverlay2" style="display: none;">
        <div id="popupContent">
            <div class="form-group">
                <table style="width:100%;">

                    <tr>
                        <td style="width: 100%;" class="popup_title">생산계획 정보를 삭제하시겠습니까?</td>
                    </tr>

                </table>
            </div>
            <button id="popupCloseBtn-delete-close">취소</button>
            <button id="popupCloseBtn-delete" onclick="Datadelte()">삭제</button>
            <input type="text" id="id-edit" style="visibility: hidden; width: 10px; float: right;" autocomplete="off">
        </div>
    </div>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script> -->
    <script>
        $('#popupCloseBtn-delete-close').click(function () {
            $('#popupOverlay2').fadeOut();
        });

    </script>

    <script>
        function load() {
            $('#planstatustbody').empty();
            $.ajax({
                type: 'POST',
                url: server + '/api/productorderlist',
                dataType: 'json',
                success: function (data) {
                    var tableBody = $('#planstatustbody');
                    if (data.length === 0) {
                    } else {
                        loadData = data;

                        for (var i = 0; i < data.length; i++) {
                            tableBody.append(
                                '<tr draggable="true">' +
                                '<td>' + data[i].bomno + '</td>' +
                                '<td>' + data[i].char + '</td>' +
                                '<td style="font-weight:bold;">' + data[i].productdate + '</td>' +
                                '<td>' + data[i].modelname + '</td>' +
                                '<td>' + data[i].itemname + '</td>' +
                                '<td>' + data[i].lotno + '</td>' +
                                '<td style="text-align:right;">' + data[i].quantity.toLocaleString() + '</td>' +
                                '<td><button onclick="logRowData(' + i + ')">계획등록</button></td>' +
                                '<td class="data-id">' + data[i].id + '</td>' +
                                '</tr>'
                            );
                        }
                    }
                    $('.data-id').hide();
                }
            });
        }

        function logRowData(index) {
            // Retrieve the corresponding row data and log it to the console
            var rowData = loadData[index];
            console.log('Row Data:', loadData[0].bomno);


            Swal.fire({
                icon: 'info',
                title: '저장',
                text: '생산계획을 저장하시겠습니까??',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: '확인',
                cancelButtonText: '취소',
            }).then((result) => {
                if (result.isConfirmed) {


                    $.ajax({
                        type: 'POST',
                        url: server + '/api/planinsert',
                        dataType: 'json',
                        contentType: 'application/json',
                        data: JSON.stringify({

                            "plandate": $('#plandatein').val(),
                            "bomno": loadData[0].bomno,
                            "modelname": loadData[0].modelname,
                            "itemname": loadData[0].itemname,
                            "lotno": loadData[0].lotno,
                            "equipmentname": $('#dataid').val(),
                            "num": $('#num').val(),

                        }),
                        success: function (result) {

                        },

                    });


                    $('#editModal3').fadeOut();
                    $('#overlay').fadeOut();
                    Swal.fire({
                        icon: 'success',
                        title: '저장 완료',
                        text: '생산계획 정보가 등록 되었습니다.',
                    }).then((result) => {
                        if (result.isConfirmed) {
                            load()
                        }
                    });
                }
            });
        }


        function planinsert() {
            var plandate = $('#plandate-save').val();
            var bomno = $('#bomno-save').val();
            var modelname = $('#modelname-save').val();
            var itemname = $('#itemname-save').val();
            var lotno = $('#lotno-save').val();
            var pono = $('#quantity-save').val();
            var equipmentname = $('#equipment-select').val();

            $.ajax({
                type: 'POST',
                url: server + '/api/searchequipmentcodenumber',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    "equipmentname": equipmentname
                }),
                success: function (data) {
                    $.ajax({
                        type: 'POST',
                        url: server + '/api/planinsert',
                        dataType: 'json',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            "plandate": plandate,
                            "bomno": bomno,
                            "modelname": modelname,
                            "itemname": itemname,
                            "lotno": lotno,
                            "pono": pono,
                            "equipmentname": data[0].codenumber,
                            "num": '1'

                        }),
                        success: function (result) {
                        },
                        error: function (error) {
                        }
                    });
                },
                error: function (error) {
                }
            });

            $.ajax({
                type: 'POST',
                url: server + '/api/statusfalse',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    "orderstatus": '생산확정완료',
                    "lotno": lotno

                }),
                success: function (data) {

                },
                error: function (error) {
                }
            });

            $('#popupOverlay').fadeOut();

            load()
            planload()
            plansearching()

        }



        function openmodal(element) {
            var rowData = $(element).closest('tr').find('td').map(function () {
                return $(this).text();
            }).get();
            console.log($('#plandate').val())
            $('#overlay').fadeIn();
            $('#editModal3').fadeIn();

            if (rowData.length === 18) {
                $('#equipmentname').val(rowData[16]);
                $('#num').val(rowData[15]);
                $('#dataid').val(rowData[17]);
                $('#plandatein').val($('#plandate').text());
            } else {
                $('#equipmentname').val(rowData[15]);
                $('#num').val(rowData[14]);
                $('#dataid').val(rowData[16]);
                $('#plandatein').val($('#plandate').text());
            }



        }
        function closeModal() {
            $('#overlay').fadeOut();
            $('#editModal3').fadeOut();
        }
        function save(row) {
            var rowData = $(row).closest('tr').find('td').map(function () {
                return $(this).text();
            }).get();
        }

    </script>


    <script src="../js/calendar.js"></script>
    <script src="../js/drag.js"></script>


</body>

</html>
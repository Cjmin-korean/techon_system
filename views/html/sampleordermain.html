<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link rel="stylesheet" href="../css/sampleordermain.css">
    <link rel="stylesheet" href="../css/spiner.css">
    <link rel="stylesheet" href="../css/header.css">
    <script src="../js/bommasssave.js"></script>
    <script src="../js/bommassedit.js"></script>
    <script src="../js/bommass.js"></script>
    <script src="../js/datetimepicker.js"></script>
    <title>샘플발주 접수 및 생산지시</title>
</head>
<style>



</style>

<body>
    <div class="spinner-overlay">
        <div class="spinner"></div>
    </div>

    <div class="header-container">
        <div class="header-title">
            <h2><i class="fas fa-cube"></i> &nbsp;샘플발주 접수 및 생산지시</h2>
        </div>
        <div class="header-subtitle">
            <h4>샘플 BOM > 샘플발주 접수 및 생산지시</h4>
        </div>
    </div>
    <div id="overlay" class="overlay"></div>
    <div id="overlay1" class="overlay"></div>

    <fieldset>
        <legend>검색조건</legend>
        <i class="fas fa-search"></i>
        <input type="date" id="datetimepicker1" style="width:200px;">
        <input type="date" id="datetimepicker2" style="width:200px;">
        <button class="close-button" onclick="load()">조회</button>
        <button class="close-button" onclick="openEditModal()">신규등록</button>
    </fieldset>

    <div id="maintable" class="table-wrapper">
        <table>
            <thead>
                <th>발주일자</th>
                <th>접수일자</th>
                <th>출하일자</th>
                <th>BOM NO.</th>
                <th>고객사</th>
                <th>모델명</th>
                <th>품목명</th>
                <th>고객사코드</th>
                <th>EA=PCS</th>
                <th>고객출하수량<br>(PCS)</th>
                <th>고객출하수량<br>(EA)</th>
                <th>생산수량<br>(EA)</th>
                <th>검사수량<br>(EA)</th>
                <th>작업구분</th>
                <th>입고상태</th>
                <th>출고시간</th>
                <th>사양구분</th>
                <th>청구/미청구</th>
                <th>판가<br>(￦)</th>
                <th>합계금액<br>(￦)</th>
                <th>매입단가<br>(￦)</th>
                <th>매입합계<br>(￦)</th>
                <th>마감유무</th>
                <th style="width: 90px;"></th>
            </thead>

            <tbody id="iteminfobody">
            </tbody>
            <tfoot id="iteminfofoot">
            </tfoot>
        </table>
    </div>



    <div class="modal" id="modal">
        <div class="modal-header">
            <span style="font-weight: bold; font-size: 20px;"> <i class="fas fa-cube"></i>&nbsp;샘플 발주 및 생산지시</span>
            <input type="text" id="bomid-edit" style="width: 200px; visibility: hidden;">
            <div class="modal-footer">
                <button class="close-button" onclick="Bomsave()()">저장</button>
                <button class="delete-button" style="margin-left: 10px;" onclick="closeModal()">취소</button>
            </div>
        </div>


        <div style="height: 80%; max-height: 80%; overflow-y: auto; display: block;" id="containers">
            <table style="width: 150%;">
                <thead id="tableHead">
                    <tr style="height: 30px;">
                        <th style="width: 70px;" rowspan="2"><button id="addRowBtn" class="close-button"
                                onclick="addRow()">추가</button>
                        </th>
                        <th style="width:80px">발주일자</th>
                        <th style="width:80px">접수일자</th>
                        <th style="width:80px">출하일자</th>
                        <th style="width:200px;">BOM NO.</th>
                        <th style="width:200px;">고객사</th>
                        <th style="width:200px;">모델명</th>
                        <th style="width:200px;">품목명</th>
                        <th style="width:200px;">고객사코드</th>
                        <th style="width:200px;">EA=PCS</th>
                        <th style="width:200px;">고객출하수량<br>(PCS)</th>
                        <th style="width:200px;">고객출하수량<br>(EA)</th>
                        <th style="width:200px;">생산수량<br>(EA)</th>
                        <th style="width:200px;">검사수량<br>(EA)</th>
                        <th style="width:200px;">작업구분</th>
                        <th style="width:200px;">입고상태</th>
                        <th style="width:200px;">출고시간</th>
                        <th style="width:200px;">사양구분</th>
                        <th style="width:200px;">청구/미청구</th>
                        <th style="width:200px;">판가<br>(￦)</th>
                        <th style="width:200px;">합계금액<br>(￦)</th>
                        <th style="width:200px;">매입단가<br>(￦)</th>
                        <th style="width:200px;">매입합계<br>(￦)</th>
                        <th style="width:200px;">마감유무</th>
                    </tr>

                </thead>
                <tbody id="bomtableBody">

                </tbody>

            </table>
        </div>

    </div>

    <div class="modal1" id="modal1">
        <div class="modal-header">
            <span style="font-weight: bold; font-size: 20px;"> <i class="fas fa-cube"></i>&nbsp;TOOL 검색</span>
            <input type="text" id="numericPart" style="width: 200px; visibility: hidden;">

            <div class=" modal-footer">
                <button class="delete-button" style="margin-left: 10px;" onclick="closeModal1()">닫기</button>
            </div>
        </div>

        <div class="modal-content" style="max-height: 70%;">
            <table class="styled-table" id="Podatatable" style="height: 350px; border: 1px solid whitesmoke;">
                <thead id="tableHead">
                    <tr>
                        <th>TOOLCODE</th>
                        <th>제조사</th>
                        <th>BOMNO</th>
                        <th>거래처</th>
                        <th>모델명</th>
                        <th>제품명</th>
                        <th>차수</th>
                        <th>구분</th>
                        <th>입고단가</th>
                        <th>양산/샘플</th>
                        <th style="width:50px;"></th>
                    </tr>
                </thead>
                <tbody id="itemtbody1">
                </tbody>
            </table>

        </div>

    </div>


    <script>
        var server = '';
        var gridApi;
        if (window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost') {
            server = 'http://localhost:8080';
        } else {
            server = 'https://mestechon.com';
        }


        function handleKeyPress(event) {
            if (event.keyCode === 13) { // 엔터 키의 keyCode는 13입니다.
                load1(); // 엔터 키가 눌렸을 때 실행할 함수 호출
            }
        }

        $(document).ready(function () {
            var today = new Date();
            var year = today.getFullYear();
            var month = String(today.getMonth() + 1).padStart(2, '0'); // 월은 0부터 시작하므로 1을 더해준다.
            var day = String(today.getDate()).padStart(2, '0'); // 일
            var formattedDate = year + '-' + month + '-' + day;
            load()
        });

        function load() {
            var spinnerOverlay = document.querySelector('.spinner-overlay');
            spinnerOverlay.style.display = 'flex'; // Spinner 표시

            $('#iteminfobody').empty();
            $.ajax({
                type: 'POST',
                url: server + '/api/selectsampleorder',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    "start": $('#datetimepicker1').val(),
                    "finish": $('#datetimepicker2').val()
                }),
                success: function (data) {
                    // var deadlineCell = '<td>' + data[i].deadline + '</td>';
                    // if (data[i].deadline === '마감') {
                    //     deadlineCell = '<td style="color: red;">' + data[i].deadline + '</td>';
                    // }


                    if (data.length === 0) {
                        $('#iteminfobody').append(
                            '<tr><td colspan="29" style="text-align:center;">데이터가 없습니다</td></tr>'
                        );
                    } else {
                        for (var i = 0; i < data.length; i++) {
                            $('#iteminfobody').append(
                                '<tr>' +
                                '<td>' + data[i].insertdate + '</td>' +
                                '<td>' + data[i].orderdate + '</td>' +
                                '<td>' + data[i].outdate + '</td>' +
                                '<td>' + data[i].bomno + '</td>' +
                                '<td>' + data[i].customer + '</td>' +
                                '<td>' + data[i].modelname + '</td>' +
                                '<td>' + data[i].itemname + '</td>' +
                                '<td>' + data[i].rev + '</td>' +
                                '<td>1EA=' + data[i].pcs + 'PCS</td>' +
                                '<td style="text-align:right;">' + data[i].pcscount.toLocaleString() + '</td>' +
                                '<td style="text-align:right;">' + data[i].ordercount.toLocaleString() + '</td>' +
                                '<td style="text-align:right;">' + data[i].productcount.toLocaleString() + '</td>' +
                                '<td style="text-align:right;">' + data[i].inspectioncount.toLocaleString() + '</td>' +
                                '<td>' + data[i].part + '</td>' +
                                '<td>' + data[i].status + '</td>' +
                                '<td>' + data[i].outtime + '</td>' +
                                '<td>' + data[i].specification + '</td>' +
                                '<td>' + data[i].chung + '</td>' +
                                '<td  style="text-align:right;">' + data[i].itemprice.toLocaleString() + '</td>' +
                                '<td  style="text-align:right;">' + data[i].sumitemprice.toLocaleString() + '</td>' +
                                '<td  style="text-align:right;">' + data[i].purchaseprice.toLocaleString() + '</td>' +
                                '<td  style="text-align:right;">' + data[i].purchprice.toLocaleString() + '</td>' +
                                '<td>' + data[i].deadline + '</td>' +
                                '<td><button class="btninfo" >상세정보</button></td>' +

                                '</tr>'
                            );
                        }
                        $(".data-id").hide(); // 한 번에 숨김
                    }

                    setTimeout(function () {
                        spinnerOverlay.style.display = 'none'; // 1.1초 후에 Spinner 숨김
                    }, 1100);
                },
                error: function (error) {
                    console.error('Error:', error);
                    $('#iteminfobody').append(
                        '<tr><td colspan="20" style="text-align:center;">데이터를 불러오는 중 오류가 발생했습니다</td></tr>'
                    );
                    spinnerOverlay.style.display = 'none'; // Spinner 숨김
                }
            });
        }



        $(document).ready(function () {
            // 이벤트 리스너를 등록하기 전에 기존 리스너를 제거
            $(document).off('click', '#deleteRowBtn').on('click', '#deleteRowBtn', function () {
                const currentRow = $(this).closest('tr');
                const tbodyLength = $('#bomtableBody').find('tr').length;
                console.log(tbodyLength);
                if (tbodyLength === 1) {
                    Swal.fire({
                        icon: 'error',
                        title: '삭제 불가',
                        text: '첫 행은 삭제할 수 없습니다.',
                    });
                } else {
                    currentRow.remove();
                }
            });
        });


        function openEditModal() {
            function getCurrentDate() {
                var today = new Date();
                var year = today.getFullYear();
                var month = String(today.getMonth() + 1).padStart(2, '0');
                var day = String(today.getDate()).padStart(2, '0');
                return year + '-' + month + '-' + day;
            }

            var currentDate = getCurrentDate();

            $('#overlay').fadeIn();
            $('#modal').fadeIn();
            $('[id$="-save"]').val('');
            $('#costsum-save').val('0');
            $('#bomid-save').val(new Date().getTime());

            $('#bomtableBody').empty();
            var container = document.getElementById('containers');
            container.scrollLeft = 0;
            // Create a new row
            var newRow = $('<tr></tr>');

            // Append each cell to the new row
            newRow.append('<td><button id="deleteRowBtn" class="close-button" style="background-color: red; color:white; ">삭제</button></td>');
            newRow.append('<td><input type="date"  id="datetimepicker1-input" value="' + currentDate + '" style="width:140px;"></td>');
            newRow.append('<td><input type="date"  id="datetimepicker2-input" value="' + currentDate + '" style="width:140px;"></td>');
            newRow.append('<td><input type="date"  id="datetimepicker3-input" value="' + currentDate + '" style="width:140px;"></td>');
            newRow.append('<td><input type="text" style="cursor:pointer;" id="bomno-input" onkeypress="handleKeyPress1(event)" placeholder="제품검색" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="background-color:whitesmoke;" id="customer-input" onkeypress="handleKeyPress2(event)" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="background-color:whitesmoke;" readonly id="modelname-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="background-color:whitesmoke;" readonly  id="itemname-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="background-color:whitesmoke;"  readonly id="rev-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="background-color:whitesmoke;" id="pcs-input" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right;" oninput="validateNumericInput(this);" id="pcscount-input" value="" placeholder="숫자" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right;" oninput="validateNumericInput(this);" id="ordercount-input" value="" placeholder="숫자" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right;" oninput="validateNumericInput(this);" id="productcount-input" value="" placeholder="숫자" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right;" oninput="validateNumericInput(this);" id="inspectioncount-input" value="" placeholder="숫자" autocomplete="off"></td>');
            newRow.append('<td><select id="part-input"><option></option><option value="사내">사내</option><option value="외주">외주</option></select></td>');
            newRow.append('<td><select id="status-input"><option></option><option value="완료">완료</option><option value="미완료">미완료</option></select></td>');
            newRow.append('<td><select id="outtime-input"><option></option><option value="오전">오전</option><option value="오후">오후</option></select></td>');
            newRow.append('<td><select id="specification-input"><option></option><option value="형상변경">형상변경</option><option value="기존동일">기존동일</option><option value="양산동일">양산동일</option></select></td>');
            newRow.append('<td><select id="chung-input"><option></option><option value="청구">청구</option><option value="미청구">미청구</option></select></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color:whitesmoke;" id="itemprice-input" oninput="validateNumericInput(this);" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color:whitesmoke;" id="sumitemprice-input" oninput="validateNumericInput(this);" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color:whitesmoke;" id="purchaseprice-input" oninput="validateNumericInput(this);" value="" autocomplete="off"></td>');
            newRow.append('<td><input type="text" style="text-align:right; background-color:whitesmoke;" id="purchprice-input" oninput="validateNumericInput(this);" value="" autocomplete="off"></td>');
            newRow.append('<td><select id="ordercause-input"><option></option><option value="마감">마감</option><option value="이월">이월</option></select></td>');



            $('#bomtableBody').append(newRow);

        }
        function updateCalculatedValues() {
            var orderCount = parseFloat(document.getElementById('ordercount-input').value) || 0;
            var outPrice = parseFloat(document.getElementById('outprice-input').value) || 0;

            var a1 = orderCount * outPrice;
            var a2 = a1 * 0.1;
            var a3 = a1 * 1.1;

            document.getElementById('a1-input').value = a1.toFixed(0);
            document.getElementById('a2-input').value = a2.toFixed(0);
            document.getElementById('a3-input').value = a3.toFixed(0);
        }

        function showinfo(rowData) {
            document.getElementById('modal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
            $('#bomid-save').val(new Date().getTime());
            $('#bomid-edit').val(rowData.bomid)
            $('#bomno-save').val(rowData.bomno)
            $('#customer-save').val(rowData.customer)
            $('#modelname-save').val(rowData.modelname)
            $('#itemname-save').val(rowData.itemname)
            $('#pcs-save').val(rowData.pcs)
            $('#cavity-save').val(rowData.cavity)
            $('#itemcode-save').val(rowData.itemcode)
            $('#workpart-save').val(rowData.workpart)
            $('#working-save').val(rowData.working)
            $('#direction-save').val(rowData.direction)
            // console.log(rowData.direction)
            $('#type-save').val(rowData.type)
            var counter = 1;
            $('#bomtableBody').empty();
            var container = document.getElementById('containers');
            container.scrollLeft = 0;
            $.ajax({
                type: 'POST',
                url: server + '/api/selectbommasssavebommanagement',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    "bomno": rowData.bomno
                }),
                success: function (result) {
                    if (result.length === 0) {

                    } else {
                        for (var i = 0; i < result.length; i++) {
                            $('#bomtableBody').append(
                                '<tr>' +
                                '<td><button id="deleteRowBtn" class="close-button" style="background-color: red; color:white; ">삭제</button></td>' +
                                '<td><button id="RowBtnadd" class="rowadd-button" style="background-color: #4f56b6; color:white; ">+</button></td>' +
                                '<td><input type="checkbox" id="check-input" onchange="handleCheckboxChange(this)" style="text-align:right; width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>' +
                                '<td><input type="text" id="char-input" style="text-align:right;" value=' + (result[i].char || '') + ' autocomplete="off"></td>' +
                                '<td><input type="checkbox" id="main-edit" ' + (result[i].main === '메인자재' ? 'checked' : '') + ' style="width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>' +
                                '<td><input type="text" id="materialname-input"  onkeypress="handleKeyPress1(event)" style="cursor: pointer;"  value="' + (result[i].materialname || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" id="materialclassification-input" style="background-color: whitesmoke; " readonly value="' + (result[i].typecategory || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" id="etc-input" value="' + (result[i].etc || '') + '" autocomplete="off"></td>' +
                                '<td><input type="checkbox" onclick="handleCheckboxChange(this)" id="chk1-input" ' + (result[i].chk1 === 'true' ? 'checked' : '') + ' style="width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>' +
                                '<td><input type="checkbox" onclick="handleCheckboxChange(this)" id="chk2-input" ' + (result[i].chk2 === 'true' ? 'checked' : '') + ' style="width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>' +
                                '<td><input type="checkbox" onclick="handleCheckboxChange(this)" id="chk3-input" ' + (result[i].chk3 === 'true' ? 'checked' : '') + ' style="width: 20px; height: 20px; cursor:pointer;" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right;" id="materialwidth-input" oninput="updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost();" value="' + (result[i].materialwidth || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" id="useable-input" style="text-align:right;" value="' + (result[i].useable || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right;" id="onepidding-input" oninput="formatDecimalInput(this, 2); updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost();" value="' + (result[i].onepid || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right;" id="twopidding-input" oninput="formatDecimalInput(this, 2); updateSoyoValue(); updateRlProduct(); updateRlcutValue(); calculateCost();" value="' + (result[i].twopid || '0') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" id="soyo-input" value="' + (result[i].soyo || '') + '" autocomplete="off" readonly></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="ta-input" oninput="updateSoyoValueedit()" value="' + (result[i].ta || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right;" id="allta-input" oninput="updateSoyoValueedit(); updateRlProductedit(); updateRlcutValueedit();calculateCostedit(); formatDecimalInput(this, 2);" value="' + (result[i].allta || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right;" id="talength-input" oninput="formatDecimalInput(this, 2); updateSoyoValueedit(); updateRlProductedit(); updateRlcutValueedit(); calculateCostedit();" value="' + (result[i].talength || '0') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right;" id="loss-input" oninput="formatDecimalInput(this, 2); updateSoyoValueedit(); updateRlProductedit(); updateRlcutValueedit(); calculateCostedit();" value="' + (result[i].loss || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right;" id="costloss-input" oninput="formatDecimalInput(this, 2); updateSoyoValueedit(); updateRlProductedit(); updateRlcutValueedit(); calculateCostedit();" value="' + (result[i].loss || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" oninput="formatDecimalInput(this, 2); calculateCostedit();" id="cost-input" value="' + (result[i].cost || '0') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="rlcut-input" value="' + (result[i].rlcut || '') + '" oninput="updateRlProductedit()" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="rlproduct-input" oninput="updateRlProductedit()" value="' + (result[i].prdouctcount || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="width-input" value="' + (result[i].width || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="usewidth-input" oninput="updateRlcutValueedit()" value="' + (result[i].usewidth || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="length-input" oninput="updateRlProductedit()" value="' + (result[i].length || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="sqmprice-input" value="' + (result[i].sqmprice || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" readonly id="rollprice-input" value="' + (result[i].rollprice || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:center; background-color: whitesmoke;" readonly id="unit-input" value="' + (result[i].unit || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:center; background-color: whitesmoke;" readonly id="manufacterer-input" value="' + (result[i].manufacterer || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:center; background-color: whitesmoke;" readonly id="supplier-input" value="' + (result[i].supplier || '') + '" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" id="cavity-input" value="' + (result[i].cavity || '') + '" onchange="updateSoyoValueedit(); updateRlProductedit(); updateRlcutValueedit();calculateCostedit();" autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:center; background-color: whitesmoke;" id="codenumber-input" value="' + (result[i].codenumber || '') + '"  autocomplete="off"></td>' +
                                '<td><input type="text" style="text-align:right; background-color: whitesmoke;" id="num-input" value="' + (result[i].num || '') + '"  autocomplete="off"></td>' +
                                '</tr>'
                            )
                            counter++;
                        }
                    }
                }
            });
        }

        function validateNumericInput(input) {
            // 숫자만입력
            input.value = input.value.replace(/[^0-9]/g, '');
        }
        function formatDecimalInput(input, decimalPlaces) {
            // 소수두째짜리까지만 입력가능
            input.value = input.value.replace(/[^0-9.]/g, '');
            const parts = input.value.split('.');
            if (parts.length > 1) {
                input.value = `${parts[0]}.${parts[1].slice(0, decimalPlaces)}`;
            }
        }



        function load1() {
            var spinnerOverlay = document.querySelector('.spinner-overlay');
            spinnerOverlay.style.display = 'flex'; // Spiner 표시

            $.ajax({
                url: server + '/api/iteminfobom11',
                method: 'post',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    input: $('#inputdata').val()
                }),

                success: function (result) {
                    $('#iteminfobody').empty();

                    for (var i = 0; i < result.length; i++) {
                        $('#iteminfobody').append(
                            '<tr>' +
                            '<td>' + (result[i].bomno || '') + '</td>' +
                            '<td>' + (result[i].part || '') + '</td>' +
                            '<td>' + (result[i].modelname || '') + '</td>' +
                            '<td>' + (result[i].itemname || '') + '</td>' +
                            '<td>' + (result[i].customer || '') + '</td>' +
                            '<td>' + (result[i].class || '') + '</td>' +
                            '<td>' + (result[i].itemprice.toLocaleString() || '') + '</td>' +
                            '<td>' + (result[i].cost.toLocaleString() || '') + '</td>' +
                            '<td>' + (result[i].costPriceRatio.toLocaleString() || '') + '</td>' +
                            '<td><button class="btninfo" onclick="showinfo()">상세정보</button></td>' +
                            '</tr>'
                        );
                    }
                    $('td#data-id').hide();
                    setTimeout(function () {
                        spinnerOverlay.style.display = 'none'; // 1초 후에 Spiner 숨김
                    }, 1100);

                }
            });


        }


        $('#searchInput').on('keyup', function (event) {
            if (event.key === 'Enter') { // 엔터 키가 눌렸는지 확인
                var spinnerOverlay = document.querySelector('.spinner-overlay');
                spinnerOverlay.style.display = 'flex'; // Spinner 표시
                searchTable();
                setTimeout(function () {
                    spinnerOverlay.style.display = 'none'; // 1초 후에 Spiner 숨김
                }, 1100);
            }
        });
        // updateaccountiteminfo
        function searchTable() {
            var searchText = $('#searchInput').val().toLowerCase();
            $('#iteminfobody tr').filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(searchText) > -1);
            });
        }


        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }

        function closeModal1() {
            document.getElementById('modal1').style.display = 'none';
            document.getElementById('overlay1').style.display = 'none';
        }
        function closeModal2() {
            document.getElementById('modal2').style.display = 'none';
            document.getElementById('overlay1').style.display = 'none';
        }

        function checkData() {
            var rowCount = $('#accountdatatbody tr').length; // 테이블의 행 수 확인
            if (rowCount == 0) { // 행 수가 0인 경우
                $('#accountdatatbody').append('<tr><td colspan="12">데이터가 없습니다.</td></tr>'); // 메시지 추가
            }
        }

        function openProductModal() {


            $.ajax({
                type: 'POST',
                url: server + '/api/selectmaterialinfoinformation',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                }),
                success: function (result) {
                    $('#itemtbody1').empty();
                    for (var i = 0; i < result.length; i++) {
                        var row = '<tr>' +
                            '<td>' + result[i].materialname + '</td>' +
                            '<td>' + result[i].width + '</td>' +
                            '<td>' + result[i].length + '</td>' +
                            '<td>' + result[i].supplier + '</td>' +
                            '<td class="data-width">' + result[i].width + '</td>' +
                            '<td class="data-usewidth">' + result[i].usewidth + '</td>' +
                            '<td class="data-length">' + result[i].length + '</td>' +
                            '<td class="data-sqmprice">' + result[i].sqmprice + '</td>' +
                            '<td class="data-rollprice">' + result[i].rollprice + '</td>' +
                            '<td class="data-unit">' + result[i].unit + '</td>' +
                            '<td class="data-manufacterer">' + result[i].manufacterer + '</td>' +
                            '<td class="data-supplier">' + result[i].supplier + '</td>' +
                            '<td class="data-typecategory">' + result[i].typecategory + '</td>' +
                            '<td class="data-codenumber">' + result[i].codenumber + '</td>' +
                            '<td>' + result[i].num + '</td>' +
                            '<td><button class="btninfo" onclick="insertmaterialdata(this)" >추가</button></td>' +
                            '</tr>';

                        $('#itemtbody1').append(row);
                    }

                    // 한 번의 선택으로 모든 숨길 요소를 처리합니다.
                    $('#itemtbody1').find('.data-width, .data-usewidth, .data-length, .data-sqmprice, .data-rollprice, .data-unit, .data-manufacterer, .data-supplier, .data-codenumber').hide();
                }
            });

            document.getElementById('modal1').style.display = 'block';
            document.getElementById('overlay1').style.display = 'block';
        }
        function searchingmaterial() {
            $.ajax({
                type: 'POST',
                url: server + '/api/selecttoolcodesearch',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    toolcode: $('#bomtableBody tr:eq(' + $("#numericPart").val() + ') #toolcode-input').val(),

                }),
                success: function (result) {
                    $('#itemtbody1').empty();
                    if (result.length === 0) {
                        // 데이터가 없는 경우 메시지 표시
                        $('#itemtbody1').append('<tr><td colspan="12">데이터가 없습니다.</td></tr>');
                    } else {
                        // 데이터가 있는 경우 테이블에 행 추가
                        for (var i = 0; i < result.length; i++) {
                            var row = '<tr>' +
                                '<td>' + result[i].toolcode + '</td>' +
                                '<td>' + result[i].partcustomer + '</td>' +
                                '<td>' + result[i].bomno + '</td>' +
                                '<td>' + result[i].customer + '</td>' +
                                '<td>' + result[i].modelname + '</td>' +
                                '<td>' + result[i].itemname + '</td>' +
                                '<td>' + result[i].char + '</td>' +
                                '<td>' + result[i].part + '</td>' +
                                '<td>' + result[i].inputprice + '</td>' +
                                '<td>' + result[i].classification + '</td>' +
                                '<td><button class="btninfo" onclick="insertmaterialdata(this)" >추가</button></td>' +
                                '</tr>';
                            $('#itemtbody1').append(row);
                        }
                    }
                }
            });

            var rowIndex = parseInt($("#numericPart").val(), 10);
            $('#bomtableBody tr:eq(' + rowIndex + ') #ordercount-input').focus();
            document.getElementById('modal1').style.display = 'block';
            document.getElementById('overlay1').style.display = 'block';
        }


        function searchingmaterial2() {
            $.ajax({
                type: 'POST',
                url: server + '/api/selectcustomername',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    customername: $('#bomtableBody tr:eq(' + $("#numericPart2").val() + ') #partcustomer-input').val()

                }),
                success: function (result) {
                    $('#itemtbody2').empty();
                    if (result.length === 0) {
                        // 데이터가 없는 경우 메시지 표시
                        $('#itemtbody2').append('<tr><td colspan="5">데이터가 없습니다.</td></tr>');
                    } else {
                        // 데이터가 있는 경우 테이블에 행 추가
                        for (var i = 0; i < result.length; i++) {
                            var row = '<tr>' +
                                '<td>' + result[i].customername + '</td>' +
                                '<td><button class="btninfo" onclick="insertmaterialdata2(this)" >추가</button></td>' +
                                '</tr>';
                            $('#itemtbody2').append(row);
                        }
                    }
                }
            });

            document.getElementById('modal2').style.display = 'block';
            document.getElementById('overlay1').style.display = 'block';
        }




        function saveprocessname() {
            $.ajax({
                url: server + '/api/insertprocessname',
                method: 'post',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    processname: $('#processname-input').val()
                }),
                success: function (data) {

                }
            });
            $('#processnametbody').empty()
            selectprocessname()
        }
        // 상세 정보 버튼에 대한 클릭 이벤트 처리
        $(document).on('click', '.btninfo', function () {
            // 클릭된 버튼이 속한 행(row)을 선택합니다.
            var rowData = $(this).closest('tr');

            // 행에 포함된 데이터 셀들을 선택하여 데이터를 가져옵니다.
            var customer = rowData.find('td:eq(0)').text();
            var modelname = rowData.find('td:eq(1)').text();
            var itemname = rowData.find('td:eq(2)').text();
            var itemcode = rowData.find('td:eq(3)').text();
            var processname = rowData.find('td:eq(9)').text();
            var bucakcustomer = rowData.find('td:eq(10)').text();
            var id = rowData.find('td:eq(11)').text();

            $('#customer').text(customer)
            $('#modelname').text(modelname)
            $('#itemname').text(itemname)
            $('#itemcode').text(itemcode)
            $('#processname').text(processname)
            $('#bucakcustomer').text(bucakcustomer)
            // $('#cutomer').text(customer)
            // $('#customer').text(customer)s
        });

        function openModal() {
            document.getElementById('modal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
            $('#itemcode-input').focus()
            $('#itemcode-input').val('')
            $('#accountdatatbody').empty()
            checkData()
        }


        function addRow() {

            var newRow = $('#bomtableBody tr:first').clone();
            $('#bomtableBody').append(newRow);
            var rowIndex = $('#bomtableBody tr').length - 1;

            newRow.find('input').each(function () {
                var originalId = $(this).attr('id');
                var newId = originalId.replace(/\d+$/, rowIndex);
                $(this).attr('id', newId);
            });


            newRow.find('#classification-input').val('');
            newRow.find('#bomno-input').val('');
            newRow.find('#toolcode-input').val('');
            newRow.find('#partcustomer-input').val('');
            newRow.find('#customer-input').val('');
            newRow.find('#modelname-input').val('');
            newRow.find('#itemname-input').val('');
            newRow.find('#char-input').val('');
            newRow.find('#part-input').val('');
            newRow.find('#inputprice-input').val('');
            newRow.find('#outprice-input').val('');
            newRow.find('#ordercount-input').val('');
            newRow.find('#a1-input').val('');
            newRow.find('#a2-input').val('');
            newRow.find('#a3-input').val('');
            newRow.find('#part2-input').val('');



        }


        function Bomsave() {

            function showMissingFieldAlert(fieldName, message) {
                Swal.fire({
                    icon: 'error',
                    title: '오류',
                    text: message,
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: '확인',
                    background: '#f4f4f4',
                    customClass: {
                        title: 'my-title',
                        content: 'my-content',
                    },
                    padding: '2rem',
                    width: '500px',
                });
            }

            if ($('#classification-input').val() === '') {
                showMissingFieldAlert('구분', '구분선택이 누락되었습니다');
                return;
            }
            if ($('#bomno-input').val() === '') {
                showMissingFieldAlert('BOMNO', 'BOMNO가 누락되었습니다');
                return;
            }
            if ($('#toolcode-input').val() === '') {
                showMissingFieldAlert('TOOLCODE', 'TOOLCODE가 누락되었습니다');
                return;
            }
            if ($('#partcustomer-input').val() === '') {
                showMissingFieldAlert('제조사', '제조사가 누락되었습니다');
                return;
            }
            if ($('#customer-input').val() === '') {
                showMissingFieldAlert('고객사', '고객사가 누락되었습니다');
                return;
            }
            if ($('#modelname-input').val() === '') {
                showMissingFieldAlert('모델명', '모델명이 누락되었습니다');
                return;
            }
            if ($('#itemaname-input').val() === '') {
                showMissingFieldAlert('품목명', '품목명이 누락되었습니다');
                return;
            }
            if ($('#workpart-input').val() === '') {
                showMissingFieldAlert('해당차수', '해당차수가 누락되었습니다');
                return;
            }
            if ($('#part-input').val() === '') {
                showMissingFieldAlert('종류', '종류선택이 누락되었습니다');
                return;
            }
            if ($('#inputprice-input').val() === '') {
                showMissingFieldAlert('입고단가', '입고단가가 누락되었습니다');
                return;
            }


            let tableBody = document.getElementById('bomtableBody');
            if (tableBody) {
                let rowCount = tableBody.children.length;

                for (let i = 0; i < rowCount; i++) {
                    var bomno = $('#bomtableBody tr:eq(' + i + ') #bomno-input').val();
                    var toolcode = $('#bomtableBody tr:eq(' + i + ') #toolcode-input').val();
                    var partcustomer = $('#bomtableBody tr:eq(' + i + ') #partcustomer-input').val();
                    var customer = $('#bomtableBody tr:eq(' + i + ') #customer-input').val();
                    var modelname = $('#bomtableBody tr:eq(' + i + ') #modelname-input').val();
                    var itemname = $('#bomtableBody tr:eq(' + i + ') #itemname-input').val();
                    var char = $('#bomtableBody tr:eq(' + i + ') #char-input').val();
                    var part = $('#bomtableBody tr:eq(' + i + ') #part-input').val();
                    var outprice = $('#bomtableBody tr:eq(' + i + ') #outprice-input').val();
                    var ordercount = $('#bomtableBody tr:eq(' + i + ') #ordercount-input').val();
                    var ordercause = $('#bomtableBody tr:eq(' + i + ') #ordercause-input').val();
                    var deadline = $('#bomtableBody tr:eq(' + i + ') #deadline-input').val();
                    var sheet2 = $('#bomtableBody tr:eq(' + i + ') #sheet2-input').val();
                    var part2 = $('#bomtableBody tr:eq(' + i + ') #part2-input').val();
                    if (ordercount === '' || ordercause === '' || deadline === '' || sheet2 === '' || part2 === '' || bomno === '' || toolcode === '' || partcustomer === '' || customer === '' || modelname === '' || itemname === '' || char === '' || part === '' || outprice === '') {
                        Swal.fire({
                            icon: 'error',
                            title: '누락',
                            text: `${i + 1}번째 필수 입력 항목이 누락되었습니다.`,
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: '확인',
                            background: '#f4f4f4',
                            customClass: {
                                title: 'my-title',
                                content: 'my-content',
                            },
                            padding: '2rem',
                            width: '500px',
                        }).then((result) => { });
                        return;
                    }
                }
            } else { }

            if (tableBody) {
                let rowCount = tableBody.children.length;

                for (let i = 0; i < rowCount; i++) {
                    var materialWidthValue = $('#bomtableBody tr:eq(' + i + ') #materialwidth-input').val();
                    var useWidthValue = $('#bomtableBody tr:eq(' + i + ') #usewidth-input').val();

                    if (parseFloat(materialWidthValue) > parseFloat(useWidthValue)) {
                        Swal.fire({
                            icon: 'error',
                            title: '오류',
                            text: `${i + 1}번째 원단폭이 유효폭보다 클 수 없습니다.`,
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: '확인',
                            background: '#f4f4f4',
                            customClass: {
                                title: 'my-title',
                                content: 'my-content',
                            },
                            padding: '2rem',
                            width: '500px',
                        }).then((result) => { });

                        return;
                    }
                }
            } else { }
            if ($('#bomid-edit').val()) {
                var insertdate = new Date().toISOString().slice(0, 10);
                Swal.fire({
                    icon: 'info',
                    title: 'BOM 정보 수정',
                    text: 'BOM정보(양산) 데이터를 수정하시겠습니까?',
                    showCancelButton: true, // 취소 버튼 표시
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: '확인',
                    cancelButtonText: '취소', // 취소 버튼 텍스트
                    background: '#f4f4f4',
                    customClass: {
                        title: 'my-title',
                        content: 'my-content',
                    },
                    padding: '2rem',
                    width: '500px',
                }).then((result) => {
                    if (result.isConfirmed) {

                        $.ajax({
                            type: 'POST',
                            url: server + '/api/updateiteminformation',
                            dataType: 'json',
                            async: false,
                            contentType: 'application/json',
                            data: JSON.stringify({
                                "bomno": $('#bomno-save').val(),
                                "modelname": $('#modelname-save').val(),
                                "itemname": $('#itemname-save').val(),
                                "customer": $('#customer-save').val(),
                                "itemcode": $('#itemcode-save').val(),
                                "pcs": $('#pcs-save').val(),
                                "cavity": $('#cavity-save').val(),
                                "direction": $('#direction-save').val(),
                                "workpart": $('#workpart-save').val(),
                                "additionalnotes": $('#additionalNote-save').val(),
                                "working": $('#working-save').val(),
                                "type": $('#type-save').val(),
                            }),
                            success: function (result) {
                            }
                        });

                        $.ajax({
                            type: 'POST',
                            url: server + '/api/updatebomstatus',
                            dataType: 'json',
                            async: false,
                            contentType: 'application/json',
                            data: JSON.stringify({
                                "bomid": $('#bomid-edit').val(),
                                "status": 'false'
                            }),
                            success: function (result) {
                            }
                        });



                        $('[id^="num-input"]').each(function (index) {
                            var cavity = $('#cavity-save').val();
                            var bomno = $('#bomno-save').val();
                            var model = $('#modelname-save').val();
                            var itemname = $('#itemname-save').val();
                            var materialname = $('[id^="materialname-input"]').eq(index).val();
                            var char = $('[id^="char-input"]').eq(index).val();
                            var main = $('[id^="main-edit"]').eq(index).prop('checked') ? '메인자재' : '';
                            var etc = $('[id^="etc-input"]').eq(index).val();
                            var materialwidth = parseFloat($('[id^="materialwidth-input"]').eq(index).val()) || 0;
                            var onepid = ($('[id^="onepidding-input"]').eq(index).val())
                            var twopid = ($('[id^="twopidding-input"]').eq(index).val())
                            var soyo = ($('[id^="soyo-input"]').eq(index).val())
                            var ta = ($('[id^="ta-input"]').eq(index).val())
                            var allta = ($('[id^="allta-input"]').eq(index).val())
                            var talength = ($('[id^="talength-input"]').eq(index).val())
                            var loss = ($('[id^="loss-input"]').eq(index).val())
                            var num = ($('[id^="num-input"]').eq(index).val());
                            var cavity = ($('[id^="cavity-input"]').eq(index).val());
                            var codenumber = ($('[id^="codenumber-input"]').eq(index).val());
                            var useable = ($('[id^="useable-input"]').eq(index).val());
                            var bomid = $('#bomid-save').val();
                            var costloss = ($('[id^="costloss-input"]').eq(index).val());
                            var chk1 = $('[id^="chk1-input"]').eq(index).prop('checked') ? true : false;
                            var chk2 = $('[id^="chk2-input"]').eq(index).prop('checked') ? true : false;
                            var chk3 = $('[id^="chk3-input"]').eq(index).prop('checked') ? true : false;

                            $.ajax({
                                type: 'POST',
                                url: server + '/api/bommasssavebommanagement',
                                dataType: 'json',
                                contentType: 'application/json',
                                data: JSON.stringify({
                                    "savedate": insertdate,
                                    "bomno": bomno,
                                    "model": model,
                                    "itemname": itemname,
                                    "materialname": materialname,
                                    "status": 'true',
                                    "char": char,
                                    "main": main,
                                    "etc": etc,
                                    "materialwidth": materialwidth,
                                    "onepid": onepid,
                                    "twopid": twopid,
                                    "ta": ta,
                                    "allta": allta,
                                    "talength": talength,
                                    "loss": loss,
                                    "cavity": cavity,
                                    "codenumber": codenumber,
                                    "useable": useable,
                                    "num": num,
                                    "costloss": costloss,
                                    "bomid": bomid,
                                    "chk1": chk1,
                                    "chk2": chk2,
                                    "chk3": chk3
                                }),
                                success: function (result) {
                                    // Handle success
                                },
                                error: function (error) {
                                    // Handle error
                                },
                            });
                        });

                        $('#overlay').fadeOut();
                        $('#modal').fadeOut();
                        Swal.fire({
                            icon: 'success',
                            title: 'Bom 수정 완료',
                            text: '데이터가 성공적으로 수정 되었습니다.',
                        }).then((result) => {
                            if (result.isConfirmed) {
                                load();
                            }
                        });
                    } else if (result.dismiss === Swal.DismissReason.cancel) {
                        // 취소 버튼이 클릭되었을 때 실행할 작업
                    }
                });

            } else {


                var insertdate = new Date().toISOString().slice(0, 10);
                var rowCount = $('#bomtableBody tr').length;
                for (var i = 0; i < rowCount; i++) {
                    $('#bomtableBody tr:eq(' + i + ') #num-input').val(i + 1);
                }

                var bomno = $('#bomno-save').val();
                var customer = $('#customer-save').val();
                var modelname = $('#modelname-save').val();
                var itemname = $('#itemname-save').val();
                var pcs = $('#pcs-save').val();
                var cavity = $('#cavity-save').val();
                var itemcode = $('#itemcode-save').val();
                var workpart = $('#workpart-save').val();
                var working = $('#working-save').val();
                var direction = $('#direction-save').val();
                var costsum = $('#costsum-save').val();
                var additionalnotes = $('#additionalNote').val();
                var type = $('#type-save').val();

                // if (bomno !== '' && modelname !== '') {
                if (bomno !== '') {
                    Swal.fire({
                        icon: 'info',
                        title: 'TOOL 발주정보',
                        text: 'TOOL 발주정보 데이터를 저장하시겠습니까?',
                        showCancelButton: true, // 취소 버튼 표시
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: '확인',
                        cancelButtonText: '취소', // 취소 버튼 텍스트
                        background: '#f4f4f4',
                        customClass: {
                            title: 'my-title',
                            content: 'my-content',
                        },
                        padding: '2rem',
                        width: '500px',
                    }).then((result) => {
                        if (result.isConfirmed) {

                            $('[id^="toolcode-input"]').each(function (index) {
                                var orderdate = ($('[id^="datetimepicker1-input"]').eq(index).val());
                                var inputdate = ($('[id^="datetimepicker2-input"]').eq(index).val());
                                var madecustomer = ($('[id^="partcustomer-input"]').eq(index).val());
                                var toolcode = 'TOOL-' + ($('[id^="toolcode-input"]').eq(index).val());
                                var bomno = ($('[id^="bomno-input"]').eq(index).val());
                                var customer = ($('[id^="customer-input"]').eq(index).val());
                                var modelname = ($('[id^="modelname-input"]').eq(index).val());
                                var itemname = ($('[id^="itemname-input"]').eq(index).val());
                                var char = ($('[id^="char-input"]').eq(index).val());
                                var part = ($('[id^="part-input"]').eq(index).val());
                                var orderprice = ($('[id^="outprice-input"]').eq(index).val());
                                var ordercount = ($('[id^="ordercount-input"]').eq(index).val());
                                var sheet2 = ($('[id^="sheet2-input"]').eq(index).val());
                                var part2 = ($('[id^="part2-input"]').eq(index).val());
                                var ordercause = ($('[id^="ordercause-input"]').eq(index).val());
                                var deadline = ($('[id^="deadline-input"]').eq(index).val());


                                $.ajax({
                                    type: 'POST',
                                    url: server + '/api/insertbomtoolorder',
                                    dataType: 'json',
                                    contentType: 'application/json',
                                    data: JSON.stringify({
                                        "orderdate": orderdate,
                                        "inputdate": inputdate,
                                        "madecustomer": madecustomer,
                                        "toolcode": toolcode,
                                        "bomno": bomno,
                                        "customer": customer,
                                        "modelname": modelname,
                                        "itemname": itemname,
                                        "char": char,
                                        "part": part,
                                        "orderprice": orderprice,
                                        "ordercount": ordercount,
                                        "sheet2": sheet2,
                                        "part2": part2,
                                        "ordercause": ordercause,
                                        "deadline": deadline

                                    }),
                                    success: function (result) {
                                        // Handle success
                                    },
                                    error: function (error) {
                                        // Handle error
                                    },
                                });
                            });

                            $('#overlay').fadeOut();
                            $('#modal').fadeOut();
                            Swal.fire({
                                icon: 'success',
                                title: 'TOOLCODE',
                                text: '데이터가 성공적으로 저장 되었습니다.',
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    load();
                                }
                            });
                        } else if (result.dismiss === Swal.DismissReason.cancel) {
                            // 취소 버튼이 클릭되었을 때 실행할 작업
                        }
                    });



                }
            }



        }


        function bomchanged() {
            var bomnoSaveValue = $('#bomno-save').val().toUpperCase();
            var numericPart = parseInt(bomnoSaveValue.split('-')[1], 10);

            // Check if bomnoSaveValue is at least 3 characters long
            if (bomnoSaveValue.length >= 3) {
                var customerinitial = bomnoSaveValue.substring(0, 3);
                $.ajax({
                    type: 'POST',
                    url: server + '/api/selectcustomerinformationwhere',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        customerinitial: customerinitial
                    }),
                    success: function (result) {
                        $('#customer-save').val(result[0].customername);
                    }
                });
            }

            // Check if bomnoSaveValue is at least 5 characters long
            if (bomnoSaveValue.length >= 5) {
                // Use a regular expression to check if the middle part is numeric
                var middlePart = bomnoSaveValue.split('-')[1];
                if (/^\d+$/.test(middlePart)) {
                    $('#working-save').val(numericPart);
                } else {
                    $('#working-save').val('');
                }
            }
        }
        function handleCheckboxChange(checkbox) {
            // Get all checkboxes with the same class
            var checkboxes = document.getElementsByClassName('checkbox');

            // Loop through all checkboxes
            for (var i = 0; i < checkboxes.length; i++) {
                // If the checkbox is not the one clicked, uncheck it
                if (checkboxes[i] !== checkbox) {
                    checkboxes[i].checked = false;
                }
            }
        }

        function handleKeyPress(event) {
            if (event.key === "Enter") {
                openProductModal(event.target.value)

            }
        }
        function handleKeyPress1(event) {
            if (event.key === "Enter") {
                var parentRow = $(event.target).closest('tr');
                // Extract data from the parent row
                var rowData = parentRow.find('td').map(function () {
                    return $(this).text();
                }).get();
                var rowIndex = parentRow.index();
                $("#numericPart").val(rowIndex);
                searchingmaterial();

            }
        }
        function handleKeyPress2(event) {
            if (event.key === "Enter") {
                var parentRow = $(event.target).closest('tr');
                // Extract data from the parent row
                var rowData = parentRow.find('td').map(function () {
                    return $(this).text();
                }).get();
                var rowIndex = parentRow.index();
                $("#numericPart2").val(rowIndex);
                searchingmaterial2();

            }
        }


        function handleDoubleClick() {
            var parentRow = $(event.target).closest('tr');
            // Extract data from the parent row
            var rowData = parentRow.find('td').map(function () {
                return $(this).text();
            }).get();
            var rowIndex = parentRow.index();
            $("#numericPart").val(rowIndex);
            var cavitySaveValue = $("#cavity-save").val();

            if (cavitySaveValue === '') {
                // Show alert when cavity-save is empty
                Swal.fire({
                    icon: 'error',
                    title: '누락',
                    text: `CAVITY가 누락되었습니다.`,
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: '확인',
                    background: '#f4f4f4',
                    customClass: {
                        title: 'my-title',
                        content: 'my-content',
                    },
                    padding: '2rem',
                    width: '500px',
                }).then((result) => { });
                return;  // Stop further execution
            }



            document.getElementById('modal1').style.display = 'block';
            document.getElementById('overlay1').style.display = 'block';

            $('#searchingmaterialinfobody-edit').empty()
            $("#materialnameinput-edit").val('')
            $("#materialnameinput-edit").focus()

            var currentRow = $(event.target).closest('tr');

            var rowIndex = currentRow.index();



            $("#numericPart-edit").val(rowIndex);
        }


        function insertmaterialdata(button) {
            document.getElementById('modal1').style.display = 'none';
            document.getElementById('overlay1').style.display = 'none';
            // 클릭된 버튼의 부모 행을 찾습니다.
            var row = $(button).closest('tr');
            var rowData = row.find('td').map(function () {
                return $(this).text();
            }).get();
            var rowIndex = $('#numericPart').val();
            $('#bomtableBody tr:eq(' + rowIndex + ') #toolcode-input').val(rowData[0]);
            $('#bomtableBody tr:eq(' + rowIndex + ') #partcustomer-input').val(rowData[1]);
            $('#bomtableBody tr:eq(' + rowIndex + ') #bomno-input').val(rowData[2]);
            $('#bomtableBody tr:eq(' + rowIndex + ') #customer-input').val(rowData[3]);
            $('#bomtableBody tr:eq(' + rowIndex + ') #modelname-input').val(rowData[4]);
            $('#bomtableBody tr:eq(' + rowIndex + ') #itemname-input').val(rowData[5]);
            $('#bomtableBody tr:eq(' + rowIndex + ') #char-input').val(rowData[6]);
            $('#bomtableBody tr:eq(' + rowIndex + ') #part-input').val(rowData[7]);
            $('#bomtableBody tr:eq(' + rowIndex + ') #outprice-input').val(rowData[8]);
            $('#bomtableBody tr:eq(' + rowIndex + ') #part2-input').val(rowData[9]);
        }
        function insertmaterialdata2(button) {
            document.getElementById('modal2').style.display = 'none';
            document.getElementById('overlay1').style.display = 'none';
            // 클릭된 버튼의 부모 행을 찾습니다.
            var row = $(button).closest('tr');
            var rowData = row.find('td').map(function () {
                return $(this).text();
            }).get();
            var rowIndex = $('#numericPart2').val();
            $('#bomtableBody tr:eq(' + rowIndex + ') #partcustomer-input').val(rowData[0]);

        }

        function onlyNumberKey(event) {
            // Only allows number keys, backspace, delete, left and right arrows
            const charCode = event.which ? event.which : event.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                return false;
            }
            return true;
        }
    </script>


</body>

</html>